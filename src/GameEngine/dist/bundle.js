var t={m:{},d:(e,s)=>{for(var n in s)t.o(s,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:s[n]})},u:t=>t+".bundle.js",o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}};(()=>{var e;if("string"==typeof import.meta.url&&(e=import.meta.url),!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),t.p=e})(),t.b=new URL("./",import.meta.url);var e={};t.r(e),t.d(e,{Decoder:()=>We,Encoder:()=>Me,PacketType:()=>Re,protocol:()=>Ae});class s{enabled=!0;gameObject;start(){}event(t,e){}getGameWorld(){return this.gameObject.getGameWorld()}hasComponent(t){return this.gameObject.hasComponent(t)}getComponent(t){return this.gameObject.getComponent(t)}getAllComponents(){return this.gameObject.getAllComponents()}getTransform(){return this.gameObject.getTransform()}getGameObject(){return this.gameObject}getPlugin(t){return this.getGameWorld().getPlugin(t)}isEnabled(){return this.gameObject.enabled&&this.enabled}enable(t=!0){this.enabled=t}}class n{static symRand(t){return(2*Math.random()-1)*t}static getColliderRadius(t,e){if(t>=10)return e;const s=Math.PI/t;return(Math.cos(s)*e*2+e)/3}static deltaAngle(t,e){return t=t%(2*Math.PI)+2*Math.PI,t%=2*Math.PI,((e=(e=e%(2*Math.PI)+2*Math.PI)%(2*Math.PI)+2*Math.PI)-t+Math.PI)%(2*Math.PI)-Math.PI}static elasticCollision1D(t,e,s,n){return[(e*(t-s)+2*s*n)/(t+s),(n*(s-t)+2*t*e)/(t+s)]}}class i{x=0;y=0;constructor(t,e){this.x=t,this.y=e}add(t){return new i(this.x+t.x,this.y+t.y)}sub(t){return new i(this.x-t.x,this.y-t.y)}times(t){return new i(this.x*t,this.y*t)}timesV(t){return new i(this.x*t.x,this.y*t.y)}distance(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))}static distance(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}magnitude(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))}cross(){return new i(this.y,-this.x).toUnit()}scalarProduct(t){return this.x*t.x+this.y*t.y}vectorProduct(t){return this.x*t.y-this.y*t.x}perpendicular(t){return this.sub(t.cross().times(t.scalarProduct(this)/(t.magnitude()*t.magnitude())))}toUnit(){return 0!=this.magnitude()?new i(this.x,this.y).times(1/this.magnitude()):new i(1,0)}setLength(t){return this.toUnit().times(t)}toString(){return"{"+this.x+":"+this.y+"}"}toRad(){return Math.atan2(this.y,this.x)}reverse(){let t=1e32,e=1e32;return 0!=this.x&&(t=1/this.x),0!=this.y&&(e=1/this.y),new i(t,e)}interpolate(t,e){const s=t.sub(this),n=s.sub(s.times(Math.min(1,Math.max(0,e))));return this.add(n)}static fromRad(t){return new i(Math.cos(t),Math.sin(t))}static randomPos(t){return new i(n.symRand(t),n.symRand(t))}static randomPos2(t){let e=n.symRand(Math.PI),s=Math.random()*t;return i.fromRad(e).times(s)}clone(){return new i(this.x,this.y)}static zero(){return new i(0,0)}static one(){return new i(1,1)}static up(){return new i(0,1)}static down(){return new i(0,-1)}static left(){return new i(-1,0)}static right(){return new i(1,0)}}class o extends s{velocity;acceleration=i.zero();mass=1;dampingFactor;angularVelocity=0;angularAcceleration=0;angularDrag=.25;constructor(t,e=.45){super(),this.velocity=new i(15*Math.random()*2-15,15*Math.random()*2-15),this.dampingFactor=e,this.mass=t}update(t){this.velocity=this.velocity.add(this.acceleration.times(t)),this.velocity=this.velocity.times(Math.pow(this.dampingFactor,t)),this.getTransform().position=this.getTransform().position.add(this.velocity.times(t)),this.getTransform().position=this.getTransform().position.add(this.acceleration.times(t*t/2)),this.angularVelocity=this.angularVelocity+this.angularAcceleration*t,this.angularVelocity=this.angularVelocity*Math.pow(this.angularDrag,t),this.getTransform().rotation+=this.angularVelocity*t}}class r{r=0;g=0;b=0;a=1;static stroke=new r(43,43,44);static background=new r(93,97,95);constructor(t,e,s,n=1){this.r=Math.min(255,Math.max(0,t)),this.g=Math.min(255,Math.max(0,e)),this.b=Math.min(255,Math.max(0,s)),this.a=Math.min(1,Math.max(0,n))}toString(){return`rgba(${this.r},${this.g},${this.b},${Math.max(0,Math.min(this.a,1))})`}toRgb(){return new r(this.r,this.g,this.b)}toArgb(t){return new r(this.r,this.g,this.b,t)}blend(t,e){return new r(this.r*(1-e)+t.r*e,this.g*(1-e)+t.g*e,this.b*(1-e)+t.b*e,this.a*(1-e)+t.a*e)}static randomColor(){return new r(255*Math.random(),255*Math.random(),255*Math.random())}static hslToRgb(t,e,s){s/=100;const n=e=>(e+t/30)%12,i=(e/=100)*Math.min(s,1-s),o=t=>s-i*Math.max(-1,Math.min(n(t)-3,Math.min(9-n(t),1))),a=Math.round(255*o(0)),h=Math.round(255*o(8)),l=Math.round(255*o(4));return new r(a,h,l)}static randomColor2(){const t=Math.floor(360*Math.random()),e=Math.floor(30*Math.random())+15,s=Math.floor(20*Math.random())+30;return r.hslToRgb(t,e,s)}static getHeatmapColor(t){t=Math.max(0,Math.min(1,t));let e=Math.min(255,Math.max(0,Math.floor(255*t*2))),s=Math.min(255,Math.max(0,Math.floor(255*(2-2*t))));return new r(s/1.5,e/1.5,0,255)}static tryParseCssColor(t){let e=document.body,s=e.style.color;e.style.color=t;let n=getComputedStyle(e).color;return e.style.color=s,this.getRgbFromComputedStyle(n)}static getRgbFromComputedStyle(t){let e=t.match(/^rgb(a?)\((\d+),\s*(\d+),\s*(\d+)(?:,\s*([\d.]+))?\)$/);if(e)return new r(parseInt(e[2]),parseInt(e[3]),parseInt(e[4]),parseFloat(e[5]??1))}clone(){return new r(this.r,this.g,this.b,this.a)}}class a{position;rotation;scale;constructor(t=new i(0,0),e=0,s=i.one()){this.position=t,this.rotation=e,this.scale=s}static fromPosition(t){let e=new a;return e.position=t,e}clone(){let t=new a;return t.position=this.position.clone(),t.scale=this.scale.clone(),t.rotation=this.rotation,t}}const h={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let l;const c=new Uint8Array(16),d=[];for(let t=0;t<256;++t)d.push((t+256).toString(16).slice(1));const u=function(t,e,s){if(h.randomUUID&&!e&&!t)return h.randomUUID();const n=(t=t||{}).random??t.rng?.()??function(){if(!l){if("undefined"==typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");l=crypto.getRandomValues.bind(crypto)}return l(c)}();if(n.length<16)throw new Error("Random bytes length must be >= 16");if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,e){if((s=s||0)<0||s+16>e.length)throw new RangeError(`UUID byte range ${s}:${s+15} is out of buffer bounds`);for(let t=0;t<16;++t)e[s+t]=n[t];return e}return function(t,e=0){return(d[t[e+0]]+d[t[e+1]]+d[t[e+2]]+d[t[e+3]]+"-"+d[t[e+4]]+d[t[e+5]]+"-"+d[t[e+6]]+d[t[e+7]]+"-"+d[t[e+8]]+d[t[e+9]]+"-"+d[t[e+10]]+d[t[e+11]]+d[t[e+12]]+d[t[e+13]]+d[t[e+14]]+d[t[e+15]]).toLowerCase()}(n)};class p{enabled=!0;name="UnnamedGameObject";transform=new a;components=new Map;id=u();gameWorld;constructor(...t){for(let e of t){let t=e.constructor.name;if(this.components.has(t))throw new Error(`Component ${t} already exists in the game object`);e.gameObject=this,this.components.set(t,e)}}hasComponent(t){return this.components.has(t.name)}getComponent(t){const e=t.name;return this.components.get(e)}getAllComponents(t=!1){return Array.from(this.components.values()).filter((e=>!t||e.isEnabled()))}destroy(){this.gameWorld.destroy(this)}spawn(t){return t.spawn(this)}getId(){return this.id}getTransform(){return this.transform}getGameWorld(){return this.gameWorld}}class g{status;message;data;constructor(t,e,s){this.status=t,this.message=e,this.data=s}}function m(t,e,s){return function(n,i,o){const r=o.value;if(r){(e=e??"")&&(e=" "+e),(s=s??"void")&&(s=": "+s),e=(t=t??i)+e+s;const o=n.constructor;Object.prototype.hasOwnProperty.call(o,"commands")||(o.commands=Object.assign({},o.commands||{})),o.commands[t]=r,Object.prototype.hasOwnProperty.call(o,"syntaxes")||(o.syntaxes=Object.assign({},o.syntaxes||{})),console.log("Adding syntax:",e),o.syntaxes[t]=e}}}function f(t){return function(e){e.prototype.cliGetName=function(){return t}}}var y=function(t,e,s,n){var i,o=arguments.length,r=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,s):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,s,n);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(r=(o<3?i(r):o>3?i(e,s,r):i(e,s))||r);return o>3&&r&&Object.defineProperty(e,s,r),r},b=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};class w{gameWorld;enabled=!0;name="Plugin";event(t,e){}start(){}update(t){}getPlugin(t){return this.gameWorld.getPlugin(t)}hasPlugin(t){return this.gameWorld.hasPlugin(t)}isEnabled(){return this.enabled}enable(t=!0){this.enabled=t}disable(){this.enabled=!1}cliGetName(){return this.name}help(){let t=`[36m${this.cliGetName()}[0m commands:\n`;for(const e of Object.values(this.constructor.syntaxes))t+=`  /${this.cliGetName()}:${e}\n`;return new g(!0,t,void 0)}cliEnable(){return this.enabled=!0,new g(!0,`${this.name} [32menabled[0m`,void 0)}cliDisable(){return this.enabled=!1,new g(!0,`${this.name} [31mdisabled[0m`,void 0)}}y([m("help"),b("design:type",Function),b("design:paramtypes",[]),b("design:returntype",g)],w.prototype,"help",null),y([m("enable"),b("design:type",Function),b("design:paramtypes",[]),b("design:returntype",g)],w.prototype,"cliEnable",null),y([m("disable"),b("design:type",Function),b("design:paramtypes",[]),b("design:returntype",g)],w.prototype,"cliDisable",null);class v{constructor(){}}class x{subs=new Map;args=[];subscribe(t,e){this.subs.set(new WeakRef(t),e)}unsubscribe(t){this.subs.delete(new WeakRef(t))}emit(t){this.args.push(t)}register(t){t.registerEvent(this)}invoke(){if(0!=this.args.length){for(const[t,e]of this.subs){const s=t.deref();if(s)for(const t of this.args)s.event(t,e);else this.subs.delete(t)}this.args=[]}}}class _ extends v{delta;constructor(t){super(),this.delta=t}}class P extends v{button;constructor(t){super(),this.button=t}}class C extends w{name="MousePlugin";mouseScrollYEvent=new x;mouseDownEvent=new x;mouseUpEvent=new x;pressedKeys=new Set;canvas;position=i.zero();constructor(t){super(),this.canvas=t,this.trackMouse(t)}start(){this.mouseScrollYEvent.register(this.gameWorld),this.mouseDownEvent.register(this.gameWorld),this.mouseUpEvent.register(this.gameWorld)}isKeyDown(t=0){return this.pressedKeys.has(t)}getMouseScreenPosition(){const t=window.devicePixelRatio||1;return new i(this.position.x*t,this.position.y*t)}trackMouse(t){t.addEventListener("mousemove",(e=>{const s=t.getBoundingClientRect();let n=e.clientX-s.left,o=e.clientY-s.top;this.position=new i(n,o)})),t.addEventListener("mousedown",(t=>{this.pressedKeys.add(t.button),this.mouseDownEvent.emit(new P(t.button))})),t.addEventListener("mouseup",(t=>{this.pressedKeys.delete(t.button),this.mouseUpEvent.emit(new P(t.button))})),t.addEventListener("wheel",(t=>{this.mouseScrollYEvent.emit(new _(t.deltaY))}))}}class k extends v{collider;constructor(t){super(),this.collider=t}}class T extends s{offset=i.zero();radius;isActive=!1;isStatic;avoidObjectes;collisions=new Set;onCollisionEnterEvent=new x;onCollisionExitEvent=new x;constructor(t=1,e=!0,...s){super(),this.radius=t,this.isStatic=e,this.avoidObjectes=new Set,s.forEach((t=>this.avoidObjectes.add(t)))}start(){this.onCollisionEnterEvent.register(this.getGameWorld()),this.onCollisionExitEvent.register(this.getGameWorld())}getCenter(){return this.getTransform().position.add(this.offset)}getAABB(){const t=this.getCenter();return{colliderId:this.getGameObject().getId(),minX:t.x-this.radius,minY:t.y-this.radius,maxX:t.x+this.radius,maxY:t.y+this.radius}}collides(t){return this.getCenter().sub(t.getCenter()).magnitude()<=this.radius+t.radius&&!this.avoidObjectes.has(t.getGameObject())&&!t.avoidObjectes.has(this.getGameObject())}onCollisionEnter(t){this.onCollisionEnterEvent.emit(new k(t))}onCollisionExit(t){this.onCollisionExitEvent.emit(new k(t))}}class E{constructor(){this.ids=[],this.values=[],this.length=0}clear(){this.length=0}push(t,e){let s=this.length++;for(;s>0;){const t=s-1>>1,n=this.values[t];if(e>=n)break;this.ids[s]=this.ids[t],this.values[s]=n,s=t}this.ids[s]=t,this.values[s]=e}pop(){if(0===this.length)return;const t=this.ids[0];if(this.length--,this.length>0){const t=this.ids[0]=this.ids[this.length],e=this.values[0]=this.values[this.length],s=this.length>>1;let n=0;for(;n<s;){let t=1+(n<<1);const s=t+1;let i=this.ids[t],o=this.values[t];const r=this.values[s];if(s<this.length&&r<o&&(t=s,i=this.ids[s],o=r),o>=e)break;this.ids[n]=i,this.values[n]=o,n=t}this.ids[n]=t,this.values[n]=e}return t}peek(){if(0!==this.length)return this.ids[0]}peekValue(){if(0!==this.length)return this.values[0]}shrink(){this.ids.length=this.values.length=this.length}}const S=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class O{static from(t,e=0){if(e%8!=0)throw new Error("byteOffset must be 8-byte aligned.");if(!t||void 0===t.byteLength||t.buffer)throw new Error("Data must be an instance of ArrayBuffer or SharedArrayBuffer.");const[s,n]=new Uint8Array(t,e+0,2);if(251!==s)throw new Error("Data does not appear to be in a Flatbush format.");const i=n>>4;if(3!==i)throw new Error(`Got v${i} data when expected v3.`);const o=S[15&n];if(!o)throw new Error("Unrecognized array type.");const[r]=new Uint16Array(t,e+2,1),[a]=new Uint32Array(t,e+4,1);return new O(a,r,o,void 0,t,e)}constructor(t,e=16,s=Float64Array,n=ArrayBuffer,i,o=0){if(void 0===t)throw new Error("Missing required argument: numItems.");if(isNaN(t)||t<=0)throw new Error(`Unexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+e,2),65535),this.byteOffset=o;let r=t,a=r;this._levelBounds=[4*r];do{r=Math.ceil(r/this.nodeSize),a+=r,this._levelBounds.push(4*a)}while(1!==r);this.ArrayType=s,this.IndexArrayType=a<16384?Uint16Array:Uint32Array;const h=S.indexOf(this.ArrayType),l=4*a*this.ArrayType.BYTES_PER_ELEMENT;if(h<0)throw new Error(`Unexpected typed array class: ${s}.`);i&&void 0!==i.byteLength&&!i.buffer?(this.data=i,this._boxes=new this.ArrayType(this.data,o+8,4*a),this._indices=new this.IndexArrayType(this.data,o+8+l,a),this._pos=4*a,this.minX=this._boxes[this._pos-4],this.minY=this._boxes[this._pos-3],this.maxX=this._boxes[this._pos-2],this.maxY=this._boxes[this._pos-1]):(this.data=new n(8+l+a*this.IndexArrayType.BYTES_PER_ELEMENT),this._boxes=new this.ArrayType(this.data,8,4*a),this._indices=new this.IndexArrayType(this.data,8+l,a),this._pos=0,this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,new Uint8Array(this.data,0,2).set([251,48+h]),new Uint16Array(this.data,2,1)[0]=e,new Uint32Array(this.data,4,1)[0]=t),this._queue=new E}add(t,e,s=t,n=e){const i=this._pos>>2,o=this._boxes;return this._indices[i]=i,o[this._pos++]=t,o[this._pos++]=e,o[this._pos++]=s,o[this._pos++]=n,t<this.minX&&(this.minX=t),e<this.minY&&(this.minY=e),s>this.maxX&&(this.maxX=s),n>this.maxY&&(this.maxY=n),i}finish(){if(this._pos>>2!==this.numItems)throw new Error(`Added ${this._pos>>2} items when expected ${this.numItems}.`);const t=this._boxes;if(this.numItems<=this.nodeSize)return t[this._pos++]=this.minX,t[this._pos++]=this.minY,t[this._pos++]=this.maxX,void(t[this._pos++]=this.maxY);const e=this.maxX-this.minX||1,s=this.maxY-this.minY||1,n=new Uint32Array(this.numItems);for(let i=0,o=0;i<this.numItems;i++){const r=t[o++],a=t[o++],h=t[o++],l=t[o++],c=Math.floor(65535*((r+h)/2-this.minX)/e),d=Math.floor(65535*((a+l)/2-this.minY)/s);n[i]=W(c,d)}M(n,t,this._indices,0,this.numItems-1,this.nodeSize);for(let e=0,s=0;e<this._levelBounds.length-1;e++){const n=this._levelBounds[e];for(;s<n;){const e=s;let i=t[s++],o=t[s++],r=t[s++],a=t[s++];for(let e=1;e<this.nodeSize&&s<n;e++)i=Math.min(i,t[s++]),o=Math.min(o,t[s++]),r=Math.max(r,t[s++]),a=Math.max(a,t[s++]);this._indices[this._pos>>2]=e,t[this._pos++]=i,t[this._pos++]=o,t[this._pos++]=r,t[this._pos++]=a}}}search(t,e,s,n,i){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let o=this._boxes.length-4;const r=[],a=[];for(;void 0!==o;){const h=Math.min(o+4*this.nodeSize,R(o,this._levelBounds));for(let l=o;l<h;l+=4){if(s<this._boxes[l])continue;if(n<this._boxes[l+1])continue;if(t>this._boxes[l+2])continue;if(e>this._boxes[l+3])continue;const h=0|this._indices[l>>2];o>=4*this.numItems?r.push(h):(void 0===i||i(h))&&a.push(h)}o=r.pop()}return a}neighbors(t,e,s=1/0,n=1/0,i){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let o=this._boxes.length-4;const r=this._queue,a=[],h=n*n;t:for(;void 0!==o;){const n=Math.min(o+4*this.nodeSize,R(o,this._levelBounds));for(let s=o;s<n;s+=4){const n=0|this._indices[s>>2],a=A(t,this._boxes[s],this._boxes[s+2]),l=A(e,this._boxes[s+1],this._boxes[s+3]),c=a*a+l*l;c>h||(o>=4*this.numItems?r.push(n<<1,c):(void 0===i||i(n))&&r.push(1+(n<<1),c))}for(;r.length&&1&r.peek();){if(r.peekValue()>h)break t;if(a.push(r.pop()>>1),a.length===s)break t}o=r.length?r.pop()>>1:void 0}return r.clear(),a}}function A(t,e,s){return t<e?e-t:t<=s?0:t-s}function R(t,e){let s=0,n=e.length-1;for(;s<n;){const i=s+n>>1;e[i]>t?n=i:s=i+1}return e[s]}function M(t,e,s,n,i,o){if(Math.floor(n/o)>=Math.floor(i/o))return;const r=t[n+i>>1];let a=n-1,h=i+1;for(;;){do{a++}while(t[a]<r);do{h--}while(t[h]>r);if(a>=h)break;B(t,e,s,a,h)}M(t,e,s,n,h,o),M(t,e,s,h+1,i,o)}function B(t,e,s,n,i){const o=t[n];t[n]=t[i],t[i]=o;const r=4*n,a=4*i,h=e[r],l=e[r+1],c=e[r+2],d=e[r+3];e[r]=e[a],e[r+1]=e[a+1],e[r+2]=e[a+2],e[r+3]=e[a+3],e[a]=h,e[a+1]=l,e[a+2]=c,e[a+3]=d;const u=s[n];s[n]=s[i],s[i]=u}function W(t,e){let s=t^e,n=65535^s,i=65535^(t|e),o=t&(65535^e),r=s|n>>1,a=s>>1^s,h=i>>1^n&o>>1^i,l=s&i>>1^o>>1^o;s=r,n=a,i=h,o=l,r=s&s>>2^n&n>>2,a=s&n>>2^n&(s^n)>>2,h^=s&i>>2^n&o>>2,l^=n&i>>2^(s^n)&o>>2,s=r,n=a,i=h,o=l,r=s&s>>4^n&n>>4,a=s&n>>4^n&(s^n)>>4,h^=s&i>>4^n&o>>4,l^=n&i>>4^(s^n)&o>>4,s=r,n=a,i=h,o=l,h^=s&i>>8^n&o>>8,l^=n&i>>8^(s^n)&o>>8,s=h^h>>1,n=l^l>>1;let c=t^e,d=n|65535^(c|s);return c=16711935&(c|c<<8),c=252645135&(c|c<<4),c=858993459&(c|c<<2),c=1431655765&(c|c<<1),d=16711935&(d|d<<8),d=252645135&(d|d<<4),d=858993459&(d|d<<2),d=1431655765&(d|d<<1),(d<<1|c)>>>0}class I extends w{name="CollisionDetectionPlugin";data=[];tree;update(){this.checkCollisions()}overlapPoint(t){return this.tree.search(t.x,t.y,t.x,t.y).map((t=>this.gameWorld.getGameObject(this.data[t].colliderId)?.getComponent(T))).filter((e=>e.getCenter().sub(t).magnitude()<e.radius))}checkCollisions(){let t=this.gameWorld.getComponents(T);this.tree=new O(t.length),this.data=t.map((t=>t.getAABB()));for(const e of t)e.isActive=!1;for(const t of this.data)this.tree.add(t.minX,t.minY,t.maxX,t.maxY);this.tree.finish();for(const e of t){if(e.isStatic)continue;let t=new Set;const s=e.getAABB(),n=this.tree.search(s.minX,s.minY,s.maxX,s.maxY);for(const s of n){const n=this.gameWorld.getGameObject(this.data[s].colliderId)?.getComponent(T);if(n&&e!==n){e.collides(n)&&(e.isActive=!0,n.isActive=!0,t.add(n));for(let s of t)e.collisions.has(s)||e.getComponent(T).onCollisionEnter(s);e.collisions.clear(),e.collisions=t}}}}}class j extends v{key;constructor(t){super(),this.key=t}}class N extends w{name="KeyboardPlugin";KeyDownEvent=new x;BlockedKeyDownEvent=new x;block=!1;NowPressedKeys=new Set;pressedKeys=new Set;constructor(){super(),this.pressedKeys=new Set,document.onkeydown=t=>{const e=t.key.toLowerCase();this.pressedKeys.add(e),this.NowPressedKeys.add(e)},document.onkeyup=t=>{const e=t.key.toLowerCase();this.pressedKeys.delete(e)}}isPressed(t){return this.isEnabled()&&!this.block&&this.pressedKeys.has(t)}start(){this.KeyDownEvent.register(this.gameWorld),this.BlockedKeyDownEvent.register(this.gameWorld)}update(t){this.NowPressedKeys.forEach((t=>{this.block?this.BlockedKeyDownEvent.emit(new j(t)):this.KeyDownEvent.emit(new j(t))})),this.NowPressedKeys.clear()}}var G,L=function(t,e,s,n){var i,o=arguments.length,r=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,s):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,s,n);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(r=(o<3?i(r):o>3?i(e,s,r):i(e,s))||r);return o>3&&r&&Object.defineProperty(e,s,r),r},D=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};let U=G=class extends w{cameraPositon=new i(4,0);targetCameraPositon=new i(4,0);cameraScreenOffset=new i(100,100);followingSpeed=.02;isFollowing=!0;scaleV=new i(20,-20);scale=20;targetId="None";targetScale=40;name="CameraPlugin";start(){this.getPlugin(C).mouseScrollYEvent.subscribe(this,"scroll"),this.getPlugin(C).mouseDownEvent.subscribe(this,"down"),this.getPlugin(C).mouseUpEvent.subscribe(this,"up")}event(t,e){if("scroll"==e){const e=t;this.zoom(e.delta)}else if("down"==e){if(1!=t.button)return;if(this.gameWorld.getGameObject(this.targetId))return void(this.targetId="None");const e=this.getPlugin(C).getMouseScreenPosition(),s=this.getWorldPosition(e);let n=this.getPlugin(I).overlapPoint(s)[0]?.getGameObject();n&&(this.targetId=n.getId())}}zoom(t){(t=Math.sign(t))>0&&.9*this.targetScale>10&&(this.targetScale=.9*this.targetScale),t<0&&1.1*this.targetScale<100&&(this.targetScale=1.1*this.targetScale)}getWorldPosition(t){let e=this.getPlugin(G).scaleV,s=this.getPlugin(G).cameraPositon;return new i((t.x-this.cameraScreenOffset.x)/e.x,(t.y-this.cameraScreenOffset.y)/e.y).add(s)}update(t){this.isFollowing&&(this.cameraPositon=this.cameraPositon.interpolate(this.targetCameraPositon,Math.pow(this.followingSpeed,t))),this.scale+=(this.targetScale-this.scale)*(1-Math.pow(.002,t)),this.scaleV=new i(this.scale,-this.scale);const e=this.gameWorld.getGameObject(this.targetId);if(e){const s=this.getPlugin(C).getMouseScreenPosition(),n=this.getWorldPosition(s);e.getTransform().position=e.getTransform().position.interpolate(n,Math.pow(.001,t)),this.getPlugin(N).isPressed("2")&&(e.getTransform().rotation+=1.57*t),this.getPlugin(N).isPressed("1")&&(e.getTransform().rotation-=1.57*t)}}getscale(){return new g(!0,this.scaleV.toString(),this.scaleV)}follow(t){return this.isFollowing=t,new g(!0,"Camera is "+(t?"following":"not following"),void 0)}setzoom(t){return this.targetScale=t,new g(!0,`Camera zoom set to ${t}`,void 0)}};L([m("getscale",void 0,"number"),D("design:type",Function),D("design:paramtypes",[]),D("design:returntype",g)],U.prototype,"getscale",null),L([m("follow","<following: boolean>"),D("design:type",Function),D("design:paramtypes",[Boolean]),D("design:returntype",g)],U.prototype,"follow",null),L([m("zoom","<zoom: number>"),D("design:type",Function),D("design:paramtypes",[Number]),D("design:returntype",g)],U.prototype,"setzoom",null),U=G=L([f("camera")],U);class F extends s{zindex;constructor(t=0){super(),this.zindex=t}}class q extends F{color=new r(42,42,55);text;displayName;constructor(t,e=!1,s=1){super(),this.text=t,this.zindex=s,this.displayName=e}render(t){const e=this.getGameWorld().getPlugin(U).cameraScreenOffset,s=this.getTransform().position.x,n=this.getTransform().position.y,i=(this.getTransform().rotation,this.getTransform().scale),o=this.getGameWorld().getPlugin(U).scaleV,r=this.getGameWorld().getPlugin(U).cameraPositon.x,a=this.getGameWorld().getPlugin(U).cameraPositon.y,h=this.color.toString(),l=s-r,c=n-a;t.fillStyle=h,t.translate(e.x,e.y),t.scale(o.x,o.y),t.translate(l,c),t.scale(i.x,i.y),t.scale(1,-1);const d=this.displayName?this.getGameObject().name:this.text;t.font="bold 1px Arial",t.fillStyle="azure",t.shadowBlur=10;const u=t.measureText(d).width/2;t.strokeText(d,-u,1/4),t.fillText(d,-u,1/4),t.shadowBlur=0,t.setTransform(1,0,0,1,0,0)}}class V extends w{name="ConfigPlugin";config=new Map([["bulletSize",.75],["playerSize",2.5],["bulletColor",new r(56,57,60)],["playerColor",new r(122,111,62)],["playerColor",new r(80,37,36)],["playerColor",new r(59,94,76)],["playerColor",new r(129,49,54)],["playerColor",new r(130,111,51)]]);get(t){if(this.config.has(t))return this.config.get(t)}set(t,e){this.config.set(t,e)}}class z extends F{activeColor=new r(172,42,55,.125);staticColor=new r(95,64,36,.125);dynamicColor=new r(57,127,31,.125);disabledColor=new r(36,24,36,.125);constructor(t=-1){super(),this.zindex=t}getColor(){let t=this.dynamicColor,e=this.getComponent(T);return e.isEnabled()?e.isActive?t=this.activeColor:e.isStatic&&(t=this.staticColor):t=this.disabledColor,t}render(t){if(!this.getPlugin(V)?.get("displayColliders"))return;const e=this.getComponent(T),s=e.offset,n=e.radius,i=e.radius+.25,o=this.getColor(),r=this.getGameWorld().getPlugin(U).cameraScreenOffset,a=this.getTransform().position.x+s.x,h=this.getTransform().position.y+s.y,l=this.getTransform().rotation,c=this.getGameWorld().getPlugin(U).scaleV,d=a-this.getGameWorld().getPlugin(U).cameraPositon.x,u=h-this.getGameWorld().getPlugin(U).cameraPositon.y;t.save(),t.translate(r.x,r.y),t.scale(c.x,c.y),t.translate(d,u),t.rotate(l),t.strokeStyle=o.toRgb().toString(),t.fillStyle=o.toString(),t.shadowBlur=30,t.beginPath(),t.arc(0,0,i,0,2*Math.PI),t.closePath(),t.fill(),t.stroke(),t.beginPath(),t.arc(0,0,n,0,2*Math.PI),t.closePath(),t.lineWidth=.1,t.stroke(),t.restore()}}class ${progress=-1;duration=.25;startAnimation=()=>{};endAnimation=()=>{};updateAnimation=()=>{};constructor(t=()=>{},e=()=>{},s=()=>{}){this.updateAnimation=t,this.startAnimation=e,this.endAnimation=s}update(t){if(this.progress>0){let e=(this.duration-this.progress)/this.duration;this.progress-=t,this.updateAnimation(e)}else-1!=this.progress&&(this.endAnimation(),this.progress=-1)}start(){-1==this.progress?(this.startAnimation(),this.progress=this.duration):this.progress=(this.duration+this.progress)/2}}class H extends s{tickCount=0;tick(t){0==this.tickCount?this.start():this.update(t),this.tickCount++}start(){}update(t){}}class K extends H{shrinkAnimation=new $;zoomAnimation=new $;defaultZoom=new i(1,1);constructor(){super(),this.shrinkAnimation=new $((t=>this.getTransform().scale=this.defaultZoom.times(1-t)),(()=>this.getComponent(Q)?.enable(!1)),(()=>this.getGameObject().destroy())),this.zoomAnimation=new $((t=>this.getTransform().scale=this.defaultZoom.times(1+Math.sin(Math.PI*t)/5)),(()=>this.defaultZoom=this.getTransform().scale.clone()),(()=>this.getTransform().scale=this.defaultZoom))}update(t){this.shrinkAnimation.update(t),this.zoomAnimation.update(t)}startZoom(){this.zoomAnimation.start()}startShrink(){this.shrinkAnimation.start()}}class Y extends F{color;radius;n;constructor(t,e=4,s=0,n=r.randomColor2()){super(),this.radius=t,this.n=e,this.zindex=s,this.color=n}render(t){const e=this.getGameWorld().getPlugin(U).cameraScreenOffset,s=this.getTransform().position.x,n=this.getTransform().position.y,i=this.getTransform().rotation,o=this.getTransform().scale,r=this.getGameWorld().getPlugin(U).scaleV,a=this.getGameWorld().getPlugin(U).cameraPositon.x,h=this.getGameWorld().getPlugin(U).cameraPositon.y,l=this.color.toString(),c=s-a,d=n-h;t.translate(e.x,e.y),t.scale(r.x,r.y),t.translate(c,d),t.rotate(i),t.scale(o.x,o.y);const u=this.radius;if(this.n<10){t.beginPath(),t.moveTo(0,u);const e=2*Math.PI/this.n;for(let s=1;s<this.n;s++)t.lineTo(Math.sin(s*e)*u,Math.cos(s*e)*u);t.closePath()}else t.beginPath(),t.arc(0,0,u,0,2*Math.PI),t.closePath();t.fillStyle=l,t.shadowBlur=0,t.fill(),t.shadowBlur=50,t.stroke(),t.shadowBlur=0,t.setTransform(1,0,0,1,0,0)}}class X extends v{damage;participant;constructor(t,e){super(),this.damage=t,this.participant=e}}class J extends s{health;maxHealth;damageEvent;constructor(t,e=t){super(),this.health=e,this.maxHealth=t,this.damageEvent=new x}start(){this.damageEvent.register(this.getGameWorld()),this.getComponent(T).onCollisionEnterEvent.subscribe(this,"onCollisionEnter")}event(t){let e=t;this.onCollisionEnter(e.collider)}onCollisionEnter(t){let e=t.getGameObject(),s=e.getComponent(o),n=this.getComponent(o),i=n.mass/(s.mass+n.mass);n.mass<s.mass&&(s.velocity=s.velocity.add(n.velocity.times(i)).times(.5),n.velocity=n.velocity.add(s.velocity.times(1-i).times(.5))),s.angularVelocity+=this.getTransform().position.sub(e.getTransform().position).vectorProduct(n.velocity)*(i/15);try{const t=e.getComponent(J),s=Math.min(t.health,this.health);if(0==s)return;this.onDamage(s,t),t.onDamage(s,this)}catch{}}getHealth(){return this.health/this.maxHealth}heal(t){this.health=Math.min(this.maxHealth,this.health+t)}onDamage(t,e){if(this.health-=t,this.damageEvent.emit(new X(t,e)),0==this.health){if(this.getComponent(T)?.enable(!1),this.getComponent(o).dampingFactor=.6,this.getComponent(K)?.startShrink(),e.hasComponent(Y)){let t=this.getComponent(Y).color.blend(e.getComponent(Y).color.toRgb(),.5).toRgb();this.getComponent(Y).color=t,e.getComponent(Y).color=t}}else this.getComponent(K)?.startZoom()}}class Q extends F{offset=new i(0,4);fill=.5;width=5;height=.5;constructor(t=0){super(t)}render(t){let e=this.width,s=this.fill;try{s=this.getComponent(J).getHealth(),e=2+this.getComponent(J).maxHealth/250}catch{}if(s>=1||s<=0)return;const n=this.getTransform().position.x,i=this.getTransform().position.y,o=this.getTransform().scale,a=this.getGameWorld().getPlugin(U).scaleV,h=this.getGameWorld().getPlugin(U).cameraScreenOffset,l=this.getGameWorld().getPlugin(U).cameraPositon.x,c=this.getGameWorld().getPlugin(U).cameraPositon.y,d=r.getHeatmapColor(s).toString(),u=n-l,p=i-c,g=.25;t.translate(h.x,h.y),t.scale(a.x,a.y),t.translate(u,p),t.scale(o.x,o.y),t.translate(this.offset.x,this.offset.y),t.fillStyle=d,t.shadowBlur=0,t.beginPath(),t.roundRect(-e/2,-this.height/2,e,this.height,g),t.closePath(),t.fillStyle=r.background.toString(),t.fill(),t.beginPath(),t.roundRect(-e/2,-this.height/2,e*s,this.height,g),t.closePath(),t.fillStyle=d,t.fill(),t.beginPath(),t.roundRect(-e/2,-this.height/2,e,this.height,g),t.closePath(),t.shadowBlur=30,t.stroke(),t.beginPath(),t.roundRect(-e/2,-this.height/2,e*s,this.height,g),t.closePath(),t.shadowBlur=0,t.stroke(),t.setTransform(1,0,0,1,0,0)}}class Z extends w{name="SchedulerPlugin";schedule=[];addInvoke(t,e,s){let n=new WeakRef(t);this.schedule.push({totalTime:e,subscriber:n,topic:s}),this.schedule.sort(((t,e)=>e.totalTime-t.totalTime))}update(t){const e=this.gameWorld.getWorldTime();if(0!=this.schedule.length)for(;0!=this.schedule.length&&this.schedule[this.schedule.length-1].totalTime<=e;){let t=this.schedule.pop();t.subscriber.deref()?.onInvoke(t.topic)}}}class tt extends s{lifeTime;constructor(t=1){super(),this.lifeTime=t}onInvoke(t){this.getComponent(K)?.startShrink()}start(){let t=this.getGameWorld().getWorldTime()+this.lifeTime;this.getGameWorld().getPlugin(Z).addInvoke(this,t,"destroy")}}class et extends F{color;radius;constructor(t,e=0,s=r.randomColor2()){super(),this.radius=t,this.zindex=e,this.color=s}render(t){const e=this.getGameWorld().getPlugin(U).cameraScreenOffset,s=this.getTransform().position.x,n=this.getTransform().position.y,i=this.getTransform().rotation,o=this.getTransform().scale,a=this.getGameWorld().getPlugin(U).scaleV,h=this.getGameWorld().getPlugin(U).cameraPositon.x,l=this.getGameWorld().getPlugin(U).cameraPositon.y,c=this.color.toString(),d=s-h,u=n-l;t.translate(e.x,e.y),t.scale(a.x,a.y),t.translate(d,u),t.rotate(i),t.scale(o.x,o.y);const p=this.radius;t.beginPath(),t.rect(-3*p-4,-p,4,2*p),t.closePath();const g=t.createLinearGradient(-3*p-4,0,4,0);g.addColorStop(0,this.color.blend(new r(255,255,255),.5).toArgb(0).toString()),g.addColorStop(1,this.color.toArgb(.75).toString()),t.fillStyle=g,t.shadowBlur=0,t.fill(),t.beginPath(),t.arc(0,0,p,0,2*Math.PI),t.closePath(),t.fillStyle=c,t.shadowBlur=0,t.fill(),t.shadowBlur=50,t.stroke(),t.beginPath(),t.roundRect(-3*p,-p,3*p,2*p,p/2),t.closePath(),t.fillStyle=this.color.blend(r.background,1).toString(),t.shadowBlur=0,t.fill(),t.shadowBlur=50,t.stroke(),t.setTransform(1,0,0,1,0,0)}}class st extends s{ownerId;constructor(t){super(),this.ownerId=t.getId()}getOwner(){return this.getGameWorld().getGameObject(this.ownerId)}static bulletGO(t,e=30,s=.65,n=1,i=-1,...a){let h=new p(new o(.05,1),new et(s,i,new r(173,87,87)),new Y(s,10,i,new r(173,87,87)),new T(s,!1),new z,new J(e),new K,new tt(n),new st(t),...a);return h.getTransform().rotation=0,h.name="Bullet",h.getComponent(Y).enable(!1),h}}class nt extends F{color;constructor(t=0,e=r.background.clone()){super(),this.zindex=t,this.color=e}render(t){const e=this.getComponent(rt).length,s=this.getComponent(rt).width,n=this.getTransform().position.x,i=this.getTransform().position.y,o=this.getTransform().scale,r=this.getGameWorld().getPlugin(U).scaleV,a=this.getGameWorld().getPlugin(U).cameraScreenOffset,h=this.getGameWorld().getPlugin(U).cameraPositon.x,l=this.getGameWorld().getPlugin(U).cameraPositon.y,c=this.color.toString(),d=(this.getComponent(Y).color.toString(),n-h),u=i-l,p=this.getComponent(rt),g=Math.min(1,p.getShotDelta()/p.cooldown),m=Math.sin(g*Math.PI),f=(p.range,p.direction.times(p.bulletSpeed).times(p.getBulletLifetime()).add(p.getGlobalOffset()));t.save(),t.globalCompositeOperation="lighter",t.translate(a.x,a.y),t.scale(r.x,r.y),t.translate(d,u),t.scale(o.x,o.y),t.rotate(p.direction.toRad()),t.translate((1-m/3)*e,0);const y=t.createRadialGradient(0,0,0,0,0,5*(1-g));y.addColorStop(0,"rgba(219, 144, 31, 0.25)"),y.addColorStop(1,"rgba(58, 40, 12, 0)"),t.fillStyle=y,t.shadowBlur=0,t.beginPath(),t.arc(0,0,20,0,2*Math.PI),t.closePath(),t.fill(),t.restore(),t.translate(a.x,a.y),t.scale(r.x,r.y),t.translate(d,u),t.translate(f.x,f.y),t.beginPath(),t.arc(0,0,1,0,2*Math.PI),t.closePath(),t.shadowBlur=0,t.stroke(),t.strokeRect(-.5,-.5,1,1),t.setTransform(1,0,0,1,0,0),t.translate(a.x,a.y),t.scale(r.x,r.y),t.translate(d,u),t.scale(o.x,o.y),t.rotate(p.direction.toRad()),t.beginPath(),t.roundRect(0,-s/2,(1-m/3)*e,s,.1),t.closePath(),t.fillStyle=c,t.shadowBlur=0,t.fill(),t.shadowBlur=30,t.stroke(),t.shadowBlur=0,t.setTransform(1,0,0,1,0,0)}}class it{x;y;dx;dy;radius;targetRadius;color;alpha;constructor(t,e,s,n,i){this.x=t,this.y=e,this.dx=0,this.dy=0,this.radius=0,this.targetRadius=s,this.color=n,this.alpha=i}}class ot extends F{color;radius;n;particles=[];constructor(t,e=4,s=0,n=r.randomColor2()){super(),this.radius=t,this.n=e,this.zindex=s,this.color=n}start(){}emitParticles(t=1,e=new i(0,0),s=new i(0,0)){for(let i=0;i<t;i++){const t=2*Math.random()*Math.PI,i=1*(.5*Math.random()+.5),r=i*Math.cos(t)+this.getTransform().position.x+e.x,a=i*Math.sin(t)+this.getTransform().position.y+e.y,h=.25*this.radius+.15*this.radius*n.symRand(1),l=.5*Math.random()+.5,c=new it(r,a,h,this.color,l);c.dx=this.getComponent(o)?.velocity.x??0,c.dy=this.getComponent(o)?.velocity.y??0,c.dx+=s.x,c.dy+=s.y,this.particles.push(c)}}updateParticles(t){for(const e of this.particles)e.x+=e.dx*t,e.y+=e.dy*t,e.dx+=(Math.random()-.5)*t*50,e.dy+=(Math.random()-.5)*t*50,e.dx*=Math.pow(.1,t),e.dy*=Math.pow(.1,t),e.alpha-=t/1,e.radius+=(e.targetRadius-e.radius)*(1-Math.pow(.025,t)),e.alpha<=0&&this.particles.splice(this.particles.indexOf(e),1)}render(t,e){this.updateParticles(e),i.one();const s=this.getGameWorld().getPlugin(U).cameraScreenOffset,n=this.getGameWorld().getPlugin(U).scaleV,o=0-this.getGameWorld().getPlugin(U).cameraPositon.x,a=0-this.getGameWorld().getPlugin(U).cameraPositon.y;t.translate(s.x,s.y),t.scale(n.x,n.y),t.translate(o,a);for(const e of this.particles)t.beginPath(),t.arc(e.x,e.y,e.radius,0,2*Math.PI),t.closePath(),t.fillStyle=e.color.toString(),t.globalAlpha=e.alpha,t.shadowColor=e.color.toString(),t.shadowBlur=10,t.fill(),t.globalAlpha=1;t.shadowBlur=0,t.shadowColor=r.stroke.toString(),t.setTransform(1,0,0,1,0,0)}}class rt extends H{damage;cooldown=.25;bulletSpeed=40;length;width;range=250;bulletSpraed=.05;offset;direction=i.right();targetDirection=i.right();lastShootTime=-10;constructor(t=4,e=2,s=10){super(),this.damage=s,this.length=t,this.width=e,this.offset=new i(t-this.width,0)}getShotDelta(){return this.getGameWorld().getWorldTime()-this.lastShootTime}update(t){let e=this.direction.toRad(),s=this.targetDirection.toRad();e+=9*t*n.deltaAngle(e,s),this.direction=i.fromRad(e)}getBulletLifetime(){return this.range/this.bulletSpeed}getGlobalOffset(){return this.direction.toUnit().times(this.offset.x).add(this.direction.cross().times(this.offset.y))}shoot(){if(this.isEnabled&&this.getGameObject().enabled&&this.getShotDelta()>=this.cooldown){const t=.125,e=this.getComponent(nt).zindex-.01,s=this.direction.cross().times(2*Math.random()*this.bulletSpraed-this.bulletSpraed),i=this.direction.toUnit().add(s).toUnit(),r=this.getGlobalOffset();let a=st.bulletGO(this.getGameObject(),this.damage,this.width/2+n.symRand(t)-this.width/6,this.getBulletLifetime(),e);const h=a.getComponent(o),l=a.getComponent(T);a.getComponent(Y).color=this.getComponent(Y).color.clone(),a.getComponent(et).color=this.getComponent(Y).color.clone(),l.avoidObjectes.add(this.getGameObject()),h.velocity=i.times(this.bulletSpeed),a.getTransform().position=this.getTransform().position.add(r),this.getComponent(ot)?.emitParticles(23,r,this.direction.cross().times(this.bulletSpeed/7).add(this.direction.times(this.bulletSpeed/3))),this.getComponent(ot)?.emitParticles(23,r,this.direction.cross().times(-this.bulletSpeed/7).add(this.direction.times(this.bulletSpeed/3))),a.getTransform().rotation=i.toRad(),a.spawn(this.getGameWorld()),this.lastShootTime=this.getGameWorld().getWorldTime()}}}class at extends F{color;constructor(t=0,e=new r(22,24,25)){super(),this.zindex=t,this.color=e}render(t){const e=this.getGameWorld().getPlugin(U).cameraScreenOffset,s=this.getTransform().position.x,n=this.getTransform().position.y,i=this.getTransform().rotation,o=this.getTransform().scale,a=this.getGameWorld().getPlugin(U).scaleV,h=this.getGameWorld().getPlugin(U).cameraPositon.x,l=this.getGameWorld().getPlugin(U).cameraPositon.y,c=(this.color.toString(),s-h),d=n-l;t.translate(e.x,e.y),t.scale(a.x,a.y),t.translate(c,d),t.rotate(i),t.scale(o.x,o.y),t.beginPath(),t.fillStyle=this.getComponent(Y).color.toString(),t.shadowBlur=0,t.roundRect(-4,-2,8,4,1),t.fill(),t.shadowBlur=50,t.stroke(),t.closePath(),t.beginPath(),t.fillStyle=r.background.toString(),t.shadowBlur=0,t.roundRect(-4.5,-3.25,10,2,.5),t.fill(),t.shadowBlur=50,t.stroke(),t.closePath(),t.beginPath(),t.shadowBlur=0,t.roundRect(-4.5,1.25,10,2,.5),t.fill(),t.shadowBlur=50,t.stroke(),t.closePath(),t.beginPath(),t.fillStyle=r.background.toString(),t.shadowBlur=0,t.roundRect(-3,-2,6,4,1.5),t.fill(),t.shadowBlur=50,t.stroke(),t.closePath(),t.shadowBlur=0,t.setTransform(1,0,0,1,0,0)}}class ht extends F{color;tracesSpace=.5;traces=[];lastPosition=void 0;transparency=2;duration=1;length=2;constructor(t=0,e=new r(66,83,68)){super(),e=e.blend(r.stroke,.3),this.zindex=t,this.color=e}render(t){const e=this.getGameWorld().getPlugin(U).cameraScreenOffset,s=this.getGameWorld().getPlugin(U).scaleV,n=this.getGameWorld().getPlugin(U).cameraPositon.x,i=this.getGameWorld().getPlugin(U).cameraPositon.y,o=this.getTransform().position.clone(),r=this.getTransform().rotation;null==this.lastPosition&&(this.lastPosition=o.clone());let a=o.sub(this.lastPosition);for(;a.magnitude()>this.tracesSpace;)this.traces.push({position:this.lastPosition,rotation:r,startTime:this.getGameWorld().getWorldTime()}),this.lastPosition=this.lastPosition.add(a.toUnit().times(this.tracesSpace)),a=o.sub(this.lastPosition);for(;this.traces.length>0&&this.traces[0].startTime+this.duration<this.getGameWorld().getWorldTime();)this.traces.shift();for(const o of this.traces){const r=o.position.x-n,a=o.position.y-i,h=1-(this.getGameWorld().getWorldTime()-o.startTime)/this.duration;t.translate(e.x,e.y),t.scale(s.x,s.y),t.translate(r,a),t.rotate(o.rotation),t.beginPath(),t.fillStyle=this.color.toArgb(this.color.a*this.transparency*h).toString(),t.shadowBlur=0,t.roundRect(-4.5,-3.25,this.length,2,.75),t.fill(),t.closePath(),t.beginPath(),t.roundRect(-4.5,1.25,this.length,2,.75),t.fill(),t.closePath(),t.setTransform(1,0,0,1,0,0)}}}class lt extends s{tags=new Set;constructor(...t){super(),t.forEach((t=>this.addTag(t)))}addTag(t){this.tags.add(t)}removeTag(t){this.tags.delete(t)}hasTag(t){return this.tags.has(t)}getTags(){return Array.from(this.tags)}}class ct{static polygonGO(t=2,e=3,...s){let i=new p(new o(.1),new Y(t,e,0,r.randomColor2().toArgb(.75)),new Q(.1),new T(n.getColliderRadius(e,t)),new z,new J(25*e),new K,new lt("Dragable"),...s);return i.getTransform().rotation=2*Math.random()*Math.PI,i.name="Polygon",i}static enemyGO(t=2.5,e="",s=4,...r){let a=new p(new q(e,void 0,s+.1),new Y(t,8,s),new Q(s+.1),new at(s-.2),new o(30),new T(t,!1),new z(s-.15),new J(1500),new K,new ht(-21.37),...r);return a.getTransform().rotation=n.symRand(Math.PI),a.getComponent(rt).targetDirection=i.fromRad(n.symRand(Math.PI)),a.name="Enemy",a}static bulletGO(t,e=30,s=.65,n=1,i=-1,...a){let h=new p(new o(.05,1),new Y(s,10,i,new r(173,87,87)),new T(s,!1),new z,new J(e),new K,new tt(n),new st(t),...a);return h.getTransform().rotation=0,h.name="Bullet",h}static playerGO(t=2.5,e=5,...s){let n=new p(new at(e-.2),new Y(t,10,e,new r(50,99,52)),new q("Player",!0,e+.1),new z(e-.15),new Q(e+.1),new nt(e-.1),new o(30,.025),new T(t,!1),new J(1e3),new K,new rt(7,1.35,44),new ht(-21.37),...s);return n.getTransform().rotation=0,n.name="Player",n}}class dt extends w{name="ProfilerPlugin";size=250;isVisible=!0;profilerWrapper=document.createElement("div");usage=new Map;constructor(){super()}start(){this.getPlugin(N).KeyDownEvent.subscribe(this,"keydown"),document.body.appendChild(this.profilerWrapper),this.addRecord("Fps",0)}lastTime=performance.now();frames=0;fpsHistory=[];update(t){const e=1/t;this.addRecord("Fps",e),this.frames++;const s=performance.now();if(s-this.lastTime>=250){this.fpsHistory.push(4*this.frames),this.fpsHistory.length>100&&this.fpsHistory.shift(),this.frames=0,this.lastTime=s;let t=0,e=[];for(const s of this.usage){let n=s[0],i=s[1].length,o=0;for(const t of s[1])o+=t;o/=i,t++,e.push(`${n}: `+o.toFixed(2).toString())}this.profilerWrapper.innerHTML=this.getInnerHtml(e)}}event(t,e){"keydown"==e&&"p"==t.key&&(this.isVisible=!this.isVisible)}addRecord(t,e){if(this.usage.has(t)){let s=this.usage.get(t);s.length>=this.size?(s.shift(),s.push(e)):s.push(e)}else this.usage.set(t,[e])}getChartHtml(t){t=t.slice(Math.max(0,t.length-100),t.length);let e='<div class="profiler-chart">';for(let s=0;s<t.length;s++)e+=`<div class="profiler-chart-item" style="height: ${t[s]/200*100}px"></div>`;return e+="</div>",e}getElementsHtml(t){let e="";for(let s=0;s<t.length;s++)s>0&&(e+='<hr class="profiler-item-separator">'),e+=`<div class="profiler-item">\n                <span class="profiler-item-key">${t[s].split(": ")[0]}:</span>\n                <span class="profiler-item-value">${t[s].split(": ")[1]}</span>\n            </div>`;return e}getInnerHtml(t){return`\n            <style>\n                .profiler{\n                    ${this.isVisible?"":"display: none;"}\n                    position: fixed;\n                    top: 20px;\n                    left: 20px;\n                    \n                    width: 400px;\n                    padding: 20px;\n                    border-radius: 20px;\n                    background-color: rgba(42, 43, 46, 0.382);\n                    color: white;\n                    pointer-events: none;\n                }\n                .profiler-header{\n                    font-size: 20px;\n                    font-weight: bold;\n                    color: white;\n                    margin-bottom: 10px;\n                }\n                .profiler-item{\n                    // display: flex;\n                    // justify-content: space-between;\n                    padding: 5px 0;\n                    color:rgba(240, 240, 240, 0.85)\n                }\n                .profiler-item-key{\n                    margin-right: 10px;\n                }\n                .profiler-item-value{\n                    color: #f0f0f0;\n                }\n                .profiler-item-separator{\n                    border: none;\n                    border-top: 1px dashed gray;\n                    opacity: 0.75;\n                    margin: 2px 0;\n                }\n                .profiler-chart{\n                    display: flex;\n                    flex-direction: row;\n                    justify-content: space-between;\n                    align-items: flex-end;\n                    height: 100px;\n                    width: 100%;\n                    margin-bottom: 10px;\n                    border-radius: 10px;\n                    overflow: hidden;\n                    opacity: 0.25;\n                }\n                .profiler-chart-item{\n                    background-color: rgb(240, 240, 240);\n                    width: 100%;\n                    margin: 0;\n                }\n            </style>\n\n            <div class="profiler">\n                <div class="profiler-header">\n                    <h2 style="margin: 0">Profiler <span style="opacity: 0.5">[P]</span></h2>\n                </div>\n                ${this.getChartHtml(this.fpsHistory)}\n                ${this.getElementsHtml(t)}\n            </div>\n            `}}class ut{startTime=0;prevWorldTime=0;worldTime=0;tickCount=0;gameObjects=new Map;plugins=new Map;events=new Set;componentsToStart=[];constructor(...t){for(let e of t){let t=e.constructor.name;if(this.plugins.has(t))throw new Error(`Plugin ${t} already exists in the game object`);e.gameWorld=this,this.plugins.set(t,e)}}getPlugin(t){const e=t.name;return this.getPluginByName(e)}getPluginByName(t){if(!this.plugins.has(t))throw new Error(`Plugin ${t} does not exist in the game world`);return this.plugins.get(t)}getAllPlugins(){return Array.from(this.plugins.values())}hasPlugin(t){const e=t.name;return this.plugins.has(e)}isSpawned(t){return this.gameObjects.has(t.getId())}spawn(t){if(this.gameObjects.has(t.getId()))throw new Error(`GameObject ${t.name} already exists in the game world`);return t.gameWorld=this,this.gameObjects.set(t.getId(),t),t.getAllComponents().forEach((t=>this.componentsToStart.push(new WeakRef(t)))),t}destroy(t){if(!this.gameObjects.has(t.getId()))throw new Error(`GameObject ${t.name} does'not exist in the game world`);t.enabled=!1,this.gameObjects.delete(t.getId())}getGameObject(t){return this.gameObjects.get(t)}getAllGameObjects(t=!0){return Array.from(this.gameObjects.values()).filter((e=>e.enabled||!t))}getComponents(t,e=!0){return this.getAllGameObjects().filter((s=>s.hasComponent(t)&&(s.getComponent(t).isEnabled()||!e))).map((e=>e.getComponent(t)))}getAllComponents(t=!0){return Array.from(this.getAllGameObjects(t)).flatMap((t=>t.getAllComponents()))}registerEvent(t){this.events.add(new WeakRef(t))}getWorldTime(){return this.worldTime/1e3}tick(){this.tickCount++,1==this.tickCount?this.startWorld():this.updateWorld(),this.startComponents(),this.invokeEvents()}startComponents(){for(let t of this.componentsToStart){const e=t.deref();e&&e.start()}this.componentsToStart=[]}startWorld(){this.startTime=performance.now(),this.Start(),this.plugins.forEach((t=>t.start()))}updateWorld(){this.worldTime=performance.now()-this.startTime;const t=this.worldTime-this.prevWorldTime;this.prevWorldTime=this.worldTime,this.Update(t/1e3),this.plugins.forEach((e=>{if(!e.isEnabled())return;let s=performance.now();e.update(t/1e3),this.getPlugin(dt).addRecord(e.name,performance.now()-s)}))}invokeEvents(){let t=performance.now();for(const t of this.events){const e=t.deref();e?e.invoke():this.events.delete(t)}this.getPlugin(dt).addRecord("Events",performance.now()-t)}Start(){}Update(t){}}var pt;!function(t){t[t.neutral=0]="neutral",t[t.passive=1]="passive",t[t.aggresive=2]="aggresive"}(pt||(pt={}));class gt extends H{type=pt.aggresive;isAttacing=!1;targetId="None";isFollowing=!1;minDistance=35;maxDistance=1e3;maxSpeed=10;start(){this.getComponent(J).damageEvent.subscribe(this)}event(t){const e=t.participant;e.hasComponent(st)&&e.getComponent(st).getOwner()&&this.attack(e.getComponent(st).getOwner())}attack(t){this.isAttacing=!0,this.targetId=t.getId(),this.isFollowing=!0}update(t){let e=this.getGameWorld().getGameObject(this.targetId);if(e){if(this.isAttacing){let s=this.getComponent(rt),r=e.getTransform().position.sub(this.getTransform().position);s.targetDirection=r;let a=r.magnitude();if(a>this.maxDistance&&(this.isAttacing=!1),s.shoot(),a>=this.minDistance){let e=this.getTransform().rotation,s=r.toRad();e+=5*t*n.deltaAngle(e,s),this.getTransform().rotation=e,this.getComponent(o).velocity=i.fromRad(e).times(this.maxSpeed)}}}else this.isAttacing=!1}}class mt extends ut{Start(){console.log("Hello, MyWorld!");const t=350;for(let e=0;e<350;e++){const e=3+n.symRand(.25);let s=ct.polygonGO(e/2,4);s.getTransform().position=i.randomPos(t),s.getComponent(o).angularVelocity=2*Math.random()-1,this.spawn(s)}for(let e=0;e<150;e++){const e=3.5+n.symRand(.25);let s=ct.polygonGO(e/2,3);s.getTransform().position=i.randomPos(t),s.getComponent(o).angularVelocity=2*Math.random()-1,this.spawn(s)}for(let e=0;e<250;e++){const e=4+n.symRand(.25);let s=ct.polygonGO(e/2,Math.round(3*Math.random())+5);s.getTransform().position=i.randomPos(t),s.getComponent(o).angularVelocity=2*Math.random()-1,this.spawn(s)}for(let e=0;e<25;e++){let s=ct.enemyGO(2.5,"Enemy nr."+e,4,new rt(void 0,void 0,10+5*Math.random()),new nt(3.9),new gt);s.getTransform().position=i.randomPos(t),s.spawn(this)}}Update(t){}}class ft extends F{image=new Image;side;offset;constructor(t=i.zero(),e=i.zero(),s="GameEngine/src/Assets/vectorpaint3.svg",n=0){super(),this.zindex=n,this.side=t,this.offset=e,this.image.src=s}render(t){const e=this.getGameWorld().getPlugin(U).cameraScreenOffset,s=this.getTransform().position.x,n=this.getTransform().position.y,i=this.getTransform().rotation,o=this.getTransform().scale,r=this.getGameWorld().getPlugin(U).scaleV,a=s-this.getGameWorld().getPlugin(U).cameraPositon.x,h=n-this.getGameWorld().getPlugin(U).cameraPositon.y;let l=this.side;0==l.x&&(l.x=this.image.width),0==l.y&&(l.y=this.image.height),t.translate(e.x,e.y),t.scale(r.x,r.y),t.translate(a,h),t.rotate(i),t.scale(o.x,o.y),t.translate(this.offset.x,this.offset.y),t.shadowBlur=15,t.drawImage(this.image,-l.x/2,-l.y/2,l.x,l.y),t.shadowBlur=0,t.setTransform(1,0,0,1,0,0)}}class yt extends w{name="RendererPlugin";context;renderDistance=150;constructor(t){super(),this.context=t}addVignetteEffect(t,e){const s=t.canvas.width/2,n=t.canvas.height/2,i=Math.sqrt(s*s+n*n),o=t.createRadialGradient(s,n,0,s,n,i);o.addColorStop(.025,"rgba(0, 0, 0, 0)"),o.addColorStop(1,e),t.fillStyle=o,t.fillRect(0,0,t.canvas.width,t.canvas.height)}gridCanvas=[];start(){this.context.imageSmoothingEnabled=!0,this.context.strokeStyle="rgb(43,43,44)",this.context.lineWidth=.175,this.context.lineJoin="round",this.context.shadowColor="rgba(0, 0, 0, 0.75)",this.context.fillStyle="#716f6b",this.context.fillStyle="rgb(85, 106, 86)",this.context.fillStyle="rgb(66, 85, 68)";let e=new Worker(new URL(t.p+t.u(703),t.b),{type:"module"});for(let t=0;t<10;t++){this.gridCanvas[t]=document.createElement("canvas"),this.gridCanvas[t].width=3440,this.gridCanvas[t].height=1440,document.createElement("canvas");const s=this.gridCanvas[t].transferControlToOffscreen();e.postMessage({canvas:s,args:[new i(2,2),.175,r.stroke.toString(),new i(5*t+5,5*t+5)]},[s])}}clip(t){const e=this.context.canvas.width,s=this.context.canvas.height,n=this.getPlugin(U).scaleV,i=this.getPlugin(U).cameraPositon,o=Math.abs(e/2/n.x),r=Math.abs(s/2/n.y);return Math.abs(t.x-i.x)>o||Math.abs(t.y-i.y)>r}update(t){const e=this.context.canvas.width,s=this.context.canvas.height;this.context.fillStyle="rgba(80, 100, 81, 1)",this.context.fillRect(0,0,e,s),this.getPlugin(U).cameraScreenOffset=new i(this.context.canvas.width/2,this.context.canvas.height/2);const n=this.getPlugin(U).cameraScreenOffset,o=this.getPlugin(U).scaleV,r=this.getPlugin(U).cameraPositon;let a=Math.max(0,Math.min(9,Math.round(o.x/10))),h=5*a+5;this.context.translate(n.x,n.y),this.context.scale(o.x,o.y),this.context.translate(-r.x%2,-r.y%2),this.context.scale(1/h,1/h),this.context.drawImage(this.gridCanvas[a],-this.gridCanvas[a].width/2,-this.gridCanvas[a].height/2,this.gridCanvas[a].width,this.gridCanvas[a].height),this.context.setTransform(1,0,0,1,0,0),this.gameWorld.getComponents(q).concat(this.gameWorld.getComponents(z)).concat(this.gameWorld.getComponents(Q)).concat(this.gameWorld.getComponents(Y)).concat(this.gameWorld.getComponents(ft)).filter((t=>!this.clip(t.getTransform().position))).concat(this.gameWorld.getComponents(nt)).concat(this.gameWorld.getComponents(et)).concat(this.gameWorld.getComponents(ht)).filter((t=>!this.clip(t.getTransform().position))).concat(this.gameWorld.getComponents(at)).concat(this.gameWorld.getComponents(ot)).filter((t=>!this.clip(t.getTransform().position))).sort(((t,e)=>t.zindex-e.zindex)).forEach((e=>e.render(this.context,t))),this.addVignetteEffect(this.context,"rgba(0, 0, 0, 0.35)")}}class bt extends w{name="PhysicsPlugin";update(t){this.gameWorld.getWorldTime(),this.gameWorld.getComponents(o).forEach((e=>e.update(t)))}}var wt=function(t,e,s,n){var i,o=arguments.length,r=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,s):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,s,n);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(r=(o<3?i(r):o>3?i(e,s,r):i(e,s))||r);return o>3&&r&&Object.defineProperty(e,s,r),r},vt=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};class xt extends w{name="PlayerPlugin";playerName="player";player=ct.playerGO();getPlayerPosition(){return this.player.getTransform().position.clone()}getPlayerColor(){return this.player.getComponent(Y).color.clone()}start(){this.respawn(),this.player.getComponent(Y).color=this.getPlugin(V)?.get("playerColor")??new r(53,110,58),this.getPlugin(N)?.KeyDownEvent.subscribe(this,"KeyDownEvent")}event(t,e){if("KeyDownEvent"===e){let e=t;if("r"===e.key)this.respawn();else if("c"===e.key){let t=this.getPlugin(V)?.get("displayColliders")??!1;void 0!==t&&this.getPlugin(V)?.set("displayColliders",!t)}}}update(t){let e=this.getPlugin(U);if(e.targetCameraPositon=this.player.getTransform().position.clone(),!this.player.enabled)return;let s=this.getPlugin(C),n=this.getPlugin(N),r=this.player.getComponent(rt);if(!r)return;r.targetDirection=e.getWorldPosition(s.getMouseScreenPosition()).sub(this.player.getTransform().position),r.range=e.getWorldPosition(s.getMouseScreenPosition()).sub(this.player.getTransform().position.add(r.getGlobalOffset())).magnitude(),(n.isPressed("e")||s.isKeyDown(0))&&r.shoot();const a=n.isPressed("shift")?120:60,h=this.player.getTransform().rotation,l=i.fromRad(h);let c=this.player.getComponent(o),d=c.velocity;n.isPressed("w")?(c.acceleration=l.toUnit().times(a),n.isPressed("s")&&(c.acceleration=l.toUnit().times(25))):n.isPressed("s")?c.acceleration=l.toUnit().times(-25):c.acceleration=i.zero(),d=d.sub(d.perpendicular(l)),d.magnitude()>50&&d.setLength(50),n.isPressed("a")?c.angularVelocity=2.5:n.isPressed("d")?c.angularVelocity=-2.5:c.angularVelocity=0}cliGetName(){return"player"}setname(t){return this.playerName=t,this.player.name=t,new g(!0,`Player name set to ${t}`,void 0)}setcolor(t){try{let e=r.tryParseCssColor(t.toString());e&&(this.player.getComponent(Y).color=e)}catch{}return new g(!0,"Player color set",void 0)}respawn(){return this.player&&this.gameWorld.isSpawned(this.player)&&this.gameWorld.destroy(this.player),this.player=ct.playerGO(),this.player.name=this.playerName,this.player.spawn(this.gameWorld),new g(!0,"Player respawned",void 0)}getcolor(){return new g(!0,`Player color is ${this.player.getComponent(Y).color}`,this.player.getComponent(Y).color)}}wt([m("setname","<name: string>"),vt("design:type",Function),vt("design:paramtypes",[String]),vt("design:returntype",g)],xt.prototype,"setname",null),wt([m("setcolor","<color: string | rgb>"),vt("design:type",Function),vt("design:paramtypes",[Object]),vt("design:returntype",g)],xt.prototype,"setcolor",null),wt([m("respawn"),vt("design:type",Function),vt("design:paramtypes",[]),vt("design:returntype",g)],xt.prototype,"respawn",null),wt([m("getcolor",void 0,"rgb"),vt("design:type",Function),vt("design:paramtypes",[]),vt("design:returntype",g)],xt.prototype,"getcolor",null);class _t extends w{name="StandaloneComponentPlugin";update(t){this.gameWorld.getAllComponents().filter((t=>t instanceof H)).map((t=>t)).forEach((e=>e.tick(t)))}}const Pt=Object.create(null);Pt.open="0",Pt.close="1",Pt.ping="2",Pt.pong="3",Pt.message="4",Pt.upgrade="5",Pt.noop="6";const Ct=Object.create(null);Object.keys(Pt).forEach((t=>{Ct[Pt[t]]=t}));const kt={type:"error",data:"parser error"},Tt="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),Et="function"==typeof ArrayBuffer,St=t=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer instanceof ArrayBuffer,Ot=({type:t,data:e},s,n)=>Tt&&e instanceof Blob?s?n(e):At(e,n):Et&&(e instanceof ArrayBuffer||St(e))?s?n(e):At(new Blob([e]),n):n(Pt[t]+(e||"")),At=(t,e)=>{const s=new FileReader;return s.onload=function(){const t=s.result.split(",")[1];e("b"+(t||""))},s.readAsDataURL(t)};function Rt(t){return t instanceof Uint8Array?t:t instanceof ArrayBuffer?new Uint8Array(t):new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}let Mt;const Bt="undefined"==typeof Uint8Array?[]:new Uint8Array(256);for(let t=0;t<64;t++)Bt["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charCodeAt(t)]=t;const Wt="function"==typeof ArrayBuffer,It=(t,e)=>{if("string"!=typeof t)return{type:"message",data:Nt(t,e)};const s=t.charAt(0);return"b"===s?{type:"message",data:jt(t.substring(1),e)}:Ct[s]?t.length>1?{type:Ct[s],data:t.substring(1)}:{type:Ct[s]}:kt},jt=(t,e)=>{if(Wt){const s=(t=>{let e,s,n,i,o,r=.75*t.length,a=t.length,h=0;"="===t[t.length-1]&&(r--,"="===t[t.length-2]&&r--);const l=new ArrayBuffer(r),c=new Uint8Array(l);for(e=0;e<a;e+=4)s=Bt[t.charCodeAt(e)],n=Bt[t.charCodeAt(e+1)],i=Bt[t.charCodeAt(e+2)],o=Bt[t.charCodeAt(e+3)],c[h++]=s<<2|n>>4,c[h++]=(15&n)<<4|i>>2,c[h++]=(3&i)<<6|63&o;return l})(t);return Nt(s,e)}return{base64:!0,data:t}},Nt=(t,e)=>"blob"===e?t instanceof Blob?t:new Blob([t]):t instanceof ArrayBuffer?t:t.buffer,Gt=String.fromCharCode(30);let Lt;function Dt(t){return t.reduce(((t,e)=>t+e.length),0)}function Ut(t,e){if(t[0].length===e)return t.shift();const s=new Uint8Array(e);let n=0;for(let i=0;i<e;i++)s[i]=t[0][n++],n===t[0].length&&(t.shift(),n=0);return t.length&&n<t[0].length&&(t[0]=t[0].slice(n)),s}function Ft(t){if(t)return function(t){for(var e in Ft.prototype)t[e]=Ft.prototype[e];return t}(t)}Ft.prototype.on=Ft.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this},Ft.prototype.once=function(t,e){function s(){this.off(t,s),e.apply(this,arguments)}return s.fn=e,this.on(t,s),this},Ft.prototype.off=Ft.prototype.removeListener=Ft.prototype.removeAllListeners=Ft.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var s,n=this._callbacks["$"+t];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+t],this;for(var i=0;i<n.length;i++)if((s=n[i])===e||s.fn===e){n.splice(i,1);break}return 0===n.length&&delete this._callbacks["$"+t],this},Ft.prototype.emit=function(t){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),s=this._callbacks["$"+t],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(s){n=0;for(var i=(s=s.slice(0)).length;n<i;++n)s[n].apply(this,e)}return this},Ft.prototype.emitReserved=Ft.prototype.emit,Ft.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]},Ft.prototype.hasListeners=function(t){return!!this.listeners(t).length};const qt="function"==typeof Promise&&"function"==typeof Promise.resolve?t=>Promise.resolve().then(t):(t,e)=>e(t,0),Vt="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")();function zt(t,...e){return e.reduce(((e,s)=>(t.hasOwnProperty(s)&&(e[s]=t[s]),e)),{})}const $t=Vt.setTimeout,Ht=Vt.clearTimeout;function Kt(t,e){e.useNativeTimers?(t.setTimeoutFn=$t.bind(Vt),t.clearTimeoutFn=Ht.bind(Vt)):(t.setTimeoutFn=Vt.setTimeout.bind(Vt),t.clearTimeoutFn=Vt.clearTimeout.bind(Vt))}function Yt(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}class Xt extends Error{constructor(t,e,s){super(t),this.description=e,this.context=s,this.type="TransportError"}}class Jt extends Ft{constructor(t){super(),this.writable=!1,Kt(this,t),this.opts=t,this.query=t.query,this.socket=t.socket,this.supportsBinary=!t.forceBase64}onError(t,e,s){return super.emitReserved("error",new Xt(t,e,s)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}send(t){"open"===this.readyState&&this.write(t)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(t){const e=It(t,this.socket.binaryType);this.onPacket(e)}onPacket(t){super.emitReserved("packet",t)}onClose(t){this.readyState="closed",super.emitReserved("close",t)}pause(t){}createUri(t,e={}){return t+"://"+this._hostname()+this._port()+this.opts.path+this._query(e)}_hostname(){const t=this.opts.hostname;return-1===t.indexOf(":")?t:"["+t+"]"}_port(){return this.opts.port&&(this.opts.secure&&Number(443!==this.opts.port)||!this.opts.secure&&80!==Number(this.opts.port))?":"+this.opts.port:""}_query(t){const e=function(t){let e="";for(let s in t)t.hasOwnProperty(s)&&(e.length&&(e+="&"),e+=encodeURIComponent(s)+"="+encodeURIComponent(t[s]));return e}(t);return e.length?"?"+e:""}}class Qt extends Jt{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(t){this.readyState="pausing";const e=()=>{this.readyState="paused",t()};if(this._polling||!this.writable){let t=0;this._polling&&(t++,this.once("pollComplete",(function(){--t||e()}))),this.writable||(t++,this.once("drain",(function(){--t||e()})))}else e()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(t){((t,e)=>{const s=t.split(Gt),n=[];for(let t=0;t<s.length;t++){const i=It(s[t],e);if(n.push(i),"error"===i.type)break}return n})(t,this.socket.binaryType).forEach((t=>{if("opening"===this.readyState&&"open"===t.type&&this.onOpen(),"close"===t.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(t)})),"closed"!==this.readyState&&(this._polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this._poll())}doClose(){const t=()=>{this.write([{type:"close"}])};"open"===this.readyState?t():this.once("open",t)}write(t){this.writable=!1,((t,e)=>{const s=t.length,n=new Array(s);let i=0;t.forEach(((t,o)=>{Ot(t,!1,(t=>{n[o]=t,++i===s&&e(n.join(Gt))}))}))})(t,(t=>{this.doWrite(t,(()=>{this.writable=!0,this.emitReserved("drain")}))}))}uri(){const t=this.opts.secure?"https":"http",e=this.query||{};return!1!==this.opts.timestampRequests&&(e[this.opts.timestampParam]=Yt()),this.supportsBinary||e.sid||(e.b64=1),this.createUri(t,e)}}let Zt=!1;try{Zt="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(t){}const te=Zt;function ee(){}class se extends Qt{constructor(t){if(super(t),"undefined"!=typeof location){const e="https:"===location.protocol;let s=location.port;s||(s=e?"443":"80"),this.xd="undefined"!=typeof location&&t.hostname!==location.hostname||s!==t.port}}doWrite(t,e){const s=this.request({method:"POST",data:t});s.on("success",e),s.on("error",((t,e)=>{this.onError("xhr post error",t,e)}))}doPoll(){const t=this.request();t.on("data",this.onData.bind(this)),t.on("error",((t,e)=>{this.onError("xhr poll error",t,e)})),this.pollXhr=t}}class ne extends Ft{constructor(t,e,s){super(),this.createRequest=t,Kt(this,s),this._opts=s,this._method=s.method||"GET",this._uri=e,this._data=void 0!==s.data?s.data:null,this._create()}_create(){var t;const e=zt(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");e.xdomain=!!this._opts.xd;const s=this._xhr=this.createRequest(e);try{s.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){s.setDisableHeaderCheck&&s.setDisableHeaderCheck(!0);for(let t in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(t)&&s.setRequestHeader(t,this._opts.extraHeaders[t])}}catch(t){}if("POST"===this._method)try{s.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(t){}try{s.setRequestHeader("Accept","*/*")}catch(t){}null===(t=this._opts.cookieJar)||void 0===t||t.addCookies(s),"withCredentials"in s&&(s.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(s.timeout=this._opts.requestTimeout),s.onreadystatechange=()=>{var t;3===s.readyState&&(null===(t=this._opts.cookieJar)||void 0===t||t.parseCookies(s.getResponseHeader("set-cookie"))),4===s.readyState&&(200===s.status||1223===s.status?this._onLoad():this.setTimeoutFn((()=>{this._onError("number"==typeof s.status?s.status:0)}),0))},s.send(this._data)}catch(t){return void this.setTimeoutFn((()=>{this._onError(t)}),0)}"undefined"!=typeof document&&(this._index=ne.requestsCount++,ne.requests[this._index]=this)}_onError(t){this.emitReserved("error",t,this._xhr),this._cleanup(!0)}_cleanup(t){if(void 0!==this._xhr&&null!==this._xhr){if(this._xhr.onreadystatechange=ee,t)try{this._xhr.abort()}catch(t){}"undefined"!=typeof document&&delete ne.requests[this._index],this._xhr=null}}_onLoad(){const t=this._xhr.responseText;null!==t&&(this.emitReserved("data",t),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}function ie(){for(let t in ne.requests)ne.requests.hasOwnProperty(t)&&ne.requests[t].abort()}ne.requestsCount=0,ne.requests={},"undefined"!=typeof document&&("function"==typeof attachEvent?attachEvent("onunload",ie):"function"==typeof addEventListener&&addEventListener("onpagehide"in Vt?"pagehide":"unload",ie,!1));const oe=function(){const t=re({xdomain:!1});return t&&null!==t.responseType}();function re(t){const e=t.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!e||te))return new XMLHttpRequest}catch(t){}if(!e)try{return new(Vt[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(t){}}const ae="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase();class he extends Jt{get name(){return"websocket"}doOpen(){const t=this.uri(),e=this.opts.protocols,s=ae?{}:zt(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(s.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(t,e,s)}catch(t){return this.emitReserved("error",t)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=t=>this.onClose({description:"websocket connection closed",context:t}),this.ws.onmessage=t=>this.onData(t.data),this.ws.onerror=t=>this.onError("websocket error",t)}write(t){this.writable=!1;for(let e=0;e<t.length;e++){const s=t[e],n=e===t.length-1;Ot(s,this.supportsBinary,(t=>{try{this.doWrite(s,t)}catch(t){}n&&qt((()=>{this.writable=!0,this.emitReserved("drain")}),this.setTimeoutFn)}))}}doClose(){void 0!==this.ws&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const t=this.opts.secure?"wss":"ws",e=this.query||{};return this.opts.timestampRequests&&(e[this.opts.timestampParam]=Yt()),this.supportsBinary||(e.b64=1),this.createUri(t,e)}}const le=Vt.WebSocket||Vt.MozWebSocket,ce={websocket:class extends he{createSocket(t,e,s){return ae?new le(t,e,s):e?new le(t,e):new le(t)}doWrite(t,e){this.ws.send(e)}},webtransport:class extends Jt{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(t){return this.emitReserved("error",t)}this._transport.closed.then((()=>{this.onClose()})).catch((t=>{this.onError("webtransport error",t)})),this._transport.ready.then((()=>{this._transport.createBidirectionalStream().then((t=>{const e=function(t,e){Lt||(Lt=new TextDecoder);const s=[];let n=0,i=-1,o=!1;return new TransformStream({transform(r,a){for(s.push(r);;){if(0===n){if(Dt(s)<1)break;const t=Ut(s,1);o=!(128&~t[0]),i=127&t[0],n=i<126?3:126===i?1:2}else if(1===n){if(Dt(s)<2)break;const t=Ut(s,2);i=new DataView(t.buffer,t.byteOffset,t.length).getUint16(0),n=3}else if(2===n){if(Dt(s)<8)break;const t=Ut(s,8),e=new DataView(t.buffer,t.byteOffset,t.length),o=e.getUint32(0);if(o>Math.pow(2,21)-1){a.enqueue(kt);break}i=o*Math.pow(2,32)+e.getUint32(4),n=3}else{if(Dt(s)<i)break;const t=Ut(s,i);a.enqueue(It(o?t:Lt.decode(t),e)),n=0}if(0===i||i>t){a.enqueue(kt);break}}}})}(Number.MAX_SAFE_INTEGER,this.socket.binaryType),s=t.readable.pipeThrough(e).getReader(),n=new TransformStream({transform(t,e){!function(t,e){Tt&&t.data instanceof Blob?t.data.arrayBuffer().then(Rt).then(e):Et&&(t.data instanceof ArrayBuffer||St(t.data))?e(Rt(t.data)):Ot(t,!1,(t=>{Mt||(Mt=new TextEncoder),e(Mt.encode(t))}))}(t,(s=>{const n=s.length;let i;if(n<126)i=new Uint8Array(1),new DataView(i.buffer).setUint8(0,n);else if(n<65536){i=new Uint8Array(3);const t=new DataView(i.buffer);t.setUint8(0,126),t.setUint16(1,n)}else{i=new Uint8Array(9);const t=new DataView(i.buffer);t.setUint8(0,127),t.setBigUint64(1,BigInt(n))}t.data&&"string"!=typeof t.data&&(i[0]|=128),e.enqueue(i),e.enqueue(s)}))}});n.readable.pipeTo(t.writable),this._writer=n.writable.getWriter();const i=()=>{s.read().then((({done:t,value:e})=>{t||(this.onPacket(e),i())})).catch((t=>{}))};i();const o={type:"open"};this.query.sid&&(o.data=`{"sid":"${this.query.sid}"}`),this._writer.write(o).then((()=>this.onOpen()))}))}))}write(t){this.writable=!1;for(let e=0;e<t.length;e++){const s=t[e],n=e===t.length-1;this._writer.write(s).then((()=>{n&&qt((()=>{this.writable=!0,this.emitReserved("drain")}),this.setTimeoutFn)}))}}doClose(){var t;null===(t=this._transport)||void 0===t||t.close()}},polling:class extends se{constructor(t){super(t);const e=t&&t.forceBase64;this.supportsBinary=oe&&!e}request(t={}){return Object.assign(t,{xd:this.xd},this.opts),new ne(re,this.uri(),t)}}},de=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,ue=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function pe(t){if(t.length>8e3)throw"URI too long";const e=t,s=t.indexOf("["),n=t.indexOf("]");-1!=s&&-1!=n&&(t=t.substring(0,s)+t.substring(s,n).replace(/:/g,";")+t.substring(n,t.length));let i=de.exec(t||""),o={},r=14;for(;r--;)o[ue[r]]=i[r]||"";return-1!=s&&-1!=n&&(o.source=e,o.host=o.host.substring(1,o.host.length-1).replace(/;/g,":"),o.authority=o.authority.replace("[","").replace("]","").replace(/;/g,":"),o.ipv6uri=!0),o.pathNames=function(t,e){const s=e.replace(/\/{2,9}/g,"/").split("/");return"/"!=e.slice(0,1)&&0!==e.length||s.splice(0,1),"/"==e.slice(-1)&&s.splice(s.length-1,1),s}(0,o.path),o.queryKey=function(t,e){const s={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,(function(t,e,n){e&&(s[e]=n)})),s}(0,o.query),o}const ge="function"==typeof addEventListener&&"function"==typeof removeEventListener,me=[];ge&&addEventListener("offline",(()=>{me.forEach((t=>t()))}),!1);class fe extends Ft{constructor(t,e){if(super(),this.binaryType="arraybuffer",this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,t&&"object"==typeof t&&(e=t,t=null),t){const s=pe(t);e.hostname=s.host,e.secure="https"===s.protocol||"wss"===s.protocol,e.port=s.port,s.query&&(e.query=s.query)}else e.host&&(e.hostname=pe(e.host).host);Kt(this,e),this.secure=null!=e.secure?e.secure:"undefined"!=typeof location&&"https:"===location.protocol,e.hostname&&!e.port&&(e.port=this.secure?"443":"80"),this.hostname=e.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=e.port||("undefined"!=typeof location&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},e.transports.forEach((t=>{const e=t.prototype.name;this.transports.push(e),this._transportsByName[e]=t})),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},e),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),"string"==typeof this.opts.query&&(this.opts.query=function(t){let e={},s=t.split("&");for(let t=0,n=s.length;t<n;t++){let n=s[t].split("=");e[decodeURIComponent(n[0])]=decodeURIComponent(n[1])}return e}(this.opts.query)),ge&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),"localhost"!==this.hostname&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},me.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(t){const e=Object.assign({},this.opts.query);e.EIO=4,e.transport=t,this.id&&(e.sid=this.id);const s=Object.assign({},this.opts,{query:e,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[t]);return new this._transportsByName[t](s)}_open(){if(0===this.transports.length)return void this.setTimeoutFn((()=>{this.emitReserved("error","No transports available")}),0);const t=this.opts.rememberUpgrade&&fe.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket")?"websocket":this.transports[0];this.readyState="opening";const e=this.createTransport(t);e.open(),this.setTransport(e)}setTransport(t){this.transport&&this.transport.removeAllListeners(),this.transport=t,t.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",(t=>this._onClose("transport close",t)))}onOpen(){this.readyState="open",fe.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush()}_onPacket(t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",t),this.emitReserved("heartbeat"),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const e=new Error("server error");e.code=t.data,this._onError(e);break;case"message":this.emitReserved("data",t.data),this.emitReserved("message",t.data)}}onHandshake(t){this.emitReserved("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this._pingInterval=t.pingInterval,this._pingTimeout=t.pingTimeout,this._maxPayload=t.maxPayload,this.onOpen(),"closed"!==this.readyState&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const t=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+t,this._pingTimeoutTimer=this.setTimeoutFn((()=>{this._onClose("ping timeout")}),t),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const t=this._getWritablePackets();this.transport.send(t),this._prevBufferLen=t.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;let t=1;for(let s=0;s<this.writeBuffer.length;s++){const n=this.writeBuffer[s].data;if(n&&(t+="string"==typeof(e=n)?function(t){let e=0,s=0;for(let n=0,i=t.length;n<i;n++)e=t.charCodeAt(n),e<128?s+=1:e<2048?s+=2:e<55296||e>=57344?s+=3:(n++,s+=4);return s}(e):Math.ceil(1.33*(e.byteLength||e.size))),s>0&&t>this._maxPayload)return this.writeBuffer.slice(0,s);t+=2}var e;return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const t=Date.now()>this._pingTimeoutTime;return t&&(this._pingTimeoutTime=0,qt((()=>{this._onClose("ping timeout")}),this.setTimeoutFn)),t}write(t,e,s){return this._sendPacket("message",t,e,s),this}send(t,e,s){return this._sendPacket("message",t,e,s),this}_sendPacket(t,e,s,n){if("function"==typeof e&&(n=e,e=void 0),"function"==typeof s&&(n=s,s=null),"closing"===this.readyState||"closed"===this.readyState)return;(s=s||{}).compress=!1!==s.compress;const i={type:t,data:e,options:s};this.emitReserved("packetCreate",i),this.writeBuffer.push(i),n&&this.once("flush",n),this.flush()}close(){const t=()=>{this._onClose("forced close"),this.transport.close()},e=()=>{this.off("upgrade",e),this.off("upgradeError",e),t()},s=()=>{this.once("upgrade",e),this.once("upgradeError",e)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",(()=>{this.upgrading?s():t()})):this.upgrading?s():t()),this}_onError(t){if(fe.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&"opening"===this.readyState)return this.transports.shift(),this._open();this.emitReserved("error",t),this._onClose("transport error",t)}_onClose(t,e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),ge&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const t=me.indexOf(this._offlineEventListener);-1!==t&&me.splice(t,1)}this.readyState="closed",this.id=null,this.emitReserved("close",t,e),this.writeBuffer=[],this._prevBufferLen=0}}}fe.protocol=4;class ye extends fe{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),"open"===this.readyState&&this.opts.upgrade)for(let t=0;t<this._upgrades.length;t++)this._probe(this._upgrades[t])}_probe(t){let e=this.createTransport(t),s=!1;fe.priorWebsocketSuccess=!1;const n=()=>{s||(e.send([{type:"ping",data:"probe"}]),e.once("packet",(t=>{if(!s)if("pong"===t.type&&"probe"===t.data){if(this.upgrading=!0,this.emitReserved("upgrading",e),!e)return;fe.priorWebsocketSuccess="websocket"===e.name,this.transport.pause((()=>{s||"closed"!==this.readyState&&(l(),this.setTransport(e),e.send([{type:"upgrade"}]),this.emitReserved("upgrade",e),e=null,this.upgrading=!1,this.flush())}))}else{const t=new Error("probe error");t.transport=e.name,this.emitReserved("upgradeError",t)}})))};function i(){s||(s=!0,l(),e.close(),e=null)}const o=t=>{const s=new Error("probe error: "+t);s.transport=e.name,i(),this.emitReserved("upgradeError",s)};function r(){o("transport closed")}function a(){o("socket closed")}function h(t){e&&t.name!==e.name&&i()}const l=()=>{e.removeListener("open",n),e.removeListener("error",o),e.removeListener("close",r),this.off("close",a),this.off("upgrading",h)};e.once("open",n),e.once("error",o),e.once("close",r),this.once("close",a),this.once("upgrading",h),-1!==this._upgrades.indexOf("webtransport")&&"webtransport"!==t?this.setTimeoutFn((()=>{s||e.open()}),200):e.open()}onHandshake(t){this._upgrades=this._filterUpgrades(t.upgrades),super.onHandshake(t)}_filterUpgrades(t){const e=[];for(let s=0;s<t.length;s++)~this.transports.indexOf(t[s])&&e.push(t[s]);return e}}class be extends ye{constructor(t,e={}){const s="object"==typeof t?t:e;(!s.transports||s.transports&&"string"==typeof s.transports[0])&&(s.transports=(s.transports||["polling","websocket","webtransport"]).map((t=>ce[t])).filter((t=>!!t))),super(t,s)}}const we="function"==typeof ArrayBuffer,ve=Object.prototype.toString,xe="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===ve.call(Blob),_e="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===ve.call(File);function Pe(t){return we&&(t instanceof ArrayBuffer||(t=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer)(t))||xe&&t instanceof Blob||_e&&t instanceof File}function Ce(t,e){if(!t||"object"!=typeof t)return!1;if(Array.isArray(t)){for(let e=0,s=t.length;e<s;e++)if(Ce(t[e]))return!0;return!1}if(Pe(t))return!0;if(t.toJSON&&"function"==typeof t.toJSON&&1===arguments.length)return Ce(t.toJSON(),!0);for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e)&&Ce(t[e]))return!0;return!1}function ke(t){const e=[],s=t.data,n=t;return n.data=Te(s,e),n.attachments=e.length,{packet:n,buffers:e}}function Te(t,e){if(!t)return t;if(Pe(t)){const s={_placeholder:!0,num:e.length};return e.push(t),s}if(Array.isArray(t)){const s=new Array(t.length);for(let n=0;n<t.length;n++)s[n]=Te(t[n],e);return s}if("object"==typeof t&&!(t instanceof Date)){const s={};for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&(s[n]=Te(t[n],e));return s}return t}function Ee(t,e){return t.data=Se(t.data,e),delete t.attachments,t}function Se(t,e){if(!t)return t;if(t&&!0===t._placeholder){if("number"==typeof t.num&&t.num>=0&&t.num<e.length)return e[t.num];throw new Error("illegal attachments")}if(Array.isArray(t))for(let s=0;s<t.length;s++)t[s]=Se(t[s],e);else if("object"==typeof t)for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&(t[s]=Se(t[s],e));return t}const Oe=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],Ae=5;var Re;!function(t){t[t.CONNECT=0]="CONNECT",t[t.DISCONNECT=1]="DISCONNECT",t[t.EVENT=2]="EVENT",t[t.ACK=3]="ACK",t[t.CONNECT_ERROR=4]="CONNECT_ERROR",t[t.BINARY_EVENT=5]="BINARY_EVENT",t[t.BINARY_ACK=6]="BINARY_ACK"}(Re||(Re={}));class Me{constructor(t){this.replacer=t}encode(t){return t.type!==Re.EVENT&&t.type!==Re.ACK||!Ce(t)?[this.encodeAsString(t)]:this.encodeAsBinary({type:t.type===Re.EVENT?Re.BINARY_EVENT:Re.BINARY_ACK,nsp:t.nsp,data:t.data,id:t.id})}encodeAsString(t){let e=""+t.type;return t.type!==Re.BINARY_EVENT&&t.type!==Re.BINARY_ACK||(e+=t.attachments+"-"),t.nsp&&"/"!==t.nsp&&(e+=t.nsp+","),null!=t.id&&(e+=t.id),null!=t.data&&(e+=JSON.stringify(t.data,this.replacer)),e}encodeAsBinary(t){const e=ke(t),s=this.encodeAsString(e.packet),n=e.buffers;return n.unshift(s),n}}function Be(t){return"[object Object]"===Object.prototype.toString.call(t)}class We extends Ft{constructor(t){super(),this.reviver=t}add(t){let e;if("string"==typeof t){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");e=this.decodeString(t);const s=e.type===Re.BINARY_EVENT;s||e.type===Re.BINARY_ACK?(e.type=s?Re.EVENT:Re.ACK,this.reconstructor=new Ie(e),0===e.attachments&&super.emitReserved("decoded",e)):super.emitReserved("decoded",e)}else{if(!Pe(t)&&!t.base64)throw new Error("Unknown type: "+t);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");e=this.reconstructor.takeBinaryData(t),e&&(this.reconstructor=null,super.emitReserved("decoded",e))}}decodeString(t){let e=0;const s={type:Number(t.charAt(0))};if(void 0===Re[s.type])throw new Error("unknown packet type "+s.type);if(s.type===Re.BINARY_EVENT||s.type===Re.BINARY_ACK){const n=e+1;for(;"-"!==t.charAt(++e)&&e!=t.length;);const i=t.substring(n,e);if(i!=Number(i)||"-"!==t.charAt(e))throw new Error("Illegal attachments");s.attachments=Number(i)}if("/"===t.charAt(e+1)){const n=e+1;for(;++e&&","!==t.charAt(e)&&e!==t.length;);s.nsp=t.substring(n,e)}else s.nsp="/";const n=t.charAt(e+1);if(""!==n&&Number(n)==n){const n=e+1;for(;++e;){const s=t.charAt(e);if(null==s||Number(s)!=s){--e;break}if(e===t.length)break}s.id=Number(t.substring(n,e+1))}if(t.charAt(++e)){const n=this.tryParse(t.substr(e));if(!We.isPayloadValid(s.type,n))throw new Error("invalid payload");s.data=n}return s}tryParse(t){try{return JSON.parse(t,this.reviver)}catch(t){return!1}}static isPayloadValid(t,e){switch(t){case Re.CONNECT:return Be(e);case Re.DISCONNECT:return void 0===e;case Re.CONNECT_ERROR:return"string"==typeof e||Be(e);case Re.EVENT:case Re.BINARY_EVENT:return Array.isArray(e)&&("number"==typeof e[0]||"string"==typeof e[0]&&-1===Oe.indexOf(e[0]));case Re.ACK:case Re.BINARY_ACK:return Array.isArray(e)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class Ie{constructor(t){this.packet=t,this.buffers=[],this.reconPack=t}takeBinaryData(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){const t=Ee(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}function je(t,e,s){return t.on(e,s),function(){t.off(e,s)}}const Ne=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Ge extends Ft{constructor(t,e,s){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=t,this.nsp=e,s&&s.auth&&(this.auth=s.auth),this._opts=Object.assign({},s),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const t=this.io;this.subs=[je(t,"open",this.onopen.bind(this)),je(t,"packet",this.onpacket.bind(this)),je(t,"error",this.onerror.bind(this)),je(t,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(...t){return t.unshift("message"),this.emit.apply(this,t),this}emit(t,...e){var s,n,i;if(Ne.hasOwnProperty(t))throw new Error('"'+t.toString()+'" is a reserved event name');if(e.unshift(t),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(e),this;const o={type:Re.EVENT,data:e,options:{}};if(o.options.compress=!1!==this.flags.compress,"function"==typeof e[e.length-1]){const t=this.ids++,s=e.pop();this._registerAckCallback(t,s),o.id=t}const r=null===(n=null===(s=this.io.engine)||void 0===s?void 0:s.transport)||void 0===n?void 0:n.writable,a=this.connected&&!(null===(i=this.io.engine)||void 0===i?void 0:i._hasPingExpired());return this.flags.volatile&&!r||(a?(this.notifyOutgoingListeners(o),this.packet(o)):this.sendBuffer.push(o)),this.flags={},this}_registerAckCallback(t,e){var s;const n=null!==(s=this.flags.timeout)&&void 0!==s?s:this._opts.ackTimeout;if(void 0===n)return void(this.acks[t]=e);const i=this.io.setTimeoutFn((()=>{delete this.acks[t];for(let e=0;e<this.sendBuffer.length;e++)this.sendBuffer[e].id===t&&this.sendBuffer.splice(e,1);e.call(this,new Error("operation has timed out"))}),n),o=(...t)=>{this.io.clearTimeoutFn(i),e.apply(this,t)};o.withError=!0,this.acks[t]=o}emitWithAck(t,...e){return new Promise(((s,n)=>{const i=(t,e)=>t?n(t):s(e);i.withError=!0,e.push(i),this.emit(t,...e)}))}_addToQueue(t){let e;"function"==typeof t[t.length-1]&&(e=t.pop());const s={id:this._queueSeq++,tryCount:0,pending:!1,args:t,flags:Object.assign({fromQueue:!0},this.flags)};t.push(((t,...n)=>{if(s===this._queue[0])return null!==t?s.tryCount>this._opts.retries&&(this._queue.shift(),e&&e(t)):(this._queue.shift(),e&&e(null,...n)),s.pending=!1,this._drainQueue()})),this._queue.push(s),this._drainQueue()}_drainQueue(t=!1){if(!this.connected||0===this._queue.length)return;const e=this._queue[0];e.pending&&!t||(e.pending=!0,e.tryCount++,this.flags=e.flags,this.emit.apply(this,e.args))}packet(t){t.nsp=this.nsp,this.io._packet(t)}onopen(){"function"==typeof this.auth?this.auth((t=>{this._sendConnectPacket(t)})):this._sendConnectPacket(this.auth)}_sendConnectPacket(t){this.packet({type:Re.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},t):t})}onerror(t){this.connected||this.emitReserved("connect_error",t)}onclose(t,e){this.connected=!1,delete this.id,this.emitReserved("disconnect",t,e),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach((t=>{if(!this.sendBuffer.some((e=>String(e.id)===t))){const e=this.acks[t];delete this.acks[t],e.withError&&e.call(this,new Error("socket has been disconnected"))}}))}onpacket(t){if(t.nsp===this.nsp)switch(t.type){case Re.CONNECT:t.data&&t.data.sid?this.onconnect(t.data.sid,t.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case Re.EVENT:case Re.BINARY_EVENT:this.onevent(t);break;case Re.ACK:case Re.BINARY_ACK:this.onack(t);break;case Re.DISCONNECT:this.ondisconnect();break;case Re.CONNECT_ERROR:this.destroy();const e=new Error(t.data.message);e.data=t.data.data,this.emitReserved("connect_error",e)}}onevent(t){const e=t.data||[];null!=t.id&&e.push(this.ack(t.id)),this.connected?this.emitEvent(e):this.receiveBuffer.push(Object.freeze(e))}emitEvent(t){if(this._anyListeners&&this._anyListeners.length){const e=this._anyListeners.slice();for(const s of e)s.apply(this,t)}super.emit.apply(this,t),this._pid&&t.length&&"string"==typeof t[t.length-1]&&(this._lastOffset=t[t.length-1])}ack(t){const e=this;let s=!1;return function(...n){s||(s=!0,e.packet({type:Re.ACK,id:t,data:n}))}}onack(t){const e=this.acks[t.id];"function"==typeof e&&(delete this.acks[t.id],e.withError&&t.data.unshift(null),e.apply(this,t.data))}onconnect(t,e){this.id=t,this.recovered=e&&this._pid===e,this._pid=e,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach((t=>this.emitEvent(t))),this.receiveBuffer=[],this.sendBuffer.forEach((t=>{this.notifyOutgoingListeners(t),this.packet(t)})),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach((t=>t())),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:Re.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(t){return this.flags.compress=t,this}get volatile(){return this.flags.volatile=!0,this}timeout(t){return this.flags.timeout=t,this}onAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(t),this}prependAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(t),this}offAny(t){if(!this._anyListeners)return this;if(t){const e=this._anyListeners;for(let s=0;s<e.length;s++)if(t===e[s])return e.splice(s,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(t),this}prependAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(t),this}offAnyOutgoing(t){if(!this._anyOutgoingListeners)return this;if(t){const e=this._anyOutgoingListeners;for(let s=0;s<e.length;s++)if(t===e[s])return e.splice(s,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(t){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const e=this._anyOutgoingListeners.slice();for(const s of e)s.apply(this,t.data)}}}function Le(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}Le.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),s=Math.floor(e*this.jitter*t);t=1&Math.floor(10*e)?t+s:t-s}return 0|Math.min(t,this.max)},Le.prototype.reset=function(){this.attempts=0},Le.prototype.setMin=function(t){this.ms=t},Le.prototype.setMax=function(t){this.max=t},Le.prototype.setJitter=function(t){this.jitter=t};class De extends Ft{constructor(t,s){var n;super(),this.nsps={},this.subs=[],t&&"object"==typeof t&&(s=t,t=void 0),(s=s||{}).path=s.path||"/socket.io",this.opts=s,Kt(this,s),this.reconnection(!1!==s.reconnection),this.reconnectionAttempts(s.reconnectionAttempts||1/0),this.reconnectionDelay(s.reconnectionDelay||1e3),this.reconnectionDelayMax(s.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(n=s.randomizationFactor)&&void 0!==n?n:.5),this.backoff=new Le({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==s.timeout?2e4:s.timeout),this._readyState="closed",this.uri=t;const i=s.parser||e;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=!1!==s.autoConnect,this._autoConnect&&this.open()}reconnection(t){return arguments.length?(this._reconnection=!!t,t||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(t){return void 0===t?this._reconnectionAttempts:(this._reconnectionAttempts=t,this)}reconnectionDelay(t){var e;return void 0===t?this._reconnectionDelay:(this._reconnectionDelay=t,null===(e=this.backoff)||void 0===e||e.setMin(t),this)}randomizationFactor(t){var e;return void 0===t?this._randomizationFactor:(this._randomizationFactor=t,null===(e=this.backoff)||void 0===e||e.setJitter(t),this)}reconnectionDelayMax(t){var e;return void 0===t?this._reconnectionDelayMax:(this._reconnectionDelayMax=t,null===(e=this.backoff)||void 0===e||e.setMax(t),this)}timeout(t){return arguments.length?(this._timeout=t,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(t){if(~this._readyState.indexOf("open"))return this;this.engine=new be(this.uri,this.opts);const e=this.engine,s=this;this._readyState="opening",this.skipReconnect=!1;const n=je(e,"open",(function(){s.onopen(),t&&t()})),i=e=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",e),t?t(e):this.maybeReconnectOnOpen()},o=je(e,"error",i);if(!1!==this._timeout){const t=this._timeout,s=this.setTimeoutFn((()=>{n(),i(new Error("timeout")),e.close()}),t);this.opts.autoUnref&&s.unref(),this.subs.push((()=>{this.clearTimeoutFn(s)}))}return this.subs.push(n),this.subs.push(o),this}connect(t){return this.open(t)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const t=this.engine;this.subs.push(je(t,"ping",this.onping.bind(this)),je(t,"data",this.ondata.bind(this)),je(t,"error",this.onerror.bind(this)),je(t,"close",this.onclose.bind(this)),je(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(t){try{this.decoder.add(t)}catch(t){this.onclose("parse error",t)}}ondecoded(t){qt((()=>{this.emitReserved("packet",t)}),this.setTimeoutFn)}onerror(t){this.emitReserved("error",t)}socket(t,e){let s=this.nsps[t];return s?this._autoConnect&&!s.active&&s.connect():(s=new Ge(this,t,e),this.nsps[t]=s),s}_destroy(t){const e=Object.keys(this.nsps);for(const t of e)if(this.nsps[t].active)return;this._close()}_packet(t){const e=this.encoder.encode(t);for(let s=0;s<e.length;s++)this.engine.write(e[s],t.options)}cleanup(){this.subs.forEach((t=>t())),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(t,e){var s;this.cleanup(),null===(s=this.engine)||void 0===s||s.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",t,e),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const t=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const e=this.backoff.duration();this._reconnecting=!0;const s=this.setTimeoutFn((()=>{t.skipReconnect||(this.emitReserved("reconnect_attempt",t.backoff.attempts),t.skipReconnect||t.open((e=>{e?(t._reconnecting=!1,t.reconnect(),this.emitReserved("reconnect_error",e)):t.onreconnect()})))}),e);this.opts.autoUnref&&s.unref(),this.subs.push((()=>{this.clearTimeoutFn(s)}))}}onreconnect(){const t=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",t)}}const Ue={};function Fe(t,e){"object"==typeof t&&(e=t,t=void 0);const s=function(t,e="",s){let n=t;s=s||"undefined"!=typeof location&&location,null==t&&(t=s.protocol+"//"+s.host),"string"==typeof t&&("/"===t.charAt(0)&&(t="/"===t.charAt(1)?s.protocol+t:s.host+t),/^(https?|wss?):\/\//.test(t)||(t=void 0!==s?s.protocol+"//"+t:"https://"+t),n=pe(t)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";const i=-1!==n.host.indexOf(":")?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+i+":"+n.port+e,n.href=n.protocol+"://"+i+(s&&s.port===n.port?"":":"+n.port),n}(t,(e=e||{}).path||"/socket.io"),n=s.source,i=s.id,o=s.path,r=Ue[i]&&o in Ue[i].nsps;let a;return e.forceNew||e["force new connection"]||!1===e.multiplex||r?a=new De(n,e):(Ue[i]||(Ue[i]=new De(n,e)),a=Ue[i]),s.query&&!e.query&&(e.query=s.queryKey),a.socket(s.path,e)}Object.assign(Fe,{Manager:De,Socket:Ge,io:Fe,connect:Fe});var qe=function(t,e,s,n){var i,o=arguments.length,r=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,s):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,s,n);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(r=(o<3?i(r):o>3?i(e,s,r):i(e,s))||r);return o>3&&r&&Object.defineProperty(e,s,r),r},Ve=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};let ze=class extends w{name="CliPlugin";globalCommands=new Map;echo(t){return new g(!0,t,t)}loop(t,e){let s=[],n="";for(let i=0;i<t;i++){const t=this.parseAndExecuteCommands(e);if(!t.status)return new g(!1,`Error executing command: ${t.message}`,void 0);s.push(t.data),n+=`${t.message}\n`}return new g(!0,n,s)}true(){return new g(!0,"This is a true command",!0)}false(){return new g(!0,"This is a false command",!1)}int(t){return new g(!0,`This is an int command with value ${t}`,parseInt(t))}float(t){return new g(!0,`This is a float command with value ${t}`,parseFloat(t))}refresh(){return location.reload(),new g(!0,"This is a refresh command",void 0)}getrandomcolor(){const t=r.randomColor2();return new g(!0,`Random color is ${t}`,t)}help(){let t=super.help(),e="plugins:\n";for(const t of this.gameWorld.getAllPlugins())e+=`/${t.cliGetName()}\n`;return e=t.message+"\n"+e,new g(!0,e,void 0)}art(){const t="\n[38;5;160m         ██████         [0m\n[38;5;160m       ██████████       [0m\n[38;5;160m      ████    ████      [0m\n[38;5;82m    ████        ████    [0m\n[38;5;82m   ████          ████   [0m\n[38;5;82m  ████            ████  [0m\n[38;5;82m  ████    ████    ████  [0m\n[38;5;82m  ████████████████████  [0m\n[38;5;226m   ██████████████████   [0m\n[38;5;226m     ████████████████     [0m\n[38;5;226m      ████    ██████      [0m\n[38;5;196m      ████    ██████      [0m\n[38;5;196m     ██████████████████     [0m\n[38;5;196m    ████████████████████    [0m\n[38;5;196m   ██████████████████████   [0m\n[38;5;196m  ████████████████████████  [0m\n[38;5;160m      ██████████████      [0m\n[38;5;160m       ████████████       [0m\n        ";return console.log(t),new g(!0,t,void 0)}execute(t){try{return this.parseAndExecuteCommands(t)}catch{return new g(!1,"Command execution failed",void 0)}}start(){this.gameWorld.getAllPlugins().forEach((t=>{const e=t.constructor.name;try{for(let s of Object.keys(t.constructor.commands))this.globalCommands.has(s)?this.globalCommands.set(s,void 0):this.globalCommands.set(s,e)}catch{}}))}parseAndExecuteCommands(t,e=0){console.log("---".repeat(e)+"Parsing: "+t);const s=[];let n="",i=!1,o=!1,r=0;t=t.trim();for(let a=0;a<t.length;a++){const h=t[a];if(r>0){if("{"===h){r++,n+=h;continue}if("}"===h){if(r--,0===r){const t=this.parseAndExecuteCommands(n,e+1);s.push(t.data),n=""}else n+=h;continue}n+=h}else if(o){if('"'===h){s.push(n),n="",o=!1;continue}n+=h}else if(i){if("'"===h){s.push(n),n="",i=!1;continue}n+=h}else'"'!==h?"'"!==h?"{"!==h?" "!==h?n+=h:""!==n.trim()&&(s.push(n),n=""):r++:i=!0:o=!0}""!==n.trim()&&s.push(n),console.log("---".repeat(e)+"Parsing result: ",s);const a=s[0].split(":");if(2===a.length){const t=a[0],e=this.gameWorld.getAllPlugins().find((e=>e.cliGetName()===t));return e?this.executeParsedCommand(e,a[1],...s.slice(1)):new g(!1,`Plugin ${t} not found`,void 0)}if(1!==a.length)return new g(!1,"No command found",void 0);try{if(!this.globalCommands.has(a[0]))return new g(!1,`Command ${a[0]} not found`,void 0);const t=this.globalCommands.get(a[0]);if(!t)return new g(!1,'More than one command found, use "/<plugin>:<command>" (fe /cli:help) instead.',void 0);const e=this.gameWorld.getPluginByName(t);return this.executeParsedCommand(e,a[0],...s.slice(1))}catch{return new g(!1,"Command not found or wrong syntax",void 0)}}executeParsedCommand(t,e,...s){if(void 0===t.constructor.commands[e])return new g(!1,`Command ${e} not found`,void 0);try{return t.constructor.commands[e].apply(t,s)}catch{}return new g(!1,`Failed to execute command ${e} on ${t.cliGetName()}`,void 0)}};qe([m("echo","<message: string>","string"),Ve("design:type",Function),Ve("design:paramtypes",[String]),Ve("design:returntype",g)],ze.prototype,"echo",null),qe([m("loop","<iterations: int> <command: string>","string"),Ve("design:type",Function),Ve("design:paramtypes",[Number,String]),Ve("design:returntype",g)],ze.prototype,"loop",null),qe([m("true",void 0,"bool"),Ve("design:type",Function),Ve("design:paramtypes",[]),Ve("design:returntype",g)],ze.prototype,"true",null),qe([m("false",void 0,"bool"),Ve("design:type",Function),Ve("design:paramtypes",[]),Ve("design:returntype",g)],ze.prototype,"false",null),qe([m("int","<value: string>","number"),Ve("design:type",Function),Ve("design:paramtypes",[String]),Ve("design:returntype",g)],ze.prototype,"int",null),qe([m("float","<value: string>","number"),Ve("design:type",Function),Ve("design:paramtypes",[String]),Ve("design:returntype",g)],ze.prototype,"float",null),qe([m("refresh"),Ve("design:type",Function),Ve("design:paramtypes",[]),Ve("design:returntype",g)],ze.prototype,"refresh",null),qe([m("randomcolor",void 0,"rgb"),Ve("design:type",Function),Ve("design:paramtypes",[]),Ve("design:returntype",g)],ze.prototype,"getrandomcolor",null),qe([m("help"),Ve("design:type",Function),Ve("design:paramtypes",[]),Ve("design:returntype",g)],ze.prototype,"help",null),qe([m("art"),Ve("design:type",Function),Ve("design:paramtypes",[]),Ve("design:returntype",g)],ze.prototype,"art",null),ze=qe([f("cli")],ze);var $e=function(){function t(){this.ansi_colors=[[{rgb:[0,0,0],class_name:"ansi-black"},{rgb:[187,0,0],class_name:"ansi-red"},{rgb:[0,187,0],class_name:"ansi-green"},{rgb:[187,187,0],class_name:"ansi-yellow"},{rgb:[0,0,187],class_name:"ansi-blue"},{rgb:[187,0,187],class_name:"ansi-magenta"},{rgb:[0,187,187],class_name:"ansi-cyan"},{rgb:[255,255,255],class_name:"ansi-white"}],[{rgb:[85,85,85],class_name:"ansi-bright-black"},{rgb:[255,85,85],class_name:"ansi-bright-red"},{rgb:[0,255,0],class_name:"ansi-bright-green"},{rgb:[255,255,85],class_name:"ansi-bright-yellow"},{rgb:[85,85,255],class_name:"ansi-bright-blue"},{rgb:[255,85,255],class_name:"ansi-bright-magenta"},{rgb:[85,255,255],class_name:"ansi-bright-cyan"},{rgb:[255,255,255],class_name:"ansi-bright-white"}]],this.setup_256_palette(),this.useClasses=!1,this.escapeForHtml=!0,this.bright=!1,this.fg=this.bg=null,this._buffer=""}return Object.defineProperty(t.prototype,"useClasses",{get:function(){return this._useClasses},set:function(t){this._useClasses=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"escapeForHtml",{get:function(){return this._escapeForHtml},set:function(t){this._escapeForHtml=t},enumerable:!0,configurable:!0}),t.prototype.setup_256_palette=function(){var t=this;this.palette_256=[],this.ansi_colors.forEach((function(e){e.forEach((function(e){t.palette_256.push(e)}))}));for(var e=[0,95,135,175,215,255],s=0;s<6;++s)for(var n=0;n<6;++n)for(var i=0;i<6;++i){var o={rgb:[e[s],e[n],e[i]],class_name:"truecolor"};this.palette_256.push(o)}for(var r=8,a=0;a<24;++a,r+=10)o={rgb:[r,r,r],class_name:"truecolor"},this.palette_256.push(o)},t.prototype.doEscape=function(t){return t.replace(/[&<>]/gm,(function(t){return"&"===t?"&amp;":"<"===t?"&lt;":">"===t?"&gt;":void 0}))},t.prototype.old_linkify=function(t){return t.replace(/(https?:\/\/[^\s]+)/gm,(function(t){return'<a href="'+t+'">'+t+"</a>"}))},t.prototype.detect_incomplete_ansi=function(t){return!/.*?[\x40-\x7e]/.test(t)},t.prototype.detect_incomplete_link=function(t){for(var e=!1,s=t.length-1;s>0;s--)if(/\s|\x1B/.test(t[s])){e=!0;break}if(!e)return/(https?:\/\/[^\s]+)/.test(t)?0:-1;var n=t.substr(s+1,4);return 0===n.length?-1:0==="http".indexOf(n)?s+1:void 0},t.prototype.ansi_to_html=function(t){var e=this,s=this._buffer+t;this._buffer="";var n=s.split(/\x1B\[/);1===n.length&&n.push("");var i=n[n.length-1];i.length>0&&this.detect_incomplete_ansi(i)?(this._buffer="["+i,n.pop(),n.push("")):(""===i.slice(-1)&&(this._buffer="",console.log("raw",n),n.pop(),n.push(i.substr(0,i.length-1)),console.log(n),console.log(i)),2===n.length&&""==n[1]&&""==n[0].slice(-1)&&(this._buffer="",i=n.shift(),n.unshift(i.substr(0,i.length-1))));var o=this.wrap_text(n.shift()),r=n.map((function(t){return e.wrap_text(e.process_ansi(t))}));return o.length>0&&r.unshift(o),r.join("")},t.prototype.ansi_to_text=function(t){var e=this,s=t.split(/\x1B\[/),n=s.shift(),i=s.map((function(t){return e.process_ansi(t)}));return n.length>0&&i.unshift(n),i.join("")},t.prototype.wrap_text=function(t){if(0===t.length)return t;if(this._escapeForHtml&&(t=this.doEscape(t)),!this.bright&&null===this.fg&&null===this.bg)return t;var e=[],s=[],n=this.fg,i=this.bg;null===n&&this.bright&&(n=this.ansi_colors[1][7]),this._useClasses?(n&&("truecolor"!==n.class_name?s.push(n.class_name+"-fg"):e.push("color:rgb("+n.rgb.join(",")+")")),i&&("truecolor"!==i.class_name?s.push(i.class_name+"-bg"):e.push("background-color:rgb("+i.rgb.join(",")+")"))):(n&&e.push("color:rgb("+n.rgb.join(",")+")"),i&&e.push("background-color:rgb("+i.rgb+")"));var o="",r="";return s.length&&(o=' class="'+s.join(" ")+'"'),e.length&&(r=' style="'+e.join(";")+'"'),"<span"+o+r+">"+t+"</span>"},t.prototype.process_ansi=function(t){this._sgr_regex||(this._sgr_regex=((n=["\n              ^                           # beginning of line\n              ([!<-?]?)             # a private-mode char (!, <, =, >, ?)\n              ([d;]*)                    # any digits or semicolons\n              ([ -/]?               # an intermediate modifier\n               [@-~])               # the command\n              ([sS]*)                   # any text following this CSI sequence\n              "]).raw=["\n              ^                           # beginning of line\n              ([!\\x3c-\\x3f]?)             # a private-mode char (!, <, =, >, ?)\n              ([\\d;]*)                    # any digits or semicolons\n              ([\\x20-\\x2f]?               # an intermediate modifier\n               [\\x40-\\x7e])               # the command\n              ([\\s\\S]*)                   # any text following this CSI sequence\n              "],this.rgx(n)));var e=t.match(this._sgr_regex);if(!e)return t;var s=e[4];if(""!==e[1]||"m"!==e[3])return s;for(var n,i=e[2].split(";");i.length>0;){var o=i.shift(),r=parseInt(o,10);if(isNaN(r)||0===r)this.fg=this.bg=null,this.bright=!1;else if(1===r)this.bright=!0;else if(22===r)this.bright=!1;else if(39===r)this.fg=null;else if(49===r)this.bg=null;else if(r>=30&&r<38){var a=this.bright?1:0;this.fg=this.ansi_colors[a][r-30]}else if(r>=90&&r<98)this.fg=this.ansi_colors[1][r-90];else if(r>=40&&r<48)this.bg=this.ansi_colors[0][r-40];else if(r>=100&&r<108)this.bg=this.ansi_colors[1][r-100];else if((38===r||48===r)&&i.length>0){var h=38===r,l=i.shift();if("5"===l&&i.length>0){var c=parseInt(i.shift(),10);c>=0&&c<=255&&(h?this.fg=this.palette_256[c]:this.bg=this.palette_256[c])}if("2"===l&&i.length>2){var d=parseInt(i.shift(),10),u=parseInt(i.shift(),10),p=parseInt(i.shift(),10);if(d>=0&&d<=255&&u>=0&&u<=255&&p>=0&&p<=255){var g={rgb:[d,u,p],class_name:"truecolor"};h?this.fg=g:this.bg=g}}}}return s},t.prototype.rgx=function(t){for(var e=[],s=1;s<arguments.length;s++)e[s-1]=arguments[s];var n=t.raw[0].replace(/^\s+|\s+\n|\s+#[\s\S]+?\n/gm,"");return new RegExp(n,"m")},t}(),He=function(t,e,s,n){var i,o=arguments.length,r=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,s):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,s,n);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(r=(o<3?i(r):o>3?i(e,s,r):i(e,s))||r);return o>3&&r&&Object.defineProperty(e,s,r),r},Ke=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};class Ye extends v{message;constructor(t){super(),this.message=t}}let Xe=class extends w{name="ConsolePlugin";messageEnteredEvent=new x;isVisible=!0;consoleWrapper=document.createElement("div");buffer="";history=[""];historyIndex=0;constructor(){super(),document.body.appendChild(this.consoleWrapper),this.consoleWrapper.innerHTML=this.getInnerHtml()}start(){this.getPlugin(N).KeyDownEvent.subscribe(this,"keydown"),this.getPlugin(N).BlockedKeyDownEvent.subscribe(this,"keydown"),this.messageEnteredEvent.register(this.gameWorld)}event(t,e){const s=t.key;let n;try{n=this.consoleWrapper.querySelector(".console-input")}catch{}if(n){if(this.isFocused()){if("arrowup"==s&&this.historyIndex<this.history.length-1&&(this.historyIndex++,n.value=this.history[this.historyIndex]),"arrowdown"==s&&this.historyIndex>0&&(this.historyIndex--,console.log(this.historyIndex),console.log(this.history),n.value=this.history[this.historyIndex]),"escape"==s&&(n.blur(),n.value=""),"enter"==s){const t=n.value.trim();""!==t&&(n.value="",console.log("Sending:",t),this.messageEntered(t)),n.blur()}}else if("enter"==s&&this.isVisible&&n.focus(),"t"==s)try{this.isVisible?(document.body.removeChild(this.consoleWrapper),n.blur()):document.body.appendChild(this.consoleWrapper),this.isVisible=!this.isVisible}catch(t){console.log("Error: ",t)}this.getPlugin(N).block=this.isFocused()}}isFocused(){try{const t=this.consoleWrapper.querySelector(".console-input");return null!=t&&document.activeElement===t}catch{return!1}}writeLine(t){this.buffer+=t+"\r\n",this.setStatus("white"),this.updateConsole()}messageEntered(t){if(t.startsWith("/")){this.buffer+=t+"\n";const e=this.getPlugin(ze).execute(t.slice(1));""!=e.message&&(this.buffer+=e.message+"\r\n"),e.status?this.setStatus("#485b49"):this.setStatus("#813136")}else this.buffer+=t+"\r\n",this.setStatus("white"),this.messageEnteredEvent.emit(new Ye(t));this.history[0]=t,this.history.unshift(""),this.historyIndex=0,this.updateConsole()}setStatus(t){try{const e=this.consoleWrapper.querySelector(".console-status");if(null==e)return;e.style.backgroundColor=t.toString()}catch{}}updateConsole(){this.setElementsHtml(this.buffer)}setElementsHtml(t){try{const e=this.consoleWrapper.querySelector(".console-content");if(null==e)return;e.innerHTML="";const s=t.split("\n");for(let t=0;t<s.length-1;t++){const n=s[t],i=(new $e).ansi_to_html(n);let o=document.createElement("span");o.innerHTML=i,e.appendChild(o);const r=document.createElement("hr");r.className="console-item-separator",n.endsWith("\r")?e.appendChild(r):e.appendChild(document.createElement("br"))}}catch{}}getInnerHtml(){return`\n            <style>\n                .console{\n                    ${this.isVisible?"":"display: none;"}\n                    position: fixed;\n                    top: 20px;\n                    right: 20px;\n                    \n                    width: 400px;\n                    padding: 20px;\n                    border-radius: 20px;\n                    background-color: rgba(42, 43, 46, 0.382);\n                    color: white;\n                    font-family: "IBM Plex Mono", monospace;\n                    pointer-events: none;\n                    overflow: hidden;\n                }\n                .console-status{\n                    margin: 7px 0;\n                    height: 6px;\n                    background-color: white;\n                    opacity: 1;\n                    border-radius: 999px;\n                }\n                .console-header{\n                    font-size: 20px;\n                    font-weight: bold;\n                    height: 40px;\n                    color: white;\n                    margin-bottom: 10px;\n                    user-select: none;\n                }\n                .console-input{\n                    width: 100%; \n                    padding: 5px 0;\n                    margin: 0;\n                    border-radius: 0; \n                    border: none; \n                    border-bottom: 1px solid rgba(240, 240, 240, 0.5);\n                    background-color: transparent; \n                    color: white;\n                    font-size: 20px;   \n                }\n                .console *::selection {\n                    background-color: #546855;\n                    color: white;\n                }\n                .console-input:focus{\n                    outline: none; \n                    border-bottom: 1px solid rgba(240, 240, 240, 0.85);\n                }\n                .console-content-wrapper{\n                    position: relative;\n                    height: 600px;\n                    width: 100%;\n                    overflow: hidden;\n                }\n                .console-content{\n                    white-space: pre-wrap;\n                    word-wrap: break-word;\n                    position: absolute;\n                    width: 100%;\n                    line-height: 20px;\n                    font-size: 20px;\n                    margin: 0;\n                    bottom: 0;\n                }\n                .console-item-separator{\n                    border: none;\n                    border-top: 1px dashed gray;\n                    opacity: 0.75;\n                    margin: 9.5px 0;\n                }t\n            </style>\n\n            <div class="console">\n                <div class="console-header">\n                    <h2 style="margin: 0">Console <span style="opacity: 0.5">[T]</span></h2>\n                </div>\n                <div class="console-status"></div>\n                <div class="console-content-wrapper">\n                    <pre class="console-content"></pre>\n                </div>\n                    <input class="console-input" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" type="text" tabindex="-1" placeholder="Type your command here..." />\n            </div>\n            `}clearConsole(){return this.buffer="",this.updateConsole(),new g(!0,"",void 0)}};He([m("clear"),Ke("design:type",Function),Ke("design:paramtypes",[]),Ke("design:returntype",g)],Xe.prototype,"clearConsole",null),Xe=He([f("console"),Ke("design:paramtypes",[])],Xe);class Je extends w{name="ClientPlugin";socket;start(){this.getPlugin(Xe)?.messageEnteredEvent.subscribe(this,"chatMessageEvent"),this.socket=Fe("http://localhost:8001",{}),this.socket.on("connect",(()=>this.onConnection())),this.socket.on("disconnect",(t=>this.onDisconnection(t))),this.socket.on("chat_message",(t=>this.onChatMessage(t)))}event(t,e){let s=t;this.sendChatMessage(s.message)}sendChatMessage(t){this.socket.emit("chat_message",t)}onConnection(){console.log("Connected to server")}onDisconnection(t){console.log(`Disconnected from server: ${t}`)}onChatMessage(t){console.log(`Received chat message: ${t}`)}}!async function(t){const e=new mt(new V,new Je,new ze,new N,new C(t),new Z,new xt,new bt,new U,new Xe,new dt,new I,new _t,new yt(t.getContext("2d")));console.log(e.getAllPlugins()),function t(){e.tick(),requestAnimationFrame(t)}()}(document.getElementById("gameCanvas"));