var t={m:{},u:t=>t+".bundle.js",o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};(()=>{var e;if("string"==typeof import.meta.url&&(e=import.meta.url),!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),t.p=e})(),t.b=new URL("./",import.meta.url);class e{enabled=!0;gameObject;start(){}event(t,e){}getGameWorld(){return this.gameObject.getGameWorld()}hasComponent(t){return this.gameObject.hasComponent(t)}getComponent(t){return this.gameObject.getComponent(t)}getAllComponents(){return this.gameObject.getAllComponents()}getTransform(){return this.gameObject.getTransform()}getGameObject(){return this.gameObject}getPlugin(t){return this.getGameWorld().getPlugin(t)}isEnabled(){return this.gameObject.enabled&&this.enabled}enable(t=!0){this.enabled=t}}class n{static symRand(t){return(2*Math.random()-1)*t}static getColliderRadius(t,e){if(t>=10)return e;const n=Math.PI/t;return(Math.cos(n)*e*2+e)/3}static deltaAngle(t,e){return t=t%(2*Math.PI)+2*Math.PI,t%=2*Math.PI,((e=(e=e%(2*Math.PI)+2*Math.PI)%(2*Math.PI)+2*Math.PI)-t+Math.PI)%(2*Math.PI)-Math.PI}static elasticCollision1D(t,e,n,s){return[(e*(t-n)+2*n*s)/(t+n),(s*(n-t)+2*t*e)/(t+n)]}}class s{x=0;y=0;constructor(t,e){this.x=t,this.y=e}add(t){return new s(this.x+t.x,this.y+t.y)}sub(t){return new s(this.x-t.x,this.y-t.y)}times(t){return new s(this.x*t,this.y*t)}timesV(t){return new s(this.x*t.x,this.y*t.y)}distance(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))}static distance(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}magnitude(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))}cross(){return new s(this.y,-this.x).toUnit()}scalarProduct(t){return this.x*t.x+this.y*t.y}vectorProduct(t){return this.x*t.y-this.y*t.x}perpendicular(t){return this.sub(t.cross().times(t.scalarProduct(this)/(t.magnitude()*t.magnitude())))}toUnit(){return 0!=this.magnitude()?new s(this.x,this.y).times(1/this.magnitude()):new s(1,0)}setLength(t){return this.toUnit().times(t)}toString(){return"{"+this.x+":"+this.y+"}"}toRad(){return Math.atan2(this.y,this.x)}reverse(){let t=1e32,e=1e32;return 0!=this.x&&(t=1/this.x),0!=this.y&&(e=1/this.y),new s(t,e)}interpolate(t,e){const n=t.sub(this),s=n.sub(n.times(Math.min(1,Math.max(0,e))));return this.add(s)}static fromRad(t){return new s(Math.cos(t),Math.sin(t))}static randomPos(t){return new s(n.symRand(t),n.symRand(t))}static randomPos2(t){let e=n.symRand(Math.PI),i=Math.random()*t;return s.fromRad(e).times(i)}clone(){return new s(this.x,this.y)}static zero(){return new s(0,0)}static one(){return new s(1,1)}static up(){return new s(0,1)}static down(){return new s(0,-1)}static left(){return new s(-1,0)}static right(){return new s(1,0)}}class i extends e{velocity;acceleration=s.zero();mass=1;dampingFactor;angularVelocity=0;angularAcceleration=0;angularDrag=.25;constructor(t,e=.45){super(),this.velocity=new s(15*Math.random()*2-15,15*Math.random()*2-15),this.dampingFactor=e,this.mass=t}update(t){this.velocity=this.velocity.add(this.acceleration.times(t)),this.velocity=this.velocity.times(Math.pow(this.dampingFactor,t)),this.getTransform().position=this.getTransform().position.add(this.velocity.times(t)),this.getTransform().position=this.getTransform().position.add(this.acceleration.times(t*t/2)),this.angularVelocity=this.angularVelocity+this.angularAcceleration*t,this.angularVelocity=this.angularVelocity*Math.pow(this.angularDrag,t),this.getTransform().rotation+=this.angularVelocity*t}}class o{r=0;g=0;b=0;a=1;static stroke=new o(43,43,44);static background=new o(93,97,95);constructor(t,e,n,s=1){this.r=Math.min(255,Math.max(0,t)),this.g=Math.min(255,Math.max(0,e)),this.b=Math.min(255,Math.max(0,n)),this.a=Math.min(1,Math.max(0,s))}toString(){return`rgba(${this.r},${this.g},${this.b},${Math.max(0,Math.min(this.a,1))})`}toRgb(){return new o(this.r,this.g,this.b)}toArgb(t){return new o(this.r,this.g,this.b,t)}blend(t,e){return new o(this.r*(1-e)+t.r*e,this.g*(1-e)+t.g*e,this.b*(1-e)+t.b*e,this.a*(1-e)+t.a*e)}static randomColor(){return new o(255*Math.random(),255*Math.random(),255*Math.random())}static hslToRgb(t,e,n){n/=100;const s=e=>(e+t/30)%12,i=(e/=100)*Math.min(n,1-n),r=t=>n-i*Math.max(-1,Math.min(s(t)-3,Math.min(9-s(t),1))),a=Math.round(255*r(0)),l=Math.round(255*r(8)),h=Math.round(255*r(4));return new o(a,l,h)}static randomColor2(){const t=Math.floor(360*Math.random()),e=Math.floor(30*Math.random())+15,n=Math.floor(20*Math.random())+30;return o.hslToRgb(t,e,n)}static getHeatmapColor(t){t=Math.max(0,Math.min(1,t));let e=Math.min(255,Math.max(0,Math.floor(255*t*2))),n=Math.min(255,Math.max(0,Math.floor(255*(2-2*t))));return new o(n/1.5,e/1.5,0,255)}static tryParseCssColor(t){let e=document.body,n=e.style.color;e.style.color=t;let s=getComputedStyle(e).color;return e.style.color=n,this.getRgbFromComputedStyle(s)}static getRgbFromComputedStyle(t){let e=t.match(/^rgb(a?)\((\d+),\s*(\d+),\s*(\d+)(?:,\s*([\d.]+))?\)$/);if(e)return new o(parseInt(e[2]),parseInt(e[3]),parseInt(e[4]),parseFloat(e[5]??1))}clone(){return new o(this.r,this.g,this.b,this.a)}}class r{position;rotation;scale;constructor(t=new s(0,0),e=0,n=s.one()){this.position=t,this.rotation=e,this.scale=n}static fromPosition(t){let e=new r;return e.position=t,e}clone(){let t=new r;return t.position=this.position.clone(),t.scale=this.scale.clone(),t.rotation=this.rotation,t}}const a={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let l;const h=new Uint8Array(16),c=[];for(let t=0;t<256;++t)c.push((t+256).toString(16).slice(1));const g=function(t,e,n){if(a.randomUUID&&!e&&!t)return a.randomUUID();const s=(t=t||{}).random??t.rng?.()??function(){if(!l){if("undefined"==typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");l=crypto.getRandomValues.bind(crypto)}return l(h)}();if(s.length<16)throw new Error("Random bytes length must be >= 16");if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,e){if((n=n||0)<0||n+16>e.length)throw new RangeError(`UUID byte range ${n}:${n+15} is out of buffer bounds`);for(let t=0;t<16;++t)e[n+t]=s[t];return e}return function(t,e=0){return(c[t[e+0]]+c[t[e+1]]+c[t[e+2]]+c[t[e+3]]+"-"+c[t[e+4]]+c[t[e+5]]+"-"+c[t[e+6]]+c[t[e+7]]+"-"+c[t[e+8]]+c[t[e+9]]+"-"+c[t[e+10]]+c[t[e+11]]+c[t[e+12]]+c[t[e+13]]+c[t[e+14]]+c[t[e+15]]).toLowerCase()}(s)};class d{enabled=!0;name="UnnamedGameObject";transform=new r;components=new Map;id=g();gameWorld;constructor(...t){for(let e of t){let t=e.constructor.name;if(this.components.has(t))throw new Error(`Component ${t} already exists in the game object`);e.gameObject=this,this.components.set(t,e)}}hasComponent(t){return this.components.has(t.name)}getComponent(t){const e=t.name;return this.components.get(e)}getAllComponents(t=!1){return Array.from(this.components.values()).filter((e=>!t||e.isEnabled()))}destroy(){this.gameWorld.destroy(this)}spawn(t){return t.spawn(this)}getId(){return this.id}getTransform(){return this.transform}getGameWorld(){return this.gameWorld}}class m{status;message;data;constructor(t,e,n){this.status=t,this.message=e,this.data=n}}function u(t,e,n){return function(s,i,o){const r=o.value;if(r){(e=e??"")&&(e=" "+e),(n=n??"void")&&(n=": "+n),e=(t=t??i)+e+n;const o=s.constructor;Object.prototype.hasOwnProperty.call(o,"commands")||(o.commands=Object.assign({},o.commands||{})),o.commands[t]=r,Object.prototype.hasOwnProperty.call(o,"syntaxes")||(o.syntaxes=Object.assign({},o.syntaxes||{})),console.log("Adding syntax:",e),o.syntaxes[t]=e}}}function p(t){return function(e){e.prototype.cliGetName=function(){return t}}}var f=function(t,e,n,s){var i,o=arguments.length,r=o<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,n):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,n,s);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(r=(o<3?i(r):o>3?i(e,n,r):i(e,n))||r);return o>3&&r&&Object.defineProperty(e,n,r),r},y=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};class w{gameWorld;enabled=!0;name="Plugin";event(t,e){}start(){}update(t){}getPlugin(t){return this.gameWorld.getPlugin(t)}hasPlugin(t){return this.gameWorld.hasPlugin(t)}isEnabled(){return this.enabled}enable(t=!0){this.enabled=t}disable(){this.enabled=!1}cliGetName(){return this.name}help(){let t=`[36m${this.cliGetName()}[0m commands:\n`;for(const e of Object.values(this.constructor.syntaxes))t+=`  /${this.cliGetName()}:${e}\n`;return new m(!0,t,void 0)}cliEnable(){return this.enabled=!0,new m(!0,`${this.name} [32menabled[0m`,void 0)}cliDisable(){return this.enabled=!1,new m(!0,`${this.name} [31mdisabled[0m`,void 0)}}f([u("help"),y("design:type",Function),y("design:paramtypes",[]),y("design:returntype",m)],w.prototype,"help",null),f([u("enable"),y("design:type",Function),y("design:paramtypes",[]),y("design:returntype",m)],w.prototype,"cliEnable",null),f([u("disable"),y("design:type",Function),y("design:paramtypes",[]),y("design:returntype",m)],w.prototype,"cliDisable",null);class b{constructor(){}}class x{subs=new Map;args=[];subscribe(t,e){this.subs.set(new WeakRef(t),e)}unsubscribe(t){this.subs.delete(new WeakRef(t))}emit(t){this.args.push(t)}register(t){t.registerEvent(this)}invoke(){if(0!=this.args.length){for(const[t,e]of this.subs){const n=t.deref();if(n)for(const t of this.args)n.event(t,e);else this.subs.delete(t)}this.args=[]}}}class v extends b{delta;constructor(t){super(),this.delta=t}}class P extends b{button;constructor(t){super(),this.button=t}}class C extends w{name="MousePlugin";mouseScrollYEvent=new x;mouseDownEvent=new x;mouseUpEvent=new x;pressedKeys=new Set;canvas;position=s.zero();constructor(t){super(),this.canvas=t,this.trackMouse(t)}start(){this.mouseScrollYEvent.register(this.gameWorld),this.mouseDownEvent.register(this.gameWorld),this.mouseUpEvent.register(this.gameWorld)}isKeyDown(t=0){return this.pressedKeys.has(t)}getMouseScreenPosition(){const t=window.devicePixelRatio||1;return new s(this.position.x*t,this.position.y*t)}trackMouse(t){t.addEventListener("mousemove",(e=>{const n=t.getBoundingClientRect();let i=e.clientX-n.left,o=e.clientY-n.top;this.position=new s(i,o)})),t.addEventListener("mousedown",(t=>{this.pressedKeys.add(t.button),this.mouseDownEvent.emit(new P(t.button))})),t.addEventListener("mouseup",(t=>{this.pressedKeys.delete(t.button),this.mouseUpEvent.emit(new P(t.button))})),t.addEventListener("wheel",(t=>{this.mouseScrollYEvent.emit(new v(t.deltaY))}))}}class M extends b{collider;constructor(t){super(),this.collider=t}}class S extends e{offset=s.zero();radius;isActive=!1;isStatic;avoidObjectes;collisions=new Set;onCollisionEnterEvent=new x;onCollisionExitEvent=new x;constructor(t=1,e=!0,...n){super(),this.radius=t,this.isStatic=e,this.avoidObjectes=new Set,n.forEach((t=>this.avoidObjectes.add(t)))}start(){this.onCollisionEnterEvent.register(this.getGameWorld()),this.onCollisionExitEvent.register(this.getGameWorld())}getCenter(){return this.getTransform().position.add(this.offset)}getAABB(){const t=this.getCenter();return{colliderId:this.getGameObject().getId(),minX:t.x-this.radius,minY:t.y-this.radius,maxX:t.x+this.radius,maxY:t.y+this.radius}}collides(t){return this.getCenter().sub(t.getCenter()).magnitude()<=this.radius+t.radius&&!this.avoidObjectes.has(t.getGameObject())&&!t.avoidObjectes.has(this.getGameObject())}onCollisionEnter(t){this.onCollisionEnterEvent.emit(new M(t))}onCollisionExit(t){this.onCollisionExitEvent.emit(new M(t))}}function T(t,e,n=0,s=t.length-1,i=E){for(;s>n;){if(s-n>600){const o=s-n+1,r=e-n+1,a=Math.log(o),l=.5*Math.exp(2*a/3),h=.5*Math.sqrt(a*l*(o-l)/o)*(r-o/2<0?-1:1);T(t,e,Math.max(n,Math.floor(e-r*l/o+h)),Math.min(s,Math.floor(e+(o-r)*l/o+h)),i)}const o=t[e];let r=n,a=s;for(W(t,n,e),i(t[s],o)>0&&W(t,n,s);r<a;){for(W(t,r,a),r++,a--;i(t[r],o)<0;)r++;for(;i(t[a],o)>0;)a--}0===i(t[n],o)?W(t,n,a):(a++,W(t,a,s)),a<=e&&(n=a+1),e<=a&&(s=a-1)}}function W(t,e,n){const s=t[e];t[e]=t[n],t[n]=s}function E(t,e){return t<e?-1:t>e?1:0}class O{constructor(t=9){this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()}all(){return this._all(this.data,[])}search(t){let e=this.data;const n=[];if(!Y(t,e))return n;const s=this.toBBox,i=[];for(;e;){for(let o=0;o<e.children.length;o++){const r=e.children[o],a=e.leaf?s(r):r;Y(t,a)&&(e.leaf?n.push(r):F(t,a)?this._all(r,n):i.push(r))}e=i.pop()}return n}collides(t){let e=this.data;if(!Y(t,e))return!1;const n=[];for(;e;){for(let s=0;s<e.children.length;s++){const i=e.children[s],o=e.leaf?this.toBBox(i):i;if(Y(t,o)){if(e.leaf||F(t,o))return!0;n.push(i)}}e=n.pop()}return!1}load(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(let e=0;e<t.length;e++)this.insert(t[e]);return this}let e=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===e.height)this._splitRoot(this.data,e);else{if(this.data.height<e.height){const t=this.data;this.data=e,e=t}this._insert(e,this.data.height-e.height-1,!0)}else this.data=e;return this}insert(t){return t&&this._insert(t,this.data.height-1),this}clear(){return this.data=V([]),this}remove(t,e){if(!t)return this;let n=this.data;const s=this.toBBox(t),i=[],o=[];let r,a,l;for(;n||i.length;){if(n||(n=i.pop(),a=i[i.length-1],r=o.pop(),l=!0),n.leaf){const s=_(t,n.children,e);if(-1!==s)return n.children.splice(s,1),i.push(n),this._condense(i),this}l||n.leaf||!F(n,s)?a?(r++,n=a.children[r],l=!1):n=null:(i.push(n),o.push(r),r=0,a=n,n=n.children[0])}return this}toBBox(t){return t}compareMinX(t,e){return t.minX-e.minX}compareMinY(t,e){return t.minY-e.minY}toJSON(){return this.data}fromJSON(t){return this.data=t,this}_all(t,e){const n=[];for(;t;)t.leaf?e.push(...t.children):n.push(...t.children),t=n.pop();return e}_build(t,e,n,s){const i=n-e+1;let o,r=this._maxEntries;if(i<=r)return o=V(t.slice(e,n+1)),k(o,this.toBBox),o;s||(s=Math.ceil(Math.log(i)/Math.log(r)),r=Math.ceil(i/Math.pow(r,s-1))),o=V([]),o.leaf=!1,o.height=s;const a=Math.ceil(i/r),l=a*Math.ceil(Math.sqrt(r));$(t,e,n,l,this.compareMinX);for(let i=e;i<=n;i+=l){const e=Math.min(i+l-1,n);$(t,i,e,a,this.compareMinY);for(let n=i;n<=e;n+=a){const i=Math.min(n+a-1,e);o.children.push(this._build(t,n,i,s-1))}}return k(o,this.toBBox),o}_chooseSubtree(t,e,n,s){for(;s.push(e),!e.leaf&&s.length-1!==n;){let n,s=1/0,r=1/0;for(let a=0;a<e.children.length;a++){const l=e.children[a],h=B(l),c=(i=t,o=l,(Math.max(o.maxX,i.maxX)-Math.min(o.minX,i.minX))*(Math.max(o.maxY,i.maxY)-Math.min(o.minY,i.minY))-h);c<r?(r=c,s=h<s?h:s,n=l):c===r&&h<s&&(s=h,n=l)}e=n||e.children[0]}var i,o;return e}_insert(t,e,n){const s=n?t:this.toBBox(t),i=[],o=this._chooseSubtree(s,this.data,e,i);for(o.children.push(t),G(o,s);e>=0&&i[e].children.length>this._maxEntries;)this._split(i,e),e--;this._adjustParentBBoxes(s,i,e)}_split(t,e){const n=t[e],s=n.children.length,i=this._minEntries;this._chooseSplitAxis(n,i,s);const o=this._chooseSplitIndex(n,i,s),r=V(n.children.splice(o,n.children.length-o));r.height=n.height,r.leaf=n.leaf,k(n,this.toBBox),k(r,this.toBBox),e?t[e-1].children.push(r):this._splitRoot(n,r)}_splitRoot(t,e){this.data=V([t,e]),this.data.height=t.height+1,this.data.leaf=!1,k(this.data,this.toBBox)}_chooseSplitIndex(t,e,n){let s,i=1/0,o=1/0;for(let r=e;r<=n-e;r++){const e=R(t,0,r,this.toBBox),a=R(t,r,n,this.toBBox),l=D(e,a),h=B(e)+B(a);l<i?(i=l,s=r,o=h<o?h:o):l===i&&h<o&&(o=h,s=r)}return s||n-e}_chooseSplitAxis(t,e,n){const s=t.leaf?this.compareMinX:j,i=t.leaf?this.compareMinY:I;this._allDistMargin(t,e,n,s)<this._allDistMargin(t,e,n,i)&&t.children.sort(s)}_allDistMargin(t,e,n,s){t.children.sort(s);const i=this.toBBox,o=R(t,0,e,i),r=R(t,n-e,n,i);let a=A(o)+A(r);for(let s=e;s<n-e;s++){const e=t.children[s];G(o,t.leaf?i(e):e),a+=A(o)}for(let s=n-e-1;s>=e;s--){const e=t.children[s];G(r,t.leaf?i(e):e),a+=A(r)}return a}_adjustParentBBoxes(t,e,n){for(let s=n;s>=0;s--)G(e[s],t)}_condense(t){for(let e,n=t.length-1;n>=0;n--)0===t[n].children.length?n>0?(e=t[n-1].children,e.splice(e.indexOf(t[n]),1)):this.clear():k(t[n],this.toBBox)}}function _(t,e,n){if(!n)return e.indexOf(t);for(let s=0;s<e.length;s++)if(n(t,e[s]))return s;return-1}function k(t,e){R(t,0,t.children.length,e,t)}function R(t,e,n,s,i){i||(i=V(null)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(let o=e;o<n;o++){const e=t.children[o];G(i,t.leaf?s(e):e)}return i}function G(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function j(t,e){return t.minX-e.minX}function I(t,e){return t.minY-e.minY}function B(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function A(t){return t.maxX-t.minX+(t.maxY-t.minY)}function D(t,e){const n=Math.max(t.minX,e.minX),s=Math.max(t.minY,e.minY),i=Math.min(t.maxX,e.maxX),o=Math.min(t.maxY,e.maxY);return Math.max(0,i-n)*Math.max(0,o-s)}function F(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function Y(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function V(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function $(t,e,n,s,i){const o=[e,n];for(;o.length;){if((n=o.pop())-(e=o.pop())<=s)continue;const r=e+Math.ceil((n-e)/s/2)*s;T(t,r,e,n,i),o.push(e,r,r,n)}}class X extends w{name="CollisionDetectionPlugin";tree=new O;update(){this.checkCollisions()}overlapPoint(t){return this.tree.search({minX:t.x,minY:t.y,maxX:t.x,maxY:t.y}).map((t=>this.gameWorld.getGameObject(t.colliderId)?.getComponent(S))).filter((e=>e.getCenter().sub(t).magnitude()<e.radius))}checkCollisions(){let t=this.gameWorld.getComponents(S);this.tree.clear(),this.tree.load(t.map((t=>t.getAABB())));for(const e of t)e.isActive=!1;for(const e of t){if(e.isStatic)continue;let t=new Set;const n=this.tree.search(e.getAABB());for(const s of n){const n=this.gameWorld.getGameObject(s.colliderId)?.getComponent(S);if(n&&e!==n){e.collides(n)&&(e.isActive=!0,n.isActive=!0,t.add(n));for(let n of t)e.collisions.has(n)||e.getComponent(S).onCollisionEnter(n);e.collisions.clear(),e.collisions=t}}}}}class z extends b{key;constructor(t){super(),this.key=t}}class H extends w{name="KeyboardPlugin";KeyDownEvent=new x;BlockedKeyDownEvent=new x;block=!1;NowPressedKeys=new Set;pressedKeys=new Set;constructor(){super(),this.pressedKeys=new Set,document.onkeydown=t=>{const e=t.key.toLowerCase();this.pressedKeys.add(e),this.NowPressedKeys.add(e)},document.onkeyup=t=>{const e=t.key.toLowerCase();this.pressedKeys.delete(e)}}isPressed(t){return this.isEnabled()&&!this.block&&this.pressedKeys.has(t)}start(){this.KeyDownEvent.register(this.gameWorld),this.BlockedKeyDownEvent.register(this.gameWorld)}update(t){this.NowPressedKeys.forEach((t=>{this.block?this.BlockedKeyDownEvent.emit(new z(t)):this.KeyDownEvent.emit(new z(t))})),this.NowPressedKeys.clear()}}var N,U=function(t,e,n,s){var i,o=arguments.length,r=o<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,n):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,n,s);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(r=(o<3?i(r):o>3?i(e,n,r):i(e,n))||r);return o>3&&r&&Object.defineProperty(e,n,r),r},K=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};let L=N=class extends w{cameraPositon=new s(4,0);targetCameraPositon=new s(4,0);cameraScreenOffset=new s(100,100);followingSpeed=.02;isFollowing=!0;scaleV=new s(20,-20);scale=20;targetId="None";targetScale=40;name="CameraPlugin";start(){this.getPlugin(C).mouseScrollYEvent.subscribe(this,"scroll"),this.getPlugin(C).mouseDownEvent.subscribe(this,"down"),this.getPlugin(C).mouseUpEvent.subscribe(this,"up")}event(t,e){if("scroll"==e){const e=t;this.zoom(e.delta)}else if("down"==e){if(1!=t.button)return;if(this.gameWorld.getGameObject(this.targetId))return void(this.targetId="None");const e=this.getPlugin(C).getMouseScreenPosition(),n=this.getWorldPosition(e);let s=this.getPlugin(X).overlapPoint(n)[0]?.getGameObject();s&&(this.targetId=s.getId())}}zoom(t){(t=Math.sign(t))>0&&.9*this.targetScale>10&&(this.targetScale=.9*this.targetScale),t<0&&1.1*this.targetScale<100&&(this.targetScale=1.1*this.targetScale)}getWorldPosition(t){let e=this.getPlugin(N).scaleV,n=this.getPlugin(N).cameraPositon;return new s((t.x-this.cameraScreenOffset.x)/e.x,(t.y-this.cameraScreenOffset.y)/e.y).add(n)}update(t){this.isFollowing&&(this.cameraPositon=this.cameraPositon.interpolate(this.targetCameraPositon,Math.pow(this.followingSpeed,t))),this.scale+=(this.targetScale-this.scale)*(1-Math.pow(.002,t)),this.scaleV=new s(this.scale,-this.scale);const e=this.gameWorld.getGameObject(this.targetId);if(e){const n=this.getPlugin(C).getMouseScreenPosition(),s=this.getWorldPosition(n);e.getTransform().position=e.getTransform().position.interpolate(s,Math.pow(.001,t)),this.getPlugin(H).isPressed("2")&&(e.getTransform().rotation+=1.57*t),this.getPlugin(H).isPressed("1")&&(e.getTransform().rotation-=1.57*t)}}getscale(){return new m(!0,this.scaleV.toString(),this.scaleV)}follow(t){return this.isFollowing=t,new m(!0,"Camera is "+(t?"following":"not following"),void 0)}setzoom(t){return this.targetScale=t,new m(!0,`Camera zoom set to ${t}`,void 0)}};U([u("getscale",void 0,"number"),K("design:type",Function),K("design:paramtypes",[]),K("design:returntype",m)],L.prototype,"getscale",null),U([u("follow","<following: boolean>"),K("design:type",Function),K("design:paramtypes",[Boolean]),K("design:returntype",m)],L.prototype,"follow",null),U([u("zoom","<zoom: number>"),K("design:type",Function),K("design:paramtypes",[Number]),K("design:returntype",m)],L.prototype,"setzoom",null),L=N=U([p("camera")],L);class q extends e{zindex;constructor(t=0){super(),this.zindex=t}}class Z extends q{color=new o(42,42,55);text;displayName;constructor(t,e=!1,n=1){super(),this.text=t,this.zindex=n,this.displayName=e}render(t){const e=this.getGameWorld().getPlugin(L).cameraScreenOffset,n=this.getTransform().position.x,s=this.getTransform().position.y,i=(this.getTransform().rotation,this.getTransform().scale),o=this.getGameWorld().getPlugin(L).scaleV,r=this.getGameWorld().getPlugin(L).cameraPositon.x,a=this.getGameWorld().getPlugin(L).cameraPositon.y,l=this.color.toString(),h=n-r,c=s-a;t.fillStyle=l,t.translate(e.x,e.y),t.scale(o.x,o.y),t.translate(h,c),t.scale(i.x,i.y),t.scale(1,-1);const g=this.displayName?this.getGameObject().name:this.text;t.font="bold 1px Arial",t.fillStyle="azure",t.shadowBlur=10;const d=t.measureText(g).width/2;t.strokeText(g,-d,1/4),t.fillText(g,-d,1/4),t.shadowBlur=0,t.setTransform(1,0,0,1,0,0)}}class J extends w{name="ConfigPlugin";config=new Map([["bulletSize",.75],["playerSize",2.5],["bulletColor",new o(56,57,60)],["playerColor",new o(122,111,62)],["playerColor",new o(80,37,36)],["playerColor",new o(59,94,76)],["playerColor",new o(129,49,54)],["playerColor",new o(130,111,51)]]);get(t){if(this.config.has(t))return this.config.get(t)}set(t,e){this.config.set(t,e)}}class Q extends q{activeColor=new o(172,42,55,.125);staticColor=new o(95,64,36,.125);dynamicColor=new o(57,127,31,.125);disabledColor=new o(36,24,36,.125);constructor(t=-1){super(),this.zindex=t}getColor(){let t=this.dynamicColor,e=this.getComponent(S);return e.isEnabled()?e.isActive?t=this.activeColor:e.isStatic&&(t=this.staticColor):t=this.disabledColor,t}render(t){if(!this.getPlugin(J)?.get("displayColliders"))return;const e=this.getComponent(S),n=e.offset,s=e.radius,i=e.radius+.25,o=this.getColor(),r=this.getGameWorld().getPlugin(L).cameraScreenOffset,a=this.getTransform().position.x+n.x,l=this.getTransform().position.y+n.y,h=this.getTransform().rotation,c=this.getGameWorld().getPlugin(L).scaleV,g=a-this.getGameWorld().getPlugin(L).cameraPositon.x,d=l-this.getGameWorld().getPlugin(L).cameraPositon.y;t.save(),t.translate(r.x,r.y),t.scale(c.x,c.y),t.translate(g,d),t.rotate(h),t.strokeStyle=o.toRgb().toString(),t.fillStyle=o.toString(),t.shadowBlur=30,t.beginPath(),t.arc(0,0,i,0,2*Math.PI),t.closePath(),t.fill(),t.stroke(),t.beginPath(),t.arc(0,0,s,0,2*Math.PI),t.closePath(),t.lineWidth=.1,t.stroke(),t.restore()}}class tt{progress=-1;duration=.25;startAnimation=()=>{};endAnimation=()=>{};updateAnimation=()=>{};constructor(t=()=>{},e=()=>{},n=()=>{}){this.updateAnimation=t,this.startAnimation=e,this.endAnimation=n}update(t){if(this.progress>0){let e=(this.duration-this.progress)/this.duration;this.progress-=t,this.updateAnimation(e)}else-1!=this.progress&&(this.endAnimation(),this.progress=-1)}start(){-1==this.progress?(this.startAnimation(),this.progress=this.duration):this.progress=(this.duration+this.progress)/2}}class et extends e{tickCount=0;tick(t){0==this.tickCount?this.start():this.update(t),this.tickCount++}start(){}update(t){}}class nt extends et{shrinkAnimation=new tt;zoomAnimation=new tt;defaultZoom=new s(1,1);constructor(){super(),this.shrinkAnimation=new tt((t=>this.getTransform().scale=this.defaultZoom.times(1-t)),(()=>this.getComponent(rt)?.enable(!1)),(()=>this.getGameObject().destroy())),this.zoomAnimation=new tt((t=>this.getTransform().scale=this.defaultZoom.times(1+Math.sin(Math.PI*t)/5)),(()=>this.defaultZoom=this.getTransform().scale.clone()),(()=>this.getTransform().scale=this.defaultZoom))}update(t){this.shrinkAnimation.update(t),this.zoomAnimation.update(t)}startZoom(){this.zoomAnimation.start()}startShrink(){this.shrinkAnimation.start()}}class st extends q{color;radius;n;constructor(t,e=4,n=0,s=o.randomColor2()){super(),this.radius=t,this.n=e,this.zindex=n,this.color=s}render(t){const e=this.getGameWorld().getPlugin(L).cameraScreenOffset,n=this.getTransform().position.x,s=this.getTransform().position.y,i=this.getTransform().rotation,o=this.getTransform().scale,r=this.getGameWorld().getPlugin(L).scaleV,a=this.getGameWorld().getPlugin(L).cameraPositon.x,l=this.getGameWorld().getPlugin(L).cameraPositon.y,h=this.color.toString(),c=n-a,g=s-l;t.translate(e.x,e.y),t.scale(r.x,r.y),t.translate(c,g),t.rotate(i),t.scale(o.x,o.y);const d=this.radius;if(this.n<10){t.beginPath(),t.moveTo(0,d);const e=2*Math.PI/this.n;for(let n=1;n<this.n;n++)t.lineTo(Math.sin(n*e)*d,Math.cos(n*e)*d);t.closePath()}else t.beginPath(),t.arc(0,0,d,0,2*Math.PI),t.closePath();t.fillStyle=h,t.shadowBlur=0,t.fill(),t.shadowBlur=50,t.stroke(),t.shadowBlur=0,t.setTransform(1,0,0,1,0,0)}}class it extends b{damage;participant;constructor(t,e){super(),this.damage=t,this.participant=e}}class ot extends e{health;maxHealth;damageEvent;constructor(t,e=t){super(),this.health=e,this.maxHealth=t,this.damageEvent=new x}start(){this.damageEvent.register(this.getGameWorld()),this.getComponent(S).onCollisionEnterEvent.subscribe(this,"onCollisionEnter")}event(t){let e=t;this.onCollisionEnter(e.collider)}onCollisionEnter(t){let e=t.getGameObject(),n=e.getComponent(i),s=this.getComponent(i),o=s.mass/(n.mass+s.mass);s.mass<n.mass&&(n.velocity=n.velocity.add(s.velocity.times(o)).times(.5),s.velocity=s.velocity.add(n.velocity.times(1-o).times(.5))),n.angularVelocity+=this.getTransform().position.sub(e.getTransform().position).vectorProduct(s.velocity)*(o/15);try{const t=e.getComponent(ot),n=Math.min(t.health,this.health);if(0==n)return;this.onDamage(n,t),t.onDamage(n,this)}catch{}}getHealth(){return this.health/this.maxHealth}heal(t){this.health=Math.min(this.maxHealth,this.health+t)}onDamage(t,e){if(this.health-=t,this.damageEvent.emit(new it(t,e)),0==this.health){if(this.getComponent(S)?.enable(!1),this.getComponent(i).dampingFactor=.6,this.getComponent(nt)?.startShrink(),e.hasComponent(st)){let t=this.getComponent(st).color.blend(e.getComponent(st).color.toRgb(),.5).toRgb();this.getComponent(st).color=t,e.getComponent(st).color=t}}else this.getComponent(nt)?.startZoom()}}class rt extends q{offset=new s(0,4);fill=.5;width=5;height=.5;constructor(t=0){super(t)}render(t){let e=this.width,n=this.fill;try{n=this.getComponent(ot).getHealth(),e=2+this.getComponent(ot).maxHealth/250}catch{}if(n>=1||n<=0)return;const s=this.getTransform().position.x,i=this.getTransform().position.y,r=this.getTransform().scale,a=this.getGameWorld().getPlugin(L).scaleV,l=this.getGameWorld().getPlugin(L).cameraScreenOffset,h=this.getGameWorld().getPlugin(L).cameraPositon.x,c=this.getGameWorld().getPlugin(L).cameraPositon.y,g=o.getHeatmapColor(n).toString(),d=s-h,m=i-c,u=.25;t.translate(l.x,l.y),t.scale(a.x,a.y),t.translate(d,m),t.scale(r.x,r.y),t.translate(this.offset.x,this.offset.y),t.fillStyle=g,t.shadowBlur=0,t.beginPath(),t.roundRect(-e/2,-this.height/2,e,this.height,u),t.closePath(),t.fillStyle=o.background.toString(),t.fill(),t.beginPath(),t.roundRect(-e/2,-this.height/2,e*n,this.height,u),t.closePath(),t.fillStyle=g,t.fill(),t.beginPath(),t.roundRect(-e/2,-this.height/2,e,this.height,u),t.closePath(),t.shadowBlur=30,t.stroke(),t.beginPath(),t.roundRect(-e/2,-this.height/2,e*n,this.height,u),t.closePath(),t.shadowBlur=0,t.stroke(),t.setTransform(1,0,0,1,0,0)}}class at extends w{name="SchedulerPlugin";schedule=[];addInvoke(t,e,n){let s=new WeakRef(t);this.schedule.push({totalTime:e,subscriber:s,topic:n}),this.schedule.sort(((t,e)=>e.totalTime-t.totalTime))}update(t){const e=this.gameWorld.getWorldTime();if(0!=this.schedule.length)for(;0!=this.schedule.length&&this.schedule[this.schedule.length-1].totalTime<=e;){let t=this.schedule.pop();t.subscriber.deref()?.onInvoke(t.topic)}}}class lt extends e{lifeTime;constructor(t=1){super(),this.lifeTime=t}onInvoke(t){this.getComponent(nt)?.startShrink()}start(){let t=this.getGameWorld().getWorldTime()+this.lifeTime;this.getGameWorld().getPlugin(at).addInvoke(this,t,"destroy")}}class ht extends e{ownerId;constructor(t){super(),this.ownerId=t.getId()}getOwner(){return this.getGameWorld().getGameObject(this.ownerId)}static bulletGO(t,e=30,n=.65,s=1,r=-1,...a){let l=new d(new i(.05,1),new st(n,10,r,new o(173,87,87)),new S(n,!1),new Q,new ot(e),new nt,new lt(s),new ht(t),...a);return l.getTransform().rotation=0,l.name="Bullet",l}}class ct extends q{color;constructor(t=0,e=o.background.clone()){super(),this.zindex=t,this.color=e}render(t){const e=this.getComponent(gt).length,n=this.getComponent(gt).width,s=this.getTransform().position.x,i=this.getTransform().position.y,o=this.getTransform().scale,r=this.getGameWorld().getPlugin(L).scaleV,a=this.getGameWorld().getPlugin(L).cameraScreenOffset,l=this.getGameWorld().getPlugin(L).cameraPositon.x,h=this.getGameWorld().getPlugin(L).cameraPositon.y,c=this.color.toString(),g=(this.getComponent(st).color.toString(),s-l),d=i-h,m=this.getComponent(gt),u=Math.sin(Math.min(1,m.getShotDelta()/m.cooldown)*Math.PI),p=(m.range,m.direction.times(m.bulletSpeed).times(m.getBulletLifetime()).add(m.getGlobalOffset()));t.translate(a.x,a.y),t.scale(r.x,r.y),t.translate(g,d),t.translate(p.x,p.y),t.beginPath(),t.arc(0,0,1,0,2*Math.PI),t.closePath(),t.shadowBlur=0,t.stroke(),t.strokeRect(-.5,-.5,1,1),t.setTransform(1,0,0,1,0,0),t.translate(a.x,a.y),t.scale(r.x,r.y),t.translate(g,d),t.scale(o.x,o.y),t.rotate(m.direction.toRad()),t.beginPath(),t.roundRect(0,-n/2,(1-u/3)*e,n,.1),t.closePath(),t.fillStyle=c,t.shadowBlur=0,t.fill(),t.shadowBlur=30,t.stroke(),t.shadowBlur=0,t.setTransform(1,0,0,1,0,0)}}class gt extends et{damage;cooldown=.15;bulletSpeed=40;length;width;range=250;bulletSpraed=.1;offset;direction=s.right();targetDirection=s.right();lastShootTime=-10;constructor(t=4,e=2,n=10){super(),this.damage=n,this.length=t,this.width=e,this.offset=new s(t-e/2,0)}getShotDelta(){return this.getGameWorld().getWorldTime()-this.lastShootTime}update(t){let e=this.direction.toRad(),i=this.targetDirection.toRad();e+=9*t*n.deltaAngle(e,i),this.direction=s.fromRad(e)}getBulletLifetime(){return this.range/this.bulletSpeed}getGlobalOffset(){return this.direction.toUnit().times(this.offset.x).add(this.direction.cross().times(this.offset.y))}shoot(){if(this.isEnabled&&this.getGameObject().enabled&&this.getShotDelta()>=this.cooldown){const t=.125,e=this.getComponent(ct).zindex-.01;let s=ht.bulletGO(this.getGameObject(),this.damage,this.width/2+n.symRand(t),this.getBulletLifetime(),e),o=s.getComponent(i),r=s.getComponent(S);s.getComponent(st).color=this.getComponent(st).color.clone(),r.avoidObjectes.add(this.getGameObject()),s.getTransform().position=this.getTransform().position.add(this.getGlobalOffset());let a=this.direction.cross().times(2*Math.random()*this.bulletSpraed-this.bulletSpraed);o.velocity=this.direction.toUnit().add(a).times(this.bulletSpeed),s.spawn(this.getGameWorld()),this.lastShootTime=this.getGameWorld().getWorldTime()}}}class dt extends q{color;constructor(t=0,e=new o(22,24,25)){super(),this.zindex=t,this.color=e}render(t){const e=this.getGameWorld().getPlugin(L).cameraScreenOffset,n=this.getTransform().position.x,s=this.getTransform().position.y,i=this.getTransform().rotation,r=this.getTransform().scale,a=this.getGameWorld().getPlugin(L).scaleV,l=this.getGameWorld().getPlugin(L).cameraPositon.x,h=this.getGameWorld().getPlugin(L).cameraPositon.y,c=(this.color.toString(),n-l),g=s-h;t.translate(e.x,e.y),t.scale(a.x,a.y),t.translate(c,g),t.rotate(i),t.scale(r.x,r.y),t.beginPath(),t.fillStyle=this.getComponent(st).color.toString(),t.shadowBlur=0,t.roundRect(-4,-2,8,4,1),t.fill(),t.shadowBlur=50,t.stroke(),t.closePath(),t.beginPath(),t.fillStyle=o.background.toString(),t.shadowBlur=0,t.roundRect(-4.5,-3.25,10,2,.5),t.fill(),t.shadowBlur=50,t.stroke(),t.closePath(),t.beginPath(),t.shadowBlur=0,t.roundRect(-4.5,1.25,10,2,.5),t.fill(),t.shadowBlur=50,t.stroke(),t.closePath(),t.beginPath(),t.fillStyle=o.background.toString(),t.shadowBlur=0,t.roundRect(-3,-2,6,4,1.5),t.fill(),t.shadowBlur=50,t.stroke(),t.closePath(),t.shadowBlur=0,t.setTransform(1,0,0,1,0,0)}}class mt extends q{color;tracesSpace=.5;traces=[];lastPosition=void 0;transparency=2;duration=1;length=2;constructor(t=0,e=new o(66,83,68)){super(),e=e.blend(o.stroke,.3),this.zindex=t,this.color=e}render(t){const e=this.getGameWorld().getPlugin(L).cameraScreenOffset,n=this.getGameWorld().getPlugin(L).scaleV,s=this.getGameWorld().getPlugin(L).cameraPositon.x,i=this.getGameWorld().getPlugin(L).cameraPositon.y,o=this.getTransform().position.clone(),r=this.getTransform().rotation;null==this.lastPosition&&(this.lastPosition=o.clone());let a=o.sub(this.lastPosition);for(;a.magnitude()>this.tracesSpace;)this.traces.push({position:this.lastPosition,rotation:r,startTime:this.getGameWorld().getWorldTime()}),this.lastPosition=this.lastPosition.add(a.toUnit().times(this.tracesSpace)),a=o.sub(this.lastPosition);for(;this.traces.length>0&&this.traces[0].startTime+this.duration<this.getGameWorld().getWorldTime();)this.traces.shift();for(const o of this.traces){const r=o.position.x-s,a=o.position.y-i,l=1-(this.getGameWorld().getWorldTime()-o.startTime)/this.duration;t.translate(e.x,e.y),t.scale(n.x,n.y),t.translate(r,a),t.rotate(o.rotation),t.beginPath(),t.fillStyle=this.color.toArgb(this.color.a*this.transparency*l).toString(),t.shadowBlur=0,t.roundRect(-4.5,-3.25,this.length,2,.75),t.fill(),t.closePath(),t.beginPath(),t.roundRect(-4.5,1.25,this.length,2,.75),t.fill(),t.closePath(),t.setTransform(1,0,0,1,0,0)}}}class ut extends e{tags=new Set;constructor(...t){super(),t.forEach((t=>this.addTag(t)))}addTag(t){this.tags.add(t)}removeTag(t){this.tags.delete(t)}hasTag(t){return this.tags.has(t)}getTags(){return Array.from(this.tags)}}class pt{static polygonGO(t=2,e=3,...s){let r=new d(new i(.1),new st(t,e,0,o.randomColor2().toArgb(.75)),new rt(.1),new S(n.getColliderRadius(e,t)),new Q,new ot(25*e),new nt,new ut("Dragable"),...s);return r.getTransform().rotation=2*Math.random()*Math.PI,r.name="Polygon",r}static enemyGO(t=2.5,e="",o=4,...r){let a=new d(new Z(e,void 0,o+.1),new st(t,8,o),new rt(o+.1),new dt(o-.2),new i(30),new S(t,!1),new Q(o-.15),new ot(1500),new nt,new mt(-21.37),...r);return a.getTransform().rotation=n.symRand(Math.PI),a.getComponent(gt).targetDirection=s.fromRad(n.symRand(Math.PI)),a.name="Enemy",a}static bulletGO(t,e=30,n=.65,s=1,r=-1,...a){let l=new d(new i(.05,1),new st(n,10,r,new o(173,87,87)),new S(n,!1),new Q,new ot(e),new nt,new lt(s),new ht(t),...a);return l.getTransform().rotation=0,l.name="Bullet",l}static playerGO(t=2.5,e=5,...n){let s=new d(new dt(e-.2),new st(t,10,e,new o(50,99,52)),new Z("Player",!0,e+.1),new Q(e-.15),new rt(e+.1),new ct(e-.1),new i(30,.025),new S(t,!1),new ot(1e3),new nt,new gt(6,1.55,44),new mt(-21.37),...n);return s.getTransform().rotation=0,s.name="Player",s}}class ft extends w{name="ProfilerPlugin";size=250;isVisible=!0;profilerWrapper=document.createElement("div");usage=new Map;constructor(){super()}start(){this.getPlugin(H).KeyDownEvent.subscribe(this,"keydown"),document.body.appendChild(this.profilerWrapper),this.addRecord("Fps",0)}lastTime=performance.now();frames=0;fpsHistory=[];update(t){const e=1/t;this.addRecord("Fps",e),this.frames++;const n=performance.now();n-this.lastTime>=250&&(this.fpsHistory.push(4*this.frames),this.fpsHistory.length>100&&this.fpsHistory.shift(),this.frames=0,this.lastTime=n);let s=[];for(const t of this.usage){let e=t[0],n=t[1].length,i=0;for(const e of t[1])i+=e;i/=n,s.push(`${e}: `+i.toFixed(2).toString())}this.profilerWrapper.innerHTML=this.getInnerHtml(s)}event(t,e){"keydown"==e&&"p"==t.key&&(this.isVisible=!this.isVisible)}addRecord(t,e){if(this.usage.has(t)){let n=this.usage.get(t);n.length>=this.size?(n.shift(),n.push(e)):n.push(e)}else this.usage.set(t,[e])}getChartHtml(t){t=t.slice(Math.max(0,t.length-100),t.length);let e='<div class="profiler-chart">';for(let n=0;n<t.length;n++)e+=`<div class="profiler-chart-item" style="height: ${t[n]/200*100}px"></div>`;return e+="</div>",e}getElementsHtml(t){let e="";for(let n=0;n<t.length;n++)n>0&&(e+='<hr class="profiler-item-separator">'),e+=`<div class="profiler-item">\n                <span class="profiler-item-key">${t[n].split(": ")[0]}:</span>\n                <span class="profiler-item-value">${t[n].split(": ")[1]}</span>\n            </div>`;return e}getInnerHtml(t){return`\n            <style>\n                .profiler{\n                    ${this.isVisible?"":"display: none;"}\n                    position: fixed;\n                    top: 20px;\n                    left: 20px;\n                    \n                    width: 400px;\n                    padding: 20px;\n                    border-radius: 20px;\n                    background-color: rgba(42, 43, 46, 0.382);\n                    color: white;\n                    pointer-events: none;\n                }\n                .profiler-header{\n                    font-size: 20px;\n                    font-weight: bold;\n                    color: white;\n                    margin-bottom: 10px;\n                }\n                .profiler-item{\n                    // display: flex;\n                    // justify-content: space-between;\n                    padding: 5px 0;\n                    color:rgba(240, 240, 240, 0.85)\n                }\n                .profiler-item-key{\n                    margin-right: 10px;\n                }\n                .profiler-item-value{\n                    color: #f0f0f0;\n                }\n                .profiler-item-separator{\n                    border: none;\n                    border-top: 1px dashed gray;\n                    opacity: 0.75;\n                    margin: 2px 0;\n                }\n                .profiler-chart{\n                    display: flex;\n                    flex-direction: row;\n                    justify-content: space-between;\n                    align-items: flex-end;\n                    height: 100px;\n                    width: 100%;\n                    margin-bottom: 10px;\n                    border-radius: 10px;\n                    overflow: hidden;\n                    opacity: 0.25;\n                }\n                .profiler-chart-item{\n                    background-color: rgb(240, 240, 240);\n                    width: 100%;\n                    margin: 0;\n                }\n            </style>\n\n            <div class="profiler">\n                <div class="profiler-header">\n                    <h2 style="margin: 0">Profiler <span style="opacity: 0.5">[P]</span></h2>\n                </div>\n                ${this.getChartHtml(this.fpsHistory)}\n                ${this.getElementsHtml(t)}\n            </div>\n            `}}class yt{startTime=0;prevWorldTime=0;worldTime=0;tickCount=0;gameObjects=new Map;plugins=new Map;events=new Set;componentsToStart=[];constructor(...t){for(let e of t){let t=e.constructor.name;if(this.plugins.has(t))throw new Error(`Plugin ${t} already exists in the game object`);e.gameWorld=this,this.plugins.set(t,e)}}getPlugin(t){const e=t.name;return this.getPluginByName(e)}getPluginByName(t){if(!this.plugins.has(t))throw new Error(`Plugin ${t} does not exist in the game world`);return this.plugins.get(t)}getAllPlugins(){return Array.from(this.plugins.values())}hasPlugin(t){const e=t.name;return this.plugins.has(e)}isSpawned(t){return this.gameObjects.has(t.getId())}spawn(t){if(this.gameObjects.has(t.getId()))throw new Error(`GameObject ${t.name} already exists in the game world`);return t.gameWorld=this,this.gameObjects.set(t.getId(),t),t.getAllComponents().forEach((t=>this.componentsToStart.push(new WeakRef(t)))),t}destroy(t){if(!this.gameObjects.has(t.getId()))throw new Error(`GameObject ${t.name} does'not exist in the game world`);t.enabled=!1,this.gameObjects.delete(t.getId())}getGameObject(t){return this.gameObjects.get(t)}getAllGameObjects(t=!0){return Array.from(this.gameObjects.values()).filter((e=>e.enabled||!t))}getComponents(t,e=!0){return this.getAllGameObjects().filter((n=>n.hasComponent(t)&&(n.getComponent(t).isEnabled()||!e))).map((e=>e.getComponent(t)))}getAllComponents(t=!0){return Array.from(this.getAllGameObjects(t)).flatMap((t=>t.getAllComponents()))}registerEvent(t){this.events.add(new WeakRef(t))}getWorldTime(){return this.worldTime/1e3}tick(){this.tickCount++,1==this.tickCount?this.startWorld():this.updateWorld(),this.startComponents(),this.invokeEvents()}startComponents(){for(let t of this.componentsToStart){const e=t.deref();e&&e.start()}this.componentsToStart=[]}startWorld(){this.startTime=performance.now(),this.Start(),this.plugins.forEach((t=>t.start()))}updateWorld(){this.worldTime=performance.now()-this.startTime;const t=this.worldTime-this.prevWorldTime;this.prevWorldTime=this.worldTime,this.Update(t/1e3),this.plugins.forEach((e=>{if(!e.isEnabled())return;let n=performance.now();e.update(t/1e3),this.getPlugin(ft).addRecord(e.name,performance.now()-n)}))}invokeEvents(){let t=performance.now();for(const t of this.events){const e=t.deref();e?e.invoke():this.events.delete(t)}this.getPlugin(ft).addRecord("Events",performance.now()-t)}Start(){}Update(t){}}var wt;!function(t){t[t.neutral=0]="neutral",t[t.passive=1]="passive",t[t.aggresive=2]="aggresive"}(wt||(wt={}));class bt extends et{type=wt.aggresive;isAttacing=!1;targetId="None";isFollowing=!1;minDistance=35;maxDistance=1e3;maxSpeed=10;start(){this.getComponent(ot).damageEvent.subscribe(this)}event(t){const e=t.participant;e.hasComponent(ht)&&e.getComponent(ht).getOwner()&&this.attack(e.getComponent(ht).getOwner())}attack(t){this.isAttacing=!0,this.targetId=t.getId(),this.isFollowing=!0}update(t){let e=this.getGameWorld().getGameObject(this.targetId);if(e){if(this.isAttacing){let o=this.getComponent(gt),r=e.getTransform().position.sub(this.getTransform().position);o.targetDirection=r;let a=r.magnitude();if(a>this.maxDistance&&(this.isAttacing=!1),o.shoot(),a>=this.minDistance){let e=this.getTransform().rotation,o=r.toRad();e+=5*t*n.deltaAngle(e,o),this.getTransform().rotation=e,this.getComponent(i).velocity=s.fromRad(e).times(this.maxSpeed)}}}else this.isAttacing=!1}}class xt extends yt{Start(){console.log("Hello, MyWorld!");const t=350;for(let e=0;e<550;e++){const e=3+n.symRand(.25);let o=pt.polygonGO(e/2,4);o.getTransform().position=s.randomPos(t),o.getComponent(i).angularVelocity=2*Math.random()-1,this.spawn(o)}for(let e=0;e<250;e++){const e=3.5+n.symRand(.25);let o=pt.polygonGO(e/2,3);o.getTransform().position=s.randomPos(t),o.getComponent(i).angularVelocity=2*Math.random()-1,this.spawn(o)}for(let e=0;e<350;e++){const e=4+n.symRand(.25);let o=pt.polygonGO(e/2,Math.round(3*Math.random())+5);o.getTransform().position=s.randomPos(t),o.getComponent(i).angularVelocity=2*Math.random()-1,this.spawn(o)}for(let e=0;e<25;e++){let n=pt.enemyGO(2.5,"Enemy nr."+e,4,new gt(void 0,void 0,10+5*Math.random()),new ct(3.9),new bt);n.getTransform().position=s.randomPos(t),n.spawn(this)}}Update(t){}}class vt extends q{image=new Image;side;offset;constructor(t=s.zero(),e=s.zero(),n="GameEngine/src/Assets/vectorpaint3.svg",i=0){super(),this.zindex=i,this.side=t,this.offset=e,this.image.src=n}render(t){const e=this.getGameWorld().getPlugin(L).cameraScreenOffset,n=this.getTransform().position.x,s=this.getTransform().position.y,i=this.getTransform().rotation,o=this.getTransform().scale,r=this.getGameWorld().getPlugin(L).scaleV,a=n-this.getGameWorld().getPlugin(L).cameraPositon.x,l=s-this.getGameWorld().getPlugin(L).cameraPositon.y;let h=this.side;0==h.x&&(h.x=this.image.width),0==h.y&&(h.y=this.image.height),t.translate(e.x,e.y),t.scale(r.x,r.y),t.translate(a,l),t.rotate(i),t.scale(o.x,o.y),t.translate(this.offset.x,this.offset.y),t.shadowBlur=15,t.drawImage(this.image,-h.x/2,-h.y/2,h.x,h.y),t.shadowBlur=0,t.setTransform(1,0,0,1,0,0)}}class Pt extends w{name="RendererPlugin";context;renderDistance=150;constructor(t){super(),this.context=t}addVignetteEffect(t,e){const n=t.canvas.width/2,s=t.canvas.height/2,i=Math.sqrt(n*n+s*s),o=t.createRadialGradient(n,s,0,n,s,i);o.addColorStop(.025,"rgba(0, 0, 0, 0)"),o.addColorStop(1,e),t.fillStyle=o,t.fillRect(0,0,t.canvas.width,t.canvas.height)}gridCanvas=[];start(){this.context.imageSmoothingEnabled=!0,this.context.strokeStyle="rgb(43,43,44)",this.context.lineWidth=.175,this.context.lineJoin="round",this.context.shadowColor="rgba(0, 0, 0, 0.75)",this.context.fillStyle="#716f6b",this.context.fillStyle="rgb(85, 106, 86)",this.context.fillStyle="rgb(66, 85, 68)";let e=new Worker(new URL(t.p+t.u(703),t.b),{type:"module"});for(let t=0;t<10;t++){this.gridCanvas[t]=document.createElement("canvas"),this.gridCanvas[t].width=3440,this.gridCanvas[t].height=1440,document.createElement("canvas");const n=this.gridCanvas[t].transferControlToOffscreen();e.postMessage({canvas:n,args:[new s(2,2),.175,o.stroke.toString(),new s(5*t+5,5*t+5)]},[n])}}clip(t){const e=this.context.canvas.width,n=this.context.canvas.height,s=this.getPlugin(L).scaleV,i=this.getPlugin(L).cameraPositon,o=Math.abs(e/2/s.x),r=Math.abs(n/2/s.y);return Math.abs(t.x-i.x)>o||Math.abs(t.y-i.y)>r}update(t){const e=this.context.canvas.width,n=this.context.canvas.height;this.context.fillStyle="rgba(80, 100, 81, 1)",this.context.fillRect(0,0,e,n),this.getPlugin(L).cameraScreenOffset=new s(this.context.canvas.width/2,this.context.canvas.height/2);const i=this.getPlugin(L).cameraScreenOffset,o=this.getPlugin(L).scaleV,r=this.getPlugin(L).cameraPositon;let a=Math.max(0,Math.min(9,Math.round(o.x/10))),l=5*a+5;this.context.translate(i.x,i.y),this.context.scale(o.x,o.y),this.context.translate(-r.x%2,-r.y%2),this.context.scale(1/l,1/l),this.context.drawImage(this.gridCanvas[a],-this.gridCanvas[a].width/2,-this.gridCanvas[a].height/2,this.gridCanvas[a].width,this.gridCanvas[a].height),this.context.setTransform(1,0,0,1,0,0),this.gameWorld.getComponents(Z).concat(this.gameWorld.getComponents(Q)).concat(this.gameWorld.getComponents(rt)).concat(this.gameWorld.getComponents(st)).concat(this.gameWorld.getComponents(vt)).filter((t=>!this.clip(t.getTransform().position))).concat(this.gameWorld.getComponents(ct)).concat(this.gameWorld.getComponents(mt)).concat(this.gameWorld.getComponents(dt)).filter((t=>!this.clip(t.getTransform().position))).sort(((t,e)=>t.zindex-e.zindex)).forEach((t=>t.render(this.context))),this.addVignetteEffect(this.context,"rgba(0, 0, 0, 0.35)")}}class Ct extends w{name="PhysicsPlugin";update(t){this.gameWorld.getWorldTime(),this.gameWorld.getComponents(i).forEach((e=>e.update(t)))}}var Mt=function(t,e,n,s){var i,o=arguments.length,r=o<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,n):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,n,s);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(r=(o<3?i(r):o>3?i(e,n,r):i(e,n))||r);return o>3&&r&&Object.defineProperty(e,n,r),r},St=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};class Tt extends w{name="PlayerPlugin";playerName="player";player=pt.playerGO();getPlayerPosition(){return this.player.getTransform().position.clone()}getPlayerColor(){return this.player.getComponent(st).color.clone()}start(){this.respawn(),this.player.getComponent(st).color=this.getPlugin(J)?.get("playerColor")??new o(53,110,58),this.getPlugin(H)?.KeyDownEvent.subscribe(this,"KeyDownEvent")}event(t,e){if("KeyDownEvent"===e){let e=t;if("r"===e.key)this.respawn();else if("c"===e.key){let t=this.getPlugin(J)?.get("displayColliders")??!1;void 0!==t&&this.getPlugin(J)?.set("displayColliders",!t)}}}update(t){let e=this.getPlugin(L);if(e.targetCameraPositon=this.player.getTransform().position.clone(),!this.player.enabled)return;let n=this.getPlugin(C),o=this.getPlugin(H),r=this.player.getComponent(gt);if(!r)return;r.targetDirection=e.getWorldPosition(n.getMouseScreenPosition()).sub(this.player.getTransform().position),r.range=e.getWorldPosition(n.getMouseScreenPosition()).sub(this.player.getTransform().position.add(r.getGlobalOffset())).magnitude(),(o.isPressed("e")||n.isKeyDown(0))&&r.shoot();const a=o.isPressed("shift")?120:60,l=this.player.getTransform().rotation,h=s.fromRad(l);let c=this.player.getComponent(i),g=c.velocity;o.isPressed("w")?(c.acceleration=h.toUnit().times(a),o.isPressed("s")&&(c.acceleration=h.toUnit().times(25))):o.isPressed("s")?c.acceleration=h.toUnit().times(-25):c.acceleration=s.zero(),g=g.sub(g.perpendicular(h)),g.magnitude()>50&&g.setLength(50),o.isPressed("a")?c.angularVelocity=2.5:o.isPressed("d")?c.angularVelocity=-2.5:c.angularVelocity=0}cliGetName(){return"player"}setname(t){return this.playerName=t,this.player.name=t,new m(!0,`Player name set to ${t}`,void 0)}setcolor(t){try{let e=o.tryParseCssColor(t.toString());e&&(this.player.getComponent(st).color=e)}catch{}return new m(!0,"Player color set",void 0)}respawn(){return this.player&&this.gameWorld.isSpawned(this.player)&&this.gameWorld.destroy(this.player),this.player=pt.playerGO(),this.player.name=this.playerName,this.player.spawn(this.gameWorld),new m(!0,"Player respawned",void 0)}getcolor(){return new m(!0,`Player color is ${this.player.getComponent(st).color}`,this.player.getComponent(st).color)}}Mt([u("setname","<name: string>"),St("design:type",Function),St("design:paramtypes",[String]),St("design:returntype",m)],Tt.prototype,"setname",null),Mt([u("setcolor","<color: string | rgb>"),St("design:type",Function),St("design:paramtypes",[Object]),St("design:returntype",m)],Tt.prototype,"setcolor",null),Mt([u("respawn"),St("design:type",Function),St("design:paramtypes",[]),St("design:returntype",m)],Tt.prototype,"respawn",null),Mt([u("getcolor",void 0,"rgb"),St("design:type",Function),St("design:paramtypes",[]),St("design:returntype",m)],Tt.prototype,"getcolor",null);class Wt extends w{name="StandaloneComponentPlugin";update(t){this.gameWorld.getAllComponents().filter((t=>t instanceof et)).map((t=>t)).forEach((e=>e.tick(t)))}}class Et extends w{name="ClientPlugin";socket;start(){}event(t,e){let n=t;this.sendChatMessage(n.message)}onConnection(){console.log("Connected to server")}onDisconnection(t){console.log(`Disconnected from server: ${t}`)}onChatMessage(t){console.log(`Received chat message: ${t}`)}sendChatMessage(t){}}var Ot=function(t,e,n,s){var i,o=arguments.length,r=o<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,n):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,n,s);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(r=(o<3?i(r):o>3?i(e,n,r):i(e,n))||r);return o>3&&r&&Object.defineProperty(e,n,r),r},_t=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};let kt=class extends w{name="CliPlugin";globalCommands=new Map;echo(t){return new m(!0,t,t)}loop(t,e){let n=[],s="";for(let i=0;i<t;i++){const t=this.parseAndExecuteCommands(e);if(!t.status)return new m(!1,`Error executing command: ${t.message}`,void 0);n.push(t.data),s+=`${t.message}\n`}return new m(!0,s,n)}true(){return new m(!0,"This is a true command",!0)}false(){return new m(!0,"This is a false command",!1)}int(t){return new m(!0,`This is an int command with value ${t}`,parseInt(t))}float(t){return new m(!0,`This is a float command with value ${t}`,parseFloat(t))}refresh(){return location.reload(),new m(!0,"This is a refresh command",void 0)}getrandomcolor(){const t=o.randomColor2();return new m(!0,`Random color is ${t}`,t)}help(){let t=super.help(),e="plugins:\n";for(const t of this.gameWorld.getAllPlugins())e+=`/${t.cliGetName()}\n`;return e=t.message+"\n"+e,new m(!0,e,void 0)}art(){const t="\n[38;5;160m         ██████         [0m\n[38;5;160m       ██████████       [0m\n[38;5;160m      ████    ████      [0m\n[38;5;82m    ████        ████    [0m\n[38;5;82m   ████          ████   [0m\n[38;5;82m  ████            ████  [0m\n[38;5;82m  ████    ████    ████  [0m\n[38;5;82m  ████████████████████  [0m\n[38;5;226m   ██████████████████   [0m\n[38;5;226m     ████████████████     [0m\n[38;5;226m      ████    ██████      [0m\n[38;5;196m      ████    ██████      [0m\n[38;5;196m     ██████████████████     [0m\n[38;5;196m    ████████████████████    [0m\n[38;5;196m   ██████████████████████   [0m\n[38;5;196m  ████████████████████████  [0m\n[38;5;160m      ██████████████      [0m\n[38;5;160m       ████████████       [0m\n        ";return console.log(t),new m(!0,t,void 0)}execute(t){try{return this.parseAndExecuteCommands(t)}catch{return new m(!1,"Command execution failed",void 0)}}start(){this.gameWorld.getAllPlugins().forEach((t=>{const e=t.constructor.name;try{for(let n of Object.keys(t.constructor.commands))this.globalCommands.has(n)?this.globalCommands.set(n,void 0):this.globalCommands.set(n,e)}catch{}}))}parseAndExecuteCommands(t,e=0){console.log("---".repeat(e)+"Parsing: "+t);const n=[];let s="",i=!1,o=!1,r=0;t=t.trim();for(let a=0;a<t.length;a++){const l=t[a];if(r>0){if("{"===l){r++,s+=l;continue}if("}"===l){if(r--,0===r){const t=this.parseAndExecuteCommands(s,e+1);n.push(t.data),s=""}else s+=l;continue}s+=l}else if(o){if('"'===l){n.push(s),s="",o=!1;continue}s+=l}else if(i){if("'"===l){n.push(s),s="",i=!1;continue}s+=l}else'"'!==l?"'"!==l?"{"!==l?" "!==l?s+=l:""!==s.trim()&&(n.push(s),s=""):r++:i=!0:o=!0}""!==s.trim()&&n.push(s),console.log("---".repeat(e)+"Parsing result: ",n);const a=n[0].split(":");if(2===a.length){const t=a[0],e=this.gameWorld.getAllPlugins().find((e=>e.cliGetName()===t));return e?this.executeParsedCommand(e,a[1],...n.slice(1)):new m(!1,`Plugin ${t} not found`,void 0)}if(1!==a.length)return new m(!1,"No command found",void 0);try{if(!this.globalCommands.has(a[0]))return new m(!1,`Command ${a[0]} not found`,void 0);const t=this.globalCommands.get(a[0]);if(!t)return new m(!1,'More than one command found, use "/<plugin>:<command>" (fe /cli:help) instead.',void 0);const e=this.gameWorld.getPluginByName(t);return this.executeParsedCommand(e,a[0],...n.slice(1))}catch{return new m(!1,"Command not found or wrong syntax",void 0)}}executeParsedCommand(t,e,...n){if(void 0===t.constructor.commands[e])return new m(!1,`Command ${e} not found`,void 0);try{return t.constructor.commands[e].apply(t,n)}catch{}return new m(!1,`Failed to execute command ${e} on ${t.cliGetName()}`,void 0)}};Ot([u("echo","<message: string>","string"),_t("design:type",Function),_t("design:paramtypes",[String]),_t("design:returntype",m)],kt.prototype,"echo",null),Ot([u("loop","<iterations: int> <command: string>","string"),_t("design:type",Function),_t("design:paramtypes",[Number,String]),_t("design:returntype",m)],kt.prototype,"loop",null),Ot([u("true",void 0,"bool"),_t("design:type",Function),_t("design:paramtypes",[]),_t("design:returntype",m)],kt.prototype,"true",null),Ot([u("false",void 0,"bool"),_t("design:type",Function),_t("design:paramtypes",[]),_t("design:returntype",m)],kt.prototype,"false",null),Ot([u("int","<value: string>","number"),_t("design:type",Function),_t("design:paramtypes",[String]),_t("design:returntype",m)],kt.prototype,"int",null),Ot([u("float","<value: string>","number"),_t("design:type",Function),_t("design:paramtypes",[String]),_t("design:returntype",m)],kt.prototype,"float",null),Ot([u("refresh"),_t("design:type",Function),_t("design:paramtypes",[]),_t("design:returntype",m)],kt.prototype,"refresh",null),Ot([u("randomcolor",void 0,"rgb"),_t("design:type",Function),_t("design:paramtypes",[]),_t("design:returntype",m)],kt.prototype,"getrandomcolor",null),Ot([u("help"),_t("design:type",Function),_t("design:paramtypes",[]),_t("design:returntype",m)],kt.prototype,"help",null),Ot([u("art"),_t("design:type",Function),_t("design:paramtypes",[]),_t("design:returntype",m)],kt.prototype,"art",null),kt=Ot([p("cli")],kt);var Rt=function(){function t(){this.ansi_colors=[[{rgb:[0,0,0],class_name:"ansi-black"},{rgb:[187,0,0],class_name:"ansi-red"},{rgb:[0,187,0],class_name:"ansi-green"},{rgb:[187,187,0],class_name:"ansi-yellow"},{rgb:[0,0,187],class_name:"ansi-blue"},{rgb:[187,0,187],class_name:"ansi-magenta"},{rgb:[0,187,187],class_name:"ansi-cyan"},{rgb:[255,255,255],class_name:"ansi-white"}],[{rgb:[85,85,85],class_name:"ansi-bright-black"},{rgb:[255,85,85],class_name:"ansi-bright-red"},{rgb:[0,255,0],class_name:"ansi-bright-green"},{rgb:[255,255,85],class_name:"ansi-bright-yellow"},{rgb:[85,85,255],class_name:"ansi-bright-blue"},{rgb:[255,85,255],class_name:"ansi-bright-magenta"},{rgb:[85,255,255],class_name:"ansi-bright-cyan"},{rgb:[255,255,255],class_name:"ansi-bright-white"}]],this.setup_256_palette(),this.useClasses=!1,this.escapeForHtml=!0,this.bright=!1,this.fg=this.bg=null,this._buffer=""}return Object.defineProperty(t.prototype,"useClasses",{get:function(){return this._useClasses},set:function(t){this._useClasses=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"escapeForHtml",{get:function(){return this._escapeForHtml},set:function(t){this._escapeForHtml=t},enumerable:!0,configurable:!0}),t.prototype.setup_256_palette=function(){var t=this;this.palette_256=[],this.ansi_colors.forEach((function(e){e.forEach((function(e){t.palette_256.push(e)}))}));for(var e=[0,95,135,175,215,255],n=0;n<6;++n)for(var s=0;s<6;++s)for(var i=0;i<6;++i){var o={rgb:[e[n],e[s],e[i]],class_name:"truecolor"};this.palette_256.push(o)}for(var r=8,a=0;a<24;++a,r+=10)o={rgb:[r,r,r],class_name:"truecolor"},this.palette_256.push(o)},t.prototype.doEscape=function(t){return t.replace(/[&<>]/gm,(function(t){return"&"===t?"&amp;":"<"===t?"&lt;":">"===t?"&gt;":void 0}))},t.prototype.old_linkify=function(t){return t.replace(/(https?:\/\/[^\s]+)/gm,(function(t){return'<a href="'+t+'">'+t+"</a>"}))},t.prototype.detect_incomplete_ansi=function(t){return!/.*?[\x40-\x7e]/.test(t)},t.prototype.detect_incomplete_link=function(t){for(var e=!1,n=t.length-1;n>0;n--)if(/\s|\x1B/.test(t[n])){e=!0;break}if(!e)return/(https?:\/\/[^\s]+)/.test(t)?0:-1;var s=t.substr(n+1,4);return 0===s.length?-1:0==="http".indexOf(s)?n+1:void 0},t.prototype.ansi_to_html=function(t){var e=this,n=this._buffer+t;this._buffer="";var s=n.split(/\x1B\[/);1===s.length&&s.push("");var i=s[s.length-1];i.length>0&&this.detect_incomplete_ansi(i)?(this._buffer="["+i,s.pop(),s.push("")):(""===i.slice(-1)&&(this._buffer="",console.log("raw",s),s.pop(),s.push(i.substr(0,i.length-1)),console.log(s),console.log(i)),2===s.length&&""==s[1]&&""==s[0].slice(-1)&&(this._buffer="",i=s.shift(),s.unshift(i.substr(0,i.length-1))));var o=this.wrap_text(s.shift()),r=s.map((function(t){return e.wrap_text(e.process_ansi(t))}));return o.length>0&&r.unshift(o),r.join("")},t.prototype.ansi_to_text=function(t){var e=this,n=t.split(/\x1B\[/),s=n.shift(),i=n.map((function(t){return e.process_ansi(t)}));return s.length>0&&i.unshift(s),i.join("")},t.prototype.wrap_text=function(t){if(0===t.length)return t;if(this._escapeForHtml&&(t=this.doEscape(t)),!this.bright&&null===this.fg&&null===this.bg)return t;var e=[],n=[],s=this.fg,i=this.bg;null===s&&this.bright&&(s=this.ansi_colors[1][7]),this._useClasses?(s&&("truecolor"!==s.class_name?n.push(s.class_name+"-fg"):e.push("color:rgb("+s.rgb.join(",")+")")),i&&("truecolor"!==i.class_name?n.push(i.class_name+"-bg"):e.push("background-color:rgb("+i.rgb.join(",")+")"))):(s&&e.push("color:rgb("+s.rgb.join(",")+")"),i&&e.push("background-color:rgb("+i.rgb+")"));var o="",r="";return n.length&&(o=' class="'+n.join(" ")+'"'),e.length&&(r=' style="'+e.join(";")+'"'),"<span"+o+r+">"+t+"</span>"},t.prototype.process_ansi=function(t){this._sgr_regex||(this._sgr_regex=((s=["\n              ^                           # beginning of line\n              ([!<-?]?)             # a private-mode char (!, <, =, >, ?)\n              ([d;]*)                    # any digits or semicolons\n              ([ -/]?               # an intermediate modifier\n               [@-~])               # the command\n              ([sS]*)                   # any text following this CSI sequence\n              "]).raw=["\n              ^                           # beginning of line\n              ([!\\x3c-\\x3f]?)             # a private-mode char (!, <, =, >, ?)\n              ([\\d;]*)                    # any digits or semicolons\n              ([\\x20-\\x2f]?               # an intermediate modifier\n               [\\x40-\\x7e])               # the command\n              ([\\s\\S]*)                   # any text following this CSI sequence\n              "],this.rgx(s)));var e=t.match(this._sgr_regex);if(!e)return t;var n=e[4];if(""!==e[1]||"m"!==e[3])return n;for(var s,i=e[2].split(";");i.length>0;){var o=i.shift(),r=parseInt(o,10);if(isNaN(r)||0===r)this.fg=this.bg=null,this.bright=!1;else if(1===r)this.bright=!0;else if(22===r)this.bright=!1;else if(39===r)this.fg=null;else if(49===r)this.bg=null;else if(r>=30&&r<38){var a=this.bright?1:0;this.fg=this.ansi_colors[a][r-30]}else if(r>=90&&r<98)this.fg=this.ansi_colors[1][r-90];else if(r>=40&&r<48)this.bg=this.ansi_colors[0][r-40];else if(r>=100&&r<108)this.bg=this.ansi_colors[1][r-100];else if((38===r||48===r)&&i.length>0){var l=38===r,h=i.shift();if("5"===h&&i.length>0){var c=parseInt(i.shift(),10);c>=0&&c<=255&&(l?this.fg=this.palette_256[c]:this.bg=this.palette_256[c])}if("2"===h&&i.length>2){var g=parseInt(i.shift(),10),d=parseInt(i.shift(),10),m=parseInt(i.shift(),10);if(g>=0&&g<=255&&d>=0&&d<=255&&m>=0&&m<=255){var u={rgb:[g,d,m],class_name:"truecolor"};l?this.fg=u:this.bg=u}}}}return n},t.prototype.rgx=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var s=t.raw[0].replace(/^\s+|\s+\n|\s+#[\s\S]+?\n/gm,"");return new RegExp(s,"m")},t}(),Gt=function(t,e,n,s){var i,o=arguments.length,r=o<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,n):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,n,s);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(r=(o<3?i(r):o>3?i(e,n,r):i(e,n))||r);return o>3&&r&&Object.defineProperty(e,n,r),r},jt=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};let It=class extends w{name="ConsolePlugin";isVisible=!0;consoleWrapper=document.createElement("div");buffer="";history=[""];historyIndex=0;constructor(){super(),document.body.appendChild(this.consoleWrapper),this.consoleWrapper.innerHTML=this.getInnerHtml()}start(){this.getPlugin(H).KeyDownEvent.subscribe(this,"keydown"),this.getPlugin(H).BlockedKeyDownEvent.subscribe(this,"keydown")}event(t,e){const n=t.key;let s;try{s=this.consoleWrapper.querySelector(".console-input")}catch{}if(s){if(this.isFocused()){if("arrowup"==n&&this.historyIndex<this.history.length-1&&(this.historyIndex++,s.value=this.history[this.historyIndex]),"arrowdown"==n&&this.historyIndex>0&&(this.historyIndex--,console.log(this.historyIndex),console.log(this.history),s.value=this.history[this.historyIndex]),"escape"==n&&(s.blur(),s.value=""),"enter"==n){const t=s.value.trim();""!==t&&(s.value="",console.log("Sending:",t),this.messageEntered(t)),s.blur()}}else if("enter"==n&&this.isVisible&&s.focus(),"t"==n)try{this.isVisible?(document.body.removeChild(this.consoleWrapper),s.blur()):document.body.appendChild(this.consoleWrapper),this.isVisible=!this.isVisible}catch(t){console.log("Error: ",t)}this.getPlugin(H).block=this.isFocused()}}isFocused(){try{const t=this.consoleWrapper.querySelector(".console-input");return null!=t&&document.activeElement===t}catch{return!1}}writeLine(t){this.buffer+=t+"\r\n",this.setStatus("white"),this.updateConsole()}messageEntered(t){if(t.startsWith("/")){this.buffer+=t+"\n";const e=this.getPlugin(kt).execute(t.slice(1));""!=e.message&&(this.buffer+=e.message+"\r\n"),e.status?this.setStatus("#485b49"):this.setStatus("#813136")}else this.buffer+=t+"\r\n",this.setStatus("white");this.history[0]=t,this.history.unshift(""),this.historyIndex=0,this.updateConsole()}setStatus(t){try{const e=this.consoleWrapper.querySelector(".console-status");if(null==e)return;e.style.backgroundColor=t.toString()}catch{}}updateConsole(){this.setElementsHtml(this.buffer)}setElementsHtml(t){try{const e=this.consoleWrapper.querySelector(".console-content");if(null==e)return;e.innerHTML="";const n=t.split("\n");for(let t=0;t<n.length-1;t++){const s=n[t],i=(new Rt).ansi_to_html(s);let o=document.createElement("span");o.innerHTML=i,e.appendChild(o);const r=document.createElement("hr");r.className="console-item-separator",s.endsWith("\r")?e.appendChild(r):e.appendChild(document.createElement("br"))}}catch{}}getInnerHtml(){return`\n            <style>\n                .console{\n                    ${this.isVisible?"":"display: none;"}\n                    position: fixed;\n                    top: 20px;\n                    right: 20px;\n                    \n                    width: 400px;\n                    padding: 20px;\n                    border-radius: 20px;\n                    background-color: rgba(42, 43, 46, 0.382);\n                    color: white;\n                    font-family: "IBM Plex Mono", monospace;\n                    pointer-events: none;\n                    overflow: hidden;\n                }\n                .console-status{\n                    margin: 7px 0;\n                    height: 6px;\n                    background-color: white;\n                    opacity: 1;\n                    border-radius: 999px;\n                }\n                .console-header{\n                    font-size: 20px;\n                    font-weight: bold;\n                    height: 40px;\n                    color: white;\n                    margin-bottom: 10px;\n                    user-select: none;\n                }\n                .console-input{\n                    width: 100%; \n                    padding: 5px 0;\n                    margin: 0;\n                    border-radius: 0; \n                    border: none; \n                    border-bottom: 1px solid rgba(240, 240, 240, 0.5);\n                    background-color: transparent; \n                    color: white;\n                    font-size: 20px;   \n                }\n                .console *::selection {\n                    background-color: #546855;\n                    color: white;\n                }\n                .console-input:focus{\n                    outline: none; \n                    border-bottom: 1px solid rgba(240, 240, 240, 0.85);\n                }\n                .console-content-wrapper{\n                    position: relative;\n                    height: 600px;\n                    width: 100%;\n                    overflow: hidden;\n                }\n                .console-content{\n                    white-space: pre-wrap;\n                    word-wrap: break-word;\n                    position: absolute;\n                    width: 100%;\n                    line-height: 20px;\n                    font-size: 20px;\n                    margin: 0;\n                    bottom: 0;\n                }\n                .console-item-separator{\n                    border: none;\n                    border-top: 1px dashed gray;\n                    opacity: 0.75;\n                    margin: 9.5px 0;\n                }t\n            </style>\n\n            <div class="console">\n                <div class="console-header">\n                    <h2 style="margin: 0">Console <span style="opacity: 0.5">[T]</span></h2>\n                </div>\n                <div class="console-status"></div>\n                <div class="console-content-wrapper">\n                    <pre class="console-content"></pre>\n                </div>\n                    <input class="console-input" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" type="text" tabindex="-1" placeholder="Type your command here..." />\n            </div>\n            `}clearConsole(){return this.buffer="",this.updateConsole(),new m(!0,"",void 0)}};Gt([u("clear"),jt("design:type",Function),jt("design:paramtypes",[]),jt("design:returntype",m)],It.prototype,"clearConsole",null),It=Gt([p("console"),jt("design:paramtypes",[])],It),async function(t){const e=new xt(new J,new Et,new kt,new H,new C(t),new at,new Tt,new Ct,new L,new It,new ft,new X,new Wt,new Pt(t.getContext("2d")));console.log(e.getAllPlugins()),function t(){e.tick(),requestAnimationFrame(t)}()}(document.getElementById("gameCanvas"));