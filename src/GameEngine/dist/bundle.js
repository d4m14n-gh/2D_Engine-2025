var t={m:{},u:t=>t+".bundle.js",o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};(()=>{var e;if("string"==typeof import.meta.url&&(e=import.meta.url),!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),t.p=e})(),t.b=new URL("./",import.meta.url);class e{enabled=!0;gameObject;start(){}event(t,e){}getGameWorld(){return this.gameObject.getGameWorld()}hasComponent(t){return this.gameObject.hasComponent(t)}getComponent(t){return this.gameObject.getComponent(t)}getAllComponents(){return this.gameObject.getAllComponents()}getTransform(){return this.gameObject.getTransform()}getGameObject(){return this.gameObject}getPlugin(t){return this.getGameWorld().getPlugin(t)}isEnabled(){return this.gameObject.enabled&&this.enabled}enable(t=!0){this.enabled=t}}class s{static symRand(t){return(2*Math.random()-1)*t}static getColliderRadius(t,e){if(t>=10)return e;const s=Math.PI/t;return(Math.cos(s)*e*2+e)/3}static deltaAngle(t,e){return t=t%(2*Math.PI)+2*Math.PI,t%=2*Math.PI,((e=(e=e%(2*Math.PI)+2*Math.PI)%(2*Math.PI)+2*Math.PI)-t+Math.PI)%(2*Math.PI)-Math.PI}static elasticCollision1D(t,e,s,n){return[(e*(t-s)+2*s*n)/(t+s),(n*(s-t)+2*t*e)/(t+s)]}}class n{x=0;y=0;constructor(t,e){this.x=t,this.y=e}add(t){return new n(this.x+t.x,this.y+t.y)}sub(t){return new n(this.x-t.x,this.y-t.y)}times(t){return new n(this.x*t,this.y*t)}timesV(t){return new n(this.x*t.x,this.y*t.y)}distance(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))}static distance(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}magnitude(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))}cross(){return new n(this.y,-this.x).toUnit()}scalarProduct(t){return this.x*t.x+this.y*t.y}vectorProduct(t){return this.x*t.y-this.y*t.x}perpendicular(t){return this.sub(t.cross().times(t.scalarProduct(this)/(t.magnitude()*t.magnitude())))}toUnit(){return 0!=this.magnitude()?new n(this.x,this.y).times(1/this.magnitude()):new n(1,0)}setLength(t){return this.toUnit().times(t)}toString(){return"{"+this.x+":"+this.y+"}"}toRad(){return Math.atan2(this.y,this.x)}reverse(){let t=1e32,e=1e32;return 0!=this.x&&(t=1/this.x),0!=this.y&&(e=1/this.y),new n(t,e)}interpolate(t,e){const s=t.sub(this),n=s.sub(s.times(Math.min(1,Math.max(0,e))));return this.add(n)}static fromRad(t){return new n(Math.cos(t),Math.sin(t))}static randomPos(t){return new n(s.symRand(t),s.symRand(t))}static randomPos2(t){let e=s.symRand(Math.PI),o=Math.random()*t;return n.fromRad(e).times(o)}clone(){return new n(this.x,this.y)}static zero(){return new n(0,0)}static one(){return new n(1,1)}static up(){return new n(0,1)}static down(){return new n(0,-1)}static left(){return new n(-1,0)}static right(){return new n(1,0)}}class o extends e{velocity;acceleration=n.zero();mass=1;dampingFactor;angularVelocity=0;angularAcceleration=0;angularDrag=.25;constructor(t,e=.45){super(),this.velocity=new n(15*Math.random()*2-15,15*Math.random()*2-15),this.dampingFactor=e,this.mass=t}update(t){this.velocity=this.velocity.add(this.acceleration.times(t)),this.velocity=this.velocity.times(Math.pow(this.dampingFactor,t)),this.getTransform().position=this.getTransform().position.add(this.velocity.times(t)),this.getTransform().position=this.getTransform().position.add(this.acceleration.times(t*t/2)),this.angularVelocity=this.angularVelocity+this.angularAcceleration*t,this.angularVelocity=this.angularVelocity*Math.pow(this.angularDrag,t),this.getTransform().rotation+=this.angularVelocity*t}fixedUpdate(t){}}class i{r=0;g=0;b=0;a=1;static stroke=new i(43,43,44);static background=new i(93,97,95);constructor(t,e,s,n=1){this.r=Math.min(255,Math.max(0,t)),this.g=Math.min(255,Math.max(0,e)),this.b=Math.min(255,Math.max(0,s)),this.a=Math.min(1,Math.max(0,n))}toString(){return`rgba(${this.r},${this.g},${this.b},${Math.max(0,Math.min(this.a,1))})`}toRgb(){return new i(this.r,this.g,this.b)}toArgb(t){return new i(this.r,this.g,this.b,t)}blend(t,e){return new i(this.r*(1-e)+t.r*e,this.g*(1-e)+t.g*e,this.b*(1-e)+t.b*e,this.a*(1-e)+t.a*e)}static randomColor(){return new i(255*Math.random(),255*Math.random(),255*Math.random())}static hslToRgb(t,e,s){s/=100;const n=e=>(e+t/30)%12,o=(e/=100)*Math.min(s,1-s),r=t=>s-o*Math.max(-1,Math.min(n(t)-3,Math.min(9-n(t),1))),a=Math.round(255*r(0)),l=Math.round(255*r(8)),h=Math.round(255*r(4));return new i(a,l,h)}static randomColor2(){const t=Math.floor(360*Math.random()),e=Math.floor(30*Math.random())+15,s=Math.floor(15*Math.random())+30;return i.hslToRgb(t,e,s)}static getHeatmapColor(t){t=Math.max(0,Math.min(1,t));let e=Math.min(255,Math.max(0,Math.floor(255*t*2))),s=Math.min(255,Math.max(0,Math.floor(255*(2-2*t))));return new i(s/1.5,e/1.5,0,255)}static tryParseCssColor(t){let e=document.body,s=e.style.color;e.style.color=t;let n=getComputedStyle(e).color;return e.style.color=s,this.getRgbFromComputedStyle(n)}static getRgbFromComputedStyle(t){let e=t.match(/^rgb(a?)\((\d+),\s*(\d+),\s*(\d+)(?:,\s*([\d.]+))?\)$/);if(e)return new i(parseInt(e[2]),parseInt(e[3]),parseInt(e[4]),parseFloat(e[5]??1))}clone(){return new i(this.r,this.g,this.b,this.a)}}class r{position;rotation;scale;constructor(t=new n(0,0),e=0,s=n.one()){this.position=t,this.rotation=e,this.scale=s}static fromPosition(t){let e=new r;return e.position=t,e}clone(){let t=new r;return t.position=this.position.clone(),t.scale=this.scale.clone(),t.rotation=this.rotation,t}}class a{transform=new r;components=new Map;enabled=!0;name="UnnamedGameObject";gameWorld;constructor(...t){for(let e of t){let t=e.constructor.name;if(this.components.has(t))throw new Error(`Component ${t} already exists in the game object`);e.gameObject=this,this.components.set(t,e)}}hasComponent(t){return this.components.has(t.name)}getComponent(t){const e=t.name;return this.components.get(e)}getAllComponents(t=!1){return Array.from(this.components.values()).filter((e=>!t||e.isEnabled()))}destroy(){this.gameWorld.destroy(this)}spawn(t){return t.spawn(this)}getTransform(){return this.transform}getGameWorld(){return this.gameWorld}}class l{status;message;data;constructor(t,e,s){this.status=t,this.message=e,this.data=s}}function h(t,e,s){return function(n,o,i){const r=i.value;if(r){(e=e??"")&&(e=" "+e),(s=s??"void")&&(s=": "+s),e=(t=t??o)+e+s;const i=n.constructor;Object.prototype.hasOwnProperty.call(i,"commands")||(i.commands=Object.assign({},i.commands||{})),i.commands[t]=r,Object.prototype.hasOwnProperty.call(i,"syntaxes")||(i.syntaxes=Object.assign({},i.syntaxes||{})),console.log("Adding syntax: ",t,e),i.syntaxes[t]=e}}}function c(t){return function(e){e.prototype.cliGetName=function(){return t}}}var d=function(t,e,s,n){var o,i=arguments.length,r=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,s):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,s,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(r=(i<3?o(r):i>3?o(e,s,r):o(e,s))||r);return i>3&&r&&Object.defineProperty(e,s,r),r},g=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};class m{gameWorld;enabled=!0;name="Plugin";event(t,e){}start(){}update(t){}fixedUpdate(t){}getPlugin(t){return this.gameWorld.getPlugin(t)}hasPlugin(t){return this.gameWorld.hasPlugin(t)}isEnabled(){return this.enabled}enable(t=!0){this.enabled=t}disable(){this.enabled=!1}cliGetName(){return this.name}help(){let t=`${this.cliGetName()} commands:\n`;for(const e of Object.values(this.constructor.syntaxes))t+=`/${this.cliGetName()}:${e}\n`;return new l(!0,t,void 0)}cliEnable(){return this.enabled=!0,new l(!0,`${this.name} enabled`,void 0)}cliDisable(){return this.enabled=!1,new l(!0,`${this.name} disabled`,void 0)}}d([h("help"),g("design:type",Function),g("design:paramtypes",[]),g("design:returntype",l)],m.prototype,"help",null),d([h("enable"),g("design:type",Function),g("design:paramtypes",[]),g("design:returntype",l)],m.prototype,"cliEnable",null),d([h("disable"),g("design:type",Function),g("design:paramtypes",[]),g("design:returntype",l)],m.prototype,"cliDisable",null);class u{constructor(){}}class p{subs=new Map;args=[];subscribe(t,e){this.subs.set(new WeakRef(t),e)}unsubscribe(t){this.subs.delete(new WeakRef(t))}emit(t){this.args.push(t)}register(t){t.registerEvent(this)}invoke(){if(0!=this.args.length){for(const[t,e]of this.subs){const s=t.deref();if(s)for(const t of this.args)s.event(t,e);else this.subs.delete(t)}this.args=[]}}}class f extends u{delta;constructor(t){super(),this.delta=t}}class y extends u{button;constructor(t){super(),this.button=t}}class w extends m{name="MousePlugin";mouseScrollYEvent=new p;mouseDownEvent=new p;mouseUpEvent=new p;pressedKeys=new Set;canvas;position=n.zero();constructor(t){super(),this.canvas=t,this.trackMouse(t)}start(){this.mouseScrollYEvent.register(this.gameWorld),this.mouseDownEvent.register(this.gameWorld),this.mouseUpEvent.register(this.gameWorld)}isKeyDown(t=0){return this.pressedKeys.has(t)}getMouseScreenPosition(){return new n(this.canvas.width,this.canvas.height),new n(this.position.x,this.position.y)}trackMouse(t){t.addEventListener("mousemove",(e=>{const s=t.getBoundingClientRect();let o=e.clientX-s.left,i=e.clientY-s.top;this.position=new n(o,i)})),t.addEventListener("mousedown",(t=>{this.pressedKeys.add(t.button),this.mouseDownEvent.emit(new y(t.button))})),t.addEventListener("mouseup",(t=>{this.pressedKeys.delete(t.button),this.mouseUpEvent.emit(new y(t.button))})),t.addEventListener("wheel",(t=>{this.mouseScrollYEvent.emit(new f(t.deltaY))}))}}class b extends u{collider;constructor(t){super(),this.collider=t}}class x extends e{offset=n.zero();radius;isActive=!1;isStatic;avoidObjectes;collisions=new Set;onCollisionEnterEvent=new p;onCollisionExitEvent=new p;constructor(t=1,e=!0,...s){super(),this.radius=t,this.isStatic=e,this.avoidObjectes=new Set,s.forEach((t=>this.avoidObjectes.add(t)))}start(){this.onCollisionEnterEvent.register(this.getGameWorld()),this.onCollisionExitEvent.register(this.getGameWorld())}getCenter(){return this.getTransform().position.add(this.offset)}collides(t){return this.getCenter().sub(t.getCenter()).magnitude()<=this.radius+t.radius&&!this.avoidObjectes.has(t.getGameObject())&&!t.avoidObjectes.has(this.getGameObject())}onCollisionEnter(t){this.onCollisionEnterEvent.emit(new b(t))}onCollisionExit(t){this.onCollisionExitEvent.emit(new b(t))}}class P extends m{name="CollisionDetectionPlugin";cellSize=5;cells=new Map;update(){this.checkCollisions()}getCellKey(t){const e=Math.floor(t.x/this.cellSize),s=Math.floor(t.y/this.cellSize);return new n(e,s)}getNearbyCircles(t){const e=[];for(let s=-1;s<=1;s++)for(let o=-1;o<=1;o++){const i=new n(s,o),r=t.add(i).toString();this.cells.has(r)&&e.push(...this.cells.get(r)?.map((t=>t.deref())).filter((t=>null!=t))??[])}return e}overlapPoint(t){let e=this.getNearbyCircles(this.getCellKey(t));return e=e.filter((e=>e.getCenter().sub(t).magnitude()<e.radius)),e}checkCollisions(){this.cells.clear();let t=this.gameWorld.getComponents(x);for(const e of t){e.isActive=!1;let t=this.getCellKey(e.getCenter()).toString();this.cells.has(t)?this.cells.get(t).push(new WeakRef(e)):this.cells.set(t,[new WeakRef(e)])}for(const t of this.cells.values())for(const e of t){const t=e.deref();if(void 0===t)continue;if(t.isStatic)continue;let s=new Set,n=this.getNearbyCircles(this.getCellKey(t.getCenter()));for(const e of n)t!==e&&t.collides(e)&&(t.isActive=!0,s.add(e),e.isActive=!0);for(let e of s)t.collisions.has(e)||t.getComponent(x).onCollisionEnter(e);t.collisions.clear(),t.collisions=s}}}var v,C=function(t,e,s,n){var o,i=arguments.length,r=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,s):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,s,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(r=(i<3?o(r):i>3?o(e,s,r):o(e,s))||r);return i>3&&r&&Object.defineProperty(e,s,r),r},S=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};let T=v=class extends m{cameraPositon=new n(4,0);targetCameraPositon=new n(4,0);cameraScreenOffset=new n(100,100);followingSpeed=.02;isFollowing=!0;scale=new n(20,-20);scaleM=20;target=void 0;targetScale=40;name="CameraPlugin";start(){this.getPlugin(w).mouseScrollYEvent.subscribe(this,"scroll"),this.getPlugin(w).mouseDownEvent.subscribe(this,"down"),this.getPlugin(w).mouseUpEvent.subscribe(this,"up")}event(t,e){if("scroll"==e){const e=t;this.zoom(e.delta)}else if("down"==e){if(1!=t.button)return;if(this.target?.deref())return void(this.target=void 0);const e=this.getPlugin(w).getMouseScreenPosition(),s=this.getWorldPosition(e);let n=this.getPlugin(P).overlapPoint(s)[0]?.getGameObject();n&&(this.target=new WeakRef(n))}}zoom(t){(t=Math.sign(t))>0&&.9*this.targetScale>10&&(this.targetScale=.9*this.targetScale),t<0&&1.1*this.targetScale<100&&(this.targetScale=1.1*this.targetScale)}getWorldPosition(t){let e=this.getPlugin(v).scale,s=this.getPlugin(v).cameraPositon;return new n((t.x-this.cameraScreenOffset.x)/e.x,(t.y-this.cameraScreenOffset.y)/e.y).add(s)}update(t){this.isFollowing&&(this.cameraPositon=this.cameraPositon.interpolate(this.targetCameraPositon,Math.pow(this.followingSpeed,t))),this.scaleM+=(this.targetScale-this.scaleM)*(2.5*t),this.scale=new n(this.scaleM,-this.scaleM);const e=this.target?.deref();if(e){const s=this.getPlugin(w).getMouseScreenPosition(),n=this.getWorldPosition(s);e.getTransform().position=e.getTransform().position.interpolate(n,Math.pow(.001,t))}}fixedUpdate(t){this.cameraPositon=this.cameraPositon.add(this.targetCameraPositon.sub(this.cameraPositon).times(.02))}getscale(){return new l(!0,this.scale.toString(),this.scale)}follow(t){return this.isFollowing=t,new l(!0,"Camera is "+(t?"following":"not following"),void 0)}setzoom(t){return this.targetScale=t,new l(!0,`Camera zoom set to ${t}`,void 0)}};C([h("getscale",void 0,"number"),S("design:type",Function),S("design:paramtypes",[]),S("design:returntype",l)],T.prototype,"getscale",null),C([h("follow","<following: boolean>"),S("design:type",Function),S("design:paramtypes",[Boolean]),S("design:returntype",l)],T.prototype,"follow",null),C([h("zoom","<zoom: number>"),S("design:type",Function),S("design:paramtypes",[Number]),S("design:returntype",l)],T.prototype,"setzoom",null),T=v=C([c("camera")],T);class M extends e{zindex;constructor(t=0){super(),this.zindex=t}}class W extends M{color=new i(42,42,55);text;displayName;constructor(t,e=!1,s=1){super(),this.text=t,this.zindex=s,this.displayName=e}render(t){const e=this.getGameWorld().getPlugin(T).cameraScreenOffset,s=this.getTransform().position.x,n=this.getTransform().position.y,o=(this.getTransform().rotation,this.getTransform().scale),i=this.getGameWorld().getPlugin(T).scale,r=this.getGameWorld().getPlugin(T).cameraPositon.x,a=this.getGameWorld().getPlugin(T).cameraPositon.y,l=this.color.toString(),h=s-r,c=n-a;t.fillStyle=l,t.translate(e.x,e.y),t.scale(i.x,i.y),t.translate(h,c),t.scale(o.x,o.y),t.scale(1,-1);const d=this.displayName?this.getGameObject().name:this.text;t.font="bold 1px Arial",t.fillStyle="azure",t.shadowBlur=10;const g=t.measureText(d).width/2;t.strokeText(d,-g,1/4),t.fillText(d,-g,1/4),t.shadowBlur=0,t.setTransform(1,0,0,1,0,0)}}class E extends m{name="ConfigPlugin";config=new Map([["bulletSize",.75],["playerSize",2.5],["bulletColor",new i(56,57,60)],["playerColor",new i(122,111,62)],["playerColor",new i(80,37,36)],["playerColor",new i(59,94,76)],["playerColor",new i(129,49,54)],["playerColor",new i(130,111,51)]]);get(t){if(this.config.has(t))return this.config.get(t)}set(t,e){this.config.set(t,e)}}class R extends M{activeColor=new i(172,42,55,.125);staticColor=new i(95,64,36,.125);dynamicColor=new i(57,127,31,.125);disabledColor=new i(36,24,36,.125);constructor(t=-1){super(),this.zindex=t}getColor(){let t=this.dynamicColor,e=this.getComponent(x);return e.isEnabled()?e.isActive?t=this.activeColor:e.isStatic&&(t=this.staticColor):t=this.disabledColor,t}render(t){if(!this.getPlugin(E)?.get("displayColliders"))return;const e=this.getComponent(x),s=e.offset,n=e.radius,o=e.radius+.25,i=this.getColor(),r=this.getGameWorld().getPlugin(T).cameraScreenOffset,a=this.getTransform().position.x+s.x,l=this.getTransform().position.y+s.y,h=this.getTransform().rotation,c=this.getGameWorld().getPlugin(T).scale,d=a-this.getGameWorld().getPlugin(T).cameraPositon.x,g=l-this.getGameWorld().getPlugin(T).cameraPositon.y;t.save(),t.translate(r.x,r.y),t.scale(c.x,c.y),t.translate(d,g),t.rotate(h),t.strokeStyle=i.toRgb().toString(),t.fillStyle=i.toString(),t.shadowBlur=30,t.beginPath(),t.arc(0,0,o,0,2*Math.PI),t.closePath(),t.fill(),t.stroke(),t.beginPath(),t.arc(0,0,n,0,2*Math.PI),t.closePath(),t.lineWidth=.1,t.stroke(),t.restore()}}class k{progress=-1;duration=.25;startAnimation=()=>{};endAnimation=()=>{};updateAnimation=()=>{};constructor(t=()=>{},e=()=>{},s=()=>{}){this.updateAnimation=t,this.startAnimation=e,this.endAnimation=s}update(t){if(this.progress>0){let e=(this.duration-this.progress)/this.duration;this.progress-=t,this.updateAnimation(e)}else-1!=this.progress&&(this.endAnimation(),this.progress=-1)}start(){-1==this.progress?(this.startAnimation(),this.progress=this.duration):this.progress=(this.duration+this.progress)/2}}class O extends e{tickCount=0;tick(t){0==this.tickCount?this.start():this.update(t),this.tickCount++}start(){}update(t){}}class G extends O{shrinkAnimation=new k;zoomAnimation=new k;defaultZoom=new n(1,1);constructor(){super(),this.shrinkAnimation=new k((t=>this.getTransform().scale=this.defaultZoom.times(1-t)),(()=>this.getComponent(D)?.enable(!1)),(()=>this.getGameObject().destroy())),this.zoomAnimation=new k((t=>this.getTransform().scale=this.defaultZoom.times(1+Math.sin(Math.PI*t)/5)),(()=>this.defaultZoom=this.getTransform().scale.clone()),(()=>this.getTransform().scale=this.defaultZoom))}update(t){this.shrinkAnimation.update(t),this.zoomAnimation.update(t)}startZoom(){this.zoomAnimation.start()}startShrink(){this.shrinkAnimation.start()}}class j extends M{color;radius;n;constructor(t,e=4,s=0,n=i.randomColor2()){super(),this.radius=t,this.n=e,this.zindex=s,this.color=n}render(t){const e=this.getGameWorld().getPlugin(T).cameraScreenOffset,s=this.getTransform().position.x,n=this.getTransform().position.y,o=this.getTransform().rotation,i=this.getTransform().scale,r=this.getGameWorld().getPlugin(T).scale,a=this.getGameWorld().getPlugin(T).cameraPositon.x,l=this.getGameWorld().getPlugin(T).cameraPositon.y,h=this.color.toString(),c=s-a,d=n-l;t.translate(e.x,e.y),t.scale(r.x,r.y),t.translate(c,d),t.rotate(o),t.scale(i.x,i.y);const g=this.radius;if(this.n<10){t.beginPath(),t.moveTo(0,g);const e=2*Math.PI/this.n;for(let s=1;s<this.n;s++)t.lineTo(Math.sin(s*e)*g,Math.cos(s*e)*g);t.closePath()}else t.beginPath(),t.arc(0,0,g,0,2*Math.PI),t.closePath();t.fillStyle=h,t.shadowBlur=0,t.fill(),t.shadowBlur=50,t.stroke(),t.shadowBlur=0,t.setTransform(1,0,0,1,0,0)}}class A extends u{damage;participant;constructor(t,e){super(),this.damage=t,this.participant=e}}class I extends e{health;maxHealth;damageEvent;constructor(t,e=t){super(),this.health=e,this.maxHealth=t,this.damageEvent=new p}start(){this.damageEvent.register(this.getGameWorld()),this.getComponent(x).onCollisionEnterEvent.subscribe(this,"onCollisionEnter")}event(t){let e=t;this.onCollisionEnter(e.collider)}onCollisionEnter(t){let e=t.getGameObject(),s=e.getComponent(o),n=this.getComponent(o),i=n.mass/(s.mass+n.mass);n.mass<s.mass&&(s.velocity=s.velocity.add(n.velocity.times(i)).times(.5),n.velocity=n.velocity.add(s.velocity.times(1-i).times(.5))),s.angularVelocity+=this.getTransform().position.sub(e.getTransform().position).vectorProduct(n.velocity)*(i/15);try{const t=e.getComponent(I),s=Math.min(t.health,this.health);if(0==s)return;this.onDamage(s,t),t.onDamage(s,this)}catch{}}getHealth(){return this.health/this.maxHealth}heal(t){this.health=Math.min(this.maxHealth,this.health+t)}onDamage(t,e){if(this.health-=t,this.damageEvent.emit(new A(t,e)),0==this.health){if(this.getComponent(x)?.enable(!1),this.getComponent(o).dampingFactor=.6,this.getComponent(G)?.startShrink(),e.hasComponent(j)){let t=this.getComponent(j).color.blend(e.getComponent(j).color.toRgb(),.5).toRgb();this.getComponent(j).color=t,e.getComponent(j).color=t}}else this.getComponent(G)?.startZoom()}}class D extends M{offset=new n(0,4);fill=.5;width=5;height=.5;constructor(t=0){super(t)}render(t){let e=this.width,s=this.fill;try{s=this.getComponent(I).getHealth(),e=2+this.getComponent(I).maxHealth/250}catch{}if(s>=1||s<=0)return;const n=this.getTransform().position.x,o=this.getTransform().position.y,r=this.getTransform().scale,a=this.getGameWorld().getPlugin(T).scale,l=this.getGameWorld().getPlugin(T).cameraScreenOffset,h=this.getGameWorld().getPlugin(T).cameraPositon.x,c=this.getGameWorld().getPlugin(T).cameraPositon.y,d=i.getHeatmapColor(s).toString(),g=n-h,m=o-c,u=.25;t.translate(l.x,l.y),t.scale(a.x,a.y),t.translate(g,m),t.scale(r.x,r.y),t.translate(this.offset.x,this.offset.y),t.fillStyle=d,t.shadowBlur=0,t.beginPath(),t.roundRect(-e/2,-this.height/2,e,this.height,u),t.closePath(),t.fillStyle=i.background.toString(),t.fill(),t.beginPath(),t.roundRect(-e/2,-this.height/2,e*s,this.height,u),t.closePath(),t.fillStyle=d,t.fill(),t.beginPath(),t.roundRect(-e/2,-this.height/2,e,this.height,u),t.closePath(),t.shadowBlur=30,t.stroke(),t.beginPath(),t.roundRect(-e/2,-this.height/2,e*s,this.height,u),t.closePath(),t.shadowBlur=0,t.stroke(),t.setTransform(1,0,0,1,0,0)}}class z extends m{name="SchedulerPlugin";schedule=[];addInvoke(t,e,s){let n=new WeakRef(t);this.schedule.push({totalTime:e,subscriber:n,topic:s}),this.schedule.sort(((t,e)=>e.totalTime-t.totalTime))}update(t){const e=this.gameWorld.getWorldTime();if(0!=this.schedule.length)for(;0!=this.schedule.length&&this.schedule[this.schedule.length-1].totalTime<=e;){let t=this.schedule.pop();t.subscriber.deref()?.onInvoke(t.topic)}}}class F extends e{lifeTime;constructor(t=1){super(),this.lifeTime=t}onInvoke(t){this.getComponent(G)?.startShrink()}start(){let t=this.getGameWorld().getWorldTime()+this.lifeTime;this.getGameWorld().getPlugin(z).addInvoke(this,t,"destroy")}}class $ extends e{owner;constructor(t){super(),this.owner=new WeakRef(t)}getOwner(){return this.owner.deref()}static bulletGO(t,e=30,s=.65,n=1,r=-1,...l){let h=new a(new o(.05,1),new j(s,10,r,new i(173,87,87)),new x(s,!1),new R,new I(e),new G,new F(n),new $(t),...l);return h.getTransform().rotation=0,h.name="Bullet",h}}class B extends M{color;constructor(t=0,e=i.background.clone()){super(),this.zindex=t,this.color=e}render(t){const e=this.getComponent(H).length,s=this.getComponent(H).width,n=this.getTransform().position.x,o=this.getTransform().position.y,i=this.getTransform().scale,r=this.getGameWorld().getPlugin(T).scale,a=this.getGameWorld().getPlugin(T).cameraScreenOffset,l=this.getGameWorld().getPlugin(T).cameraPositon.x,h=this.getGameWorld().getPlugin(T).cameraPositon.y,c=this.color.toString(),d=(this.getComponent(j).color.toString(),n-l),g=o-h,m=this.getComponent(H),u=Math.sin(Math.min(1,m.getShotDelta()/m.cooldown)*Math.PI),p=(m.range,m.direction.times(m.bulletSpeed).times(m.getBulletLifetime()).add(m.getGlobalOffset()));t.translate(a.x,a.y),t.scale(r.x,r.y),t.translate(d,g),t.translate(p.x,p.y),t.beginPath(),t.arc(0,0,1,0,2*Math.PI),t.closePath(),t.shadowBlur=0,t.stroke(),t.strokeRect(-.5,-.5,1,1),t.setTransform(1,0,0,1,0,0),t.translate(a.x,a.y),t.scale(r.x,r.y),t.translate(d,g),t.scale(i.x,i.y),t.rotate(m.direction.toRad()),t.beginPath(),t.roundRect(0,-s/2,(1-u/3)*e,s,.1),t.closePath(),t.fillStyle=c,t.shadowBlur=0,t.fill(),t.shadowBlur=30,t.stroke(),t.shadowBlur=0,t.setTransform(1,0,0,1,0,0)}}class H extends O{damage;cooldown=.15;bulletSpeed=40;length;width;range=250;bulletSpraed=.1;offset;direction=n.right();targetDirection=n.right();lastShootTime=-10;constructor(t=4,e=2,s=10){super(),this.damage=s,this.length=t,this.width=e,this.offset=new n(t-e/2,0)}getShotDelta(){return this.getGameWorld().getWorldTime()-this.lastShootTime}update(t){let e=this.direction.toRad(),o=this.targetDirection.toRad();e+=9*t*s.deltaAngle(e,o),this.direction=n.fromRad(e)}getBulletLifetime(){return this.range/this.bulletSpeed}getGlobalOffset(){return this.direction.toUnit().times(this.offset.x).add(this.direction.cross().times(this.offset.y))}shoot(){if(this.isEnabled&&this.getGameObject().enabled&&this.getShotDelta()>=this.cooldown){const t=.125,e=this.getComponent(B).zindex-.01;let n=$.bulletGO(this.getGameObject(),this.damage,this.width/2+s.symRand(t),this.getBulletLifetime(),e),i=n.getComponent(o),r=n.getComponent(x);n.getComponent(j).color=this.getComponent(j).color.clone(),r.avoidObjectes.add(this.getGameObject()),n.getTransform().position=this.getTransform().position.add(this.getGlobalOffset());let a=this.direction.cross().times(2*Math.random()*this.bulletSpraed-this.bulletSpraed);i.velocity=this.direction.toUnit().add(a).times(this.bulletSpeed),n.spawn(this.getGameWorld()),this.lastShootTime=this.getGameWorld().getWorldTime()}}}class K extends M{color;constructor(t=0,e=new i(22,24,25)){super(),this.zindex=t,this.color=e}render(t){const e=this.getGameWorld().getPlugin(T).cameraScreenOffset,s=this.getTransform().position.x,n=this.getTransform().position.y,o=this.getTransform().rotation,r=this.getTransform().scale,a=this.getGameWorld().getPlugin(T).scale,l=this.getGameWorld().getPlugin(T).cameraPositon.x,h=this.getGameWorld().getPlugin(T).cameraPositon.y,c=(this.color.toString(),s-l),d=n-h;t.translate(e.x,e.y),t.scale(a.x,a.y),t.translate(c,d),t.rotate(o),t.scale(r.x,r.y),t.beginPath(),t.fillStyle=this.getComponent(j).color.toString(),t.shadowBlur=0,t.roundRect(-4,-2,8,4,1),t.fill(),t.shadowBlur=50,t.stroke(),t.closePath(),t.beginPath(),t.fillStyle=i.background.toString(),t.shadowBlur=0,t.roundRect(-4.5,-3.25,10,2,.5),t.fill(),t.shadowBlur=50,t.stroke(),t.closePath(),t.beginPath(),t.shadowBlur=0,t.roundRect(-4.5,1.25,10,2,.5),t.fill(),t.shadowBlur=50,t.stroke(),t.closePath(),t.beginPath(),t.fillStyle=i.background.toString(),t.shadowBlur=0,t.roundRect(-3,-2,6,4,1.5),t.fill(),t.shadowBlur=50,t.stroke(),t.closePath(),t.shadowBlur=0,t.setTransform(1,0,0,1,0,0)}}class U extends M{color;tracesSpace=.5;traces=[];lastPosition=void 0;transparency=2;duration=1;length=2;constructor(t=0,e=new i(66,83,68)){super(),e=e.blend(i.stroke,.3),this.zindex=t,this.color=e}render(t){const e=this.getGameWorld().getPlugin(T).cameraScreenOffset,s=this.getGameWorld().getPlugin(T).scale,n=this.getGameWorld().getPlugin(T).cameraPositon.x,o=this.getGameWorld().getPlugin(T).cameraPositon.y,i=this.getTransform().position.clone(),r=this.getTransform().rotation;null==this.lastPosition&&(this.lastPosition=i.clone());let a=i.sub(this.lastPosition);for(;a.magnitude()>this.tracesSpace;)this.traces.push({position:this.lastPosition,rotation:r,startTime:this.getGameWorld().getWorldTime()}),this.lastPosition=this.lastPosition.add(a.toUnit().times(this.tracesSpace)),a=i.sub(this.lastPosition);for(;this.traces.length>0&&this.traces[0].startTime+this.duration<this.getGameWorld().getWorldTime();)this.traces.shift();for(const i of this.traces){const r=i.position.x-n,a=i.position.y-o,l=1-(this.getGameWorld().getWorldTime()-i.startTime)/this.duration;t.translate(e.x,e.y),t.scale(s.x,s.y),t.translate(r,a),t.rotate(i.rotation),t.beginPath(),t.fillStyle=this.color.toArgb(this.color.a*this.transparency*l).toString(),t.shadowBlur=0,t.roundRect(-4.5,-3.25,this.length,2,.75),t.fill(),t.closePath(),t.beginPath(),t.roundRect(-4.5,1.25,this.length,2,.75),t.fill(),t.closePath(),t.setTransform(1,0,0,1,0,0)}}}class V extends e{tags=new Set;constructor(...t){super(),t.forEach((t=>this.addTag(t)))}addTag(t){this.tags.add(t)}removeTag(t){this.tags.delete(t)}hasTag(t){return this.tags.has(t)}getTags(){return Array.from(this.tags)}}class N{static polygonGO(t=2,e=3,...n){let r=new a(new o(.1),new j(t,e,0,i.randomColor2().toArgb(.75)),new D(.1),new x(s.getColliderRadius(e,t)),new R,new I(25*e),new G,new V("Dragable"),...n);return r.getTransform().rotation=2*Math.random()*Math.PI,r.name="Polygon",r}static enemyGO(t=2.5,e="",i=4,...r){let l=new a(new W(e,void 0,i+.1),new j(t,8,i),new D(i+.1),new K(i-.2),new o(30),new x(t,!1),new R(i-.15),new I(1500),new G,new U(-21.37),...r);return l.getTransform().rotation=s.symRand(Math.PI),l.getComponent(o).angularDrag=1,l.getComponent(H).targetDirection=n.fromRad(s.symRand(Math.PI)),l.name="Enemy",l}static bulletGO(t,e=30,s=.65,n=1,r=-1,...l){let h=new a(new o(.05,1),new j(s,10,r,new i(173,87,87)),new x(s,!1),new R,new I(e),new G,new F(n),new $(t),...l);return h.getTransform().rotation=0,h.name="Bullet",h}static playerGO(t=2.5,e=5,...s){let n=new a(new K(e-.2),new j(t,10,e,new i(50,99,52)),new W("Player",!0,e+.1),new R(e-.15),new D(e+.1),new B(e-.1),new o(30,.025),new x(t,!1),new I(1e3),new G,new H(6,1.55,44),new U(-21.37),...s);return n.getTransform().rotation=0,n.name="Player",n}}class L extends u{key;constructor(t){super(),this.key=t}}class q extends m{name="KeyboardPlugin";prevPressedKeys=new Set;pressedKeys=new Set;KeyDownEvent=new p;constructor(t){super(),this.pressedKeys=t}isPressed(t){return this.pressedKeys.has(t)}start(){this.KeyDownEvent.register(this.gameWorld)}update(t){this.pressedKeys.difference(this.prevPressedKeys).forEach((t=>this.KeyDownEvent.emit(new L(t)))),this.prevPressedKeys.clear(),this.pressedKeys.forEach((t=>this.prevPressedKeys.add(t)))}}class Z extends m{name="ProfilerPlugin";size=250;isVisible=!0;profilerWrapper=document.createElement("div");usage=new Map;constructor(){super()}start(){this.getPlugin(q).KeyDownEvent.subscribe(this,"keydown"),document.body.appendChild(this.profilerWrapper),this.addRecord("Fps",0)}lastTime=performance.now();frames=0;fpsHistory=[];update(t){const e=1/t;this.addRecord("Fps",e),this.frames++;const s=performance.now();s-this.lastTime>=250&&(this.fpsHistory.push(4*this.frames),this.fpsHistory.length>100&&this.fpsHistory.shift(),this.frames=0,this.lastTime=s);let n=[];for(const t of this.usage){let e=t[0],s=t[1].length,o=0;for(const e of t[1])o+=e;o/=s,n.push(`${e}: `+o.toFixed(2).toString())}this.profilerWrapper.innerHTML=this.getInnerHtml(n)}event(t,e){"keydown"==e&&"p"==t.key&&(this.isVisible=!this.isVisible)}addRecord(t,e){if(this.usage.has(t)){let s=this.usage.get(t);s.length>=this.size?(s.shift(),s.push(e)):s.push(e)}else this.usage.set(t,[e])}getChartHtml(t){t=t.slice(Math.max(0,t.length-100),t.length);let e='<div class="profiler-chart">';for(let s=0;s<t.length;s++)e+=`<div class="profiler-chart-item" style="height: ${t[s]/200*100}px"></div>`;return e+="</div>",e}getElementsHtml(t){let e="";for(let s=0;s<t.length;s++)s>0&&(e+='<hr class="profiler-item-separator">'),e+=`<div class="profiler-item">\n                <span class="profiler-item-key">${t[s].split(": ")[0]}:</span>\n                <span class="profiler-item-value">${t[s].split(": ")[1]}</span>\n            </div>`;return e}getInnerHtml(t){return`\n            <style>\n                .profiler{\n                    ${this.isVisible?"":"display: none;"}\n                    position: fixed;\n                    top: 20px;\n                    left: 20px;\n                    \n                    width: fit-content;\n                    padding: 20px;\n                    border-radius: 20px;\n                    background-color: rgba(42, 43, 46, 0.382);\n                    color: white;\n                    font-family: Roboto, sans-serif;\n                    pointer-events: none;\n                }\n                .profiler-header{\n                    font-size: 20px;\n                    font-weight: bold;\n                    color: white;\n                    margin-bottom: 10px;\n                }\n                .profiler-item{\n                    // display: flex;\n                    // justify-content: space-between;\n                    padding: 5px 0;\n                    color:rgba(240, 240, 240, 0.85)\n                }\n                .profiler-item-key{\n                    margin-right: 10px;\n                }\n                .profiler-item-value{\n                    color: #f0f0f0;\n                }\n                .profiler-item-separator{\n                    border: none;\n                    border-top: 1px dashed rgba(240, 240, 240, 0.33);\n                    margin: 2px 0;\n                }\n                .profiler-chart{\n                    display: flex;\n                    flex-direction: row;\n                    justify-content: space-between;\n                    align-items: flex-end;\n                    height: 100px;\n                    width: 100%;\n                    margin-bottom: 10px;\n                    border-radius: 10px;\n                    overflow: hidden;\n                    opacity: 0.25;\n                }\n                .profiler-chart-item{\n                    background-color: rgb(240, 240, 240);\n                    width: 100%;\n                    margin: 0;\n                }\n            </style>\n\n            <div class="profiler">\n                <div class="profiler-header">\n                    <h2 style="margin: 0">Profiler <span style="opacity: 0.5">[P]</span></h2>\n                </div>\n                ${this.getChartHtml(this.fpsHistory)}\n                ${this.getElementsHtml(t)}\n            </div>\n            `}}class Y{startTime=0;prevWorldTime=0;prevFixedWorldTime=0;worldTime=0;tickCount=0;gameObjects=new Set;plugins=new Map;events=new Set;componentsToStart=[];constructor(...t){for(let e of t){let t=e.constructor.name;if(this.plugins.has(t))throw new Error(`Plugin ${t} already exists in the game object`);e.gameWorld=this,this.plugins.set(t,e)}}getPlugin(t){const e=t.name;return this.plugins.get(e)}getAllPlugins(){return Array.from(this.plugins.values())}hasPlugin(t){const e=t.name;return this.plugins.has(e)}isSpawned(t){return this.gameObjects.has(t)}spawn(t){if(this.gameObjects.has(t))throw new Error(`GameObject ${t.name} already exists in the game world`);return t.gameWorld=this,this.gameObjects.add(t),t.getAllComponents().forEach((t=>this.componentsToStart.push(new WeakRef(t)))),t}destroy(t){if(!this.gameObjects.has(t))throw new Error(`GameObject ${t.name} does'not exist in the game world`);t.enabled=!1,this.gameObjects.delete(t)}getAllGameObjects(t=!0){return Array.from(this.gameObjects).filter((e=>e.enabled||!t))}getComponents(t,e=!0){return this.getAllGameObjects().filter((s=>s.hasComponent(t)&&(s.getComponent(t).isEnabled()||!e))).map((e=>e.getComponent(t)))}getAllComponents(t=!0){return Array.from(this.getAllGameObjects(t)).flatMap((t=>t.getAllComponents()))}registerEvent(t){this.events.add(new WeakRef(t))}getWorldTime(){return this.worldTime/1e3}tick(){this.tickCount++,1==this.tickCount?this.startWorld():this.updateWorld(),this.startComponents(),this.invokeEvents()}startComponents(){for(let t of this.componentsToStart){const e=t.deref();e&&e.start()}this.componentsToStart=[]}startWorld(){this.startTime=performance.now(),this.Start(),this.plugins.forEach((t=>t.start()))}updateWorld(){this.worldTime=performance.now()-this.startTime;const t=this.worldTime-this.prevWorldTime;this.prevWorldTime=this.worldTime,this.Update(t/1e3),this.plugins.forEach((e=>{if(!e.isEnabled())return;let s=performance.now();e.update(t/1e3),this.getPlugin(Z).addRecord(e.name,performance.now()-s)}))}invokeEvents(){let t=performance.now();for(const t of this.events){const e=t.deref();e?e.invoke():this.events.delete(t)}this.getPlugin(Z).addRecord("Events",performance.now()-t)}Start(){}Update(t){}}var J;!function(t){t[t.neutral=0]="neutral",t[t.passive=1]="passive",t[t.aggresive=2]="aggresive"}(J||(J={}));class X extends O{type=J.aggresive;isAttacing=!1;target;isFollowing=!1;minDistance=35;maxDistance=1e3;maxSpeed=10;start(){this.getComponent(I).damageEvent.subscribe(this)}event(t){const e=t.participant;e.hasComponent($)&&e.getComponent($).getOwner()&&this.attack(e.getComponent($).getOwner())}attack(t){this.isAttacing=!0,this.target=new WeakRef(t),this.isFollowing=!0}update(t){if(this.target&&this.target.deref()){if(this.isAttacing){let e=this.getComponent(H),i=this.target.deref().getTransform().position.sub(this.getTransform().position);e.targetDirection=i;let r=i.magnitude();if(r>this.maxDistance&&(this.isAttacing=!1),e.shoot(),r>=this.minDistance){let e=this.getTransform().rotation,r=i.toRad();e+=5*t*s.deltaAngle(e,r),this.getTransform().rotation=e,this.getComponent(o).velocity=n.fromRad(e).times(this.maxSpeed)}}}else this.isAttacing=!1}}class _ extends Y{Start(){console.log("Hello, MyWorld!");const t=350;for(let e=0;e<550;e++){const e=3+s.symRand(.25);let i=N.polygonGO(e/2,4);i.getTransform().position=n.randomPos(t),i.getComponent(o).angularVelocity=2*Math.random()-1,this.spawn(i)}for(let e=0;e<250;e++){const e=3.5+s.symRand(.25);let i=N.polygonGO(e/2,3);i.getTransform().position=n.randomPos(t),i.getComponent(o).angularVelocity=2*Math.random()-1,this.spawn(i)}for(let e=0;e<350;e++){const e=4+s.symRand(.25);let i=N.polygonGO(e/2,Math.round(3*Math.random())+5);i.getTransform().position=n.randomPos(t),i.getComponent(o).angularVelocity=2*Math.random()-1,this.spawn(i)}for(let e=0;e<25;e++){let s=N.enemyGO(2.5,"Enemy nr."+e,4,new H(void 0,void 0,10+5*Math.random()),new B(3.9),new X);s.getTransform().position=n.randomPos(t),s.spawn(this)}}Update(t){}}class Q extends M{image=new Image;side;offset;constructor(t=n.zero(),e=n.zero(),s="GameEngine/src/Assets/vectorpaint3.svg",o=0){super(),this.zindex=o,this.side=t,this.offset=e,this.image.src=s}render(t){const e=this.getGameWorld().getPlugin(T).cameraScreenOffset,s=this.getTransform().position.x,n=this.getTransform().position.y,o=this.getTransform().rotation,i=this.getTransform().scale,r=this.getGameWorld().getPlugin(T).scale,a=s-this.getGameWorld().getPlugin(T).cameraPositon.x,l=n-this.getGameWorld().getPlugin(T).cameraPositon.y;let h=this.side;0==h.x&&(h.x=this.image.width),0==h.y&&(h.y=this.image.height),t.translate(e.x,e.y),t.scale(r.x,r.y),t.translate(a,l),t.rotate(o),t.scale(i.x,i.y),t.translate(this.offset.x,this.offset.y),t.shadowBlur=15,t.drawImage(this.image,-h.x/2,-h.y/2,h.x,h.y),t.shadowBlur=0,t.setTransform(1,0,0,1,0,0)}}class tt extends m{name="RendererPlugin";context;renderDistance=150;constructor(t){super(),this.context=t}addVignetteEffect(t,e){const s=t.canvas.width/2,n=t.canvas.height/2,o=Math.sqrt(s*s+n*n),i=t.createRadialGradient(s,n,0,s,n,o);i.addColorStop(.025,"rgba(0, 0, 0, 0)"),i.addColorStop(1,e),t.fillStyle=i,t.fillRect(0,0,t.canvas.width,t.canvas.height)}gridCanvas=[];start(){this.context.imageSmoothingEnabled=!0,this.context.strokeStyle="rgb(43,43,44)",this.context.lineWidth=.175,this.context.lineJoin="round",this.context.shadowColor="rgba(0, 0, 0, 0.75)",this.context.fillStyle="#716f6b",this.context.fillStyle="rgb(85, 106, 86)",this.context.fillStyle="rgb(66, 85, 68)";let e=new Worker(new URL(t.p+t.u(703),t.b),{type:"module"});for(let t=0;t<10;t++){this.gridCanvas[t]=document.createElement("canvas"),this.gridCanvas[t].width=3440,this.gridCanvas[t].height=1440,document.createElement("canvas");const s=this.gridCanvas[t].transferControlToOffscreen();e.postMessage({canvas:s,args:[new n(2,2),.175,i.stroke.toString(),new n(5*t+5,5*t+5)]},[s])}}clip(t){const e=this.context.canvas.width,s=this.context.canvas.height,n=this.getPlugin(T).scale,o=this.getPlugin(T).cameraPositon,i=Math.abs(e/2/n.x),r=Math.abs(s/2/n.y);return Math.abs(t.x-o.x)>i||Math.abs(t.y-o.y)>r}update(t){const e=this.context.canvas.width,s=this.context.canvas.height;this.context.fillStyle="rgba(80, 100, 81, 1)",this.context.fillRect(0,0,e,s),this.getPlugin(T).cameraScreenOffset=new n(this.context.canvas.width/2,this.context.canvas.height/2);const o=this.getPlugin(T).cameraScreenOffset,i=this.getPlugin(T).scale,r=this.getPlugin(T).cameraPositon;let a=Math.max(0,Math.min(9,Math.round(i.x/10))),l=5*a+5;this.context.translate(o.x,o.y),this.context.scale(i.x,i.y),this.context.translate(-r.x%2,-r.y%2),this.context.scale(1/l,1/l),this.context.drawImage(this.gridCanvas[a],-this.gridCanvas[a].width/2,-this.gridCanvas[a].height/2,this.gridCanvas[a].width,this.gridCanvas[a].height),this.context.setTransform(1,0,0,1,0,0),this.gameWorld.getComponents(W).concat(this.gameWorld.getComponents(R)).concat(this.gameWorld.getComponents(D)).concat(this.gameWorld.getComponents(j)).concat(this.gameWorld.getComponents(Q)).filter((t=>!this.clip(t.getTransform().position))).concat(this.gameWorld.getComponents(B)).concat(this.gameWorld.getComponents(U)).concat(this.gameWorld.getComponents(K)).filter((t=>!this.clip(t.getTransform().position))).sort(((t,e)=>t.zindex-e.zindex)).forEach((t=>t.render(this.context))),this.addVignetteEffect(this.context,"rgba(0, 0, 0, 0.35)")}}class et extends m{name="PhysicsPlugin";update(t){this.gameWorld.getWorldTime(),this.gameWorld.getComponents(o).forEach((e=>e.update(t)))}fixedUpdate(t){this.gameWorld.getWorldTime(),this.gameWorld.getComponents(o).forEach((e=>e.fixedUpdate(t)))}}var st=function(t,e,s,n){var o,i=arguments.length,r=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,s):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,s,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(r=(i<3?o(r):i>3?o(e,s,r):o(e,s))||r);return i>3&&r&&Object.defineProperty(e,s,r),r},nt=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};let ot=class extends m{name="CliPlugin";echo(t){return new l(!0,t,t)}loop(t,e){let s=[],n="";for(let o=0;o<t;o++){const t=this.parseAndExecuteCommands(e);if(!t.status)return new l(!1,`Error executing command: ${t.message}`,void 0);s.push(t.data),n+=`${t.message}\n`}return new l(!0,n,s)}true(){return new l(!0,"This is a true command",!0)}false(){return new l(!0,"This is a false command",!1)}int(t){return new l(!0,`This is an int command with value ${t}`,parseInt(t))}float(t){return new l(!0,`This is a float command with value ${t}`,parseFloat(t))}getrandomcolor(){const t=i.randomColor2();return new l(!0,`Random color is ${t}`,t)}help(){let t=super.help(),e="plugins:\n";for(const t of this.gameWorld.getAllPlugins())e+=`/${t.cliGetName()}\n`;return e=t.message+"\n"+e,new l(!0,e,void 0)}execute(t){try{return this.parseAndExecuteCommands(t)}catch{return new l(!1,"Command execution failed",void 0)}}parseAndExecuteCommands(t,e=0){console.log("---".repeat(e)+"Parsing: "+t);const s=[];let n="",o=!1,i=!1,r=0;t=t.trim();for(let a=0;a<t.length;a++){const l=t[a];if(r>0){if("{"===l){r++,n+=l;continue}if("}"===l){if(r--,0===r){const t=this.parseAndExecuteCommands(n,e+1);s.push(t.data),n=""}else n+=l;continue}n+=l}else if(i){if('"'===l){s.push(n),n="",i=!1;continue}n+=l}else if(o){if("'"===l){s.push(n),n="",o=!1;continue}n+=l}else'"'!==l?"'"!==l?"{"!==l?" "!==l?n+=l:""!==n.trim()&&(s.push(n),n=""):r++:o=!0:i=!0}""!==n.trim()&&s.push(n),console.log("---".repeat(e)+"Parsing result: ",s);const a=s[0].split(":");if(2===a.length){const t=a[0],e=this.gameWorld.getAllPlugins().find((e=>e.cliGetName()===t));return e?this.executeParsedCommand(e,a[1],...s.slice(1)):new l(!1,`Plugin ${t} not found`,void 0)}return 1===a.length?this.executeParsedCommand(this,a[0],...s.slice(1)):new l(!1,"No command found",void 0)}executeParsedCommand(t,e,...s){if(void 0===t.constructor.commands[e])return new l(!1,`Command ${e} not found`,void 0);try{return t.constructor.commands[e].apply(t,s)}catch{}return new l(!1,`Failed to execute command ${e} on ${t.cliGetName()}`,void 0)}};st([h("echo","<message: string>","string"),nt("design:type",Function),nt("design:paramtypes",[String]),nt("design:returntype",l)],ot.prototype,"echo",null),st([h("loop","<iterations: int> <command: string>","string"),nt("design:type",Function),nt("design:paramtypes",[Number,String]),nt("design:returntype",l)],ot.prototype,"loop",null),st([h("true",void 0,"bool"),nt("design:type",Function),nt("design:paramtypes",[]),nt("design:returntype",l)],ot.prototype,"true",null),st([h("false",void 0,"bool"),nt("design:type",Function),nt("design:paramtypes",[]),nt("design:returntype",l)],ot.prototype,"false",null),st([h("int","<value: string>","number"),nt("design:type",Function),nt("design:paramtypes",[String]),nt("design:returntype",l)],ot.prototype,"int",null),st([h("float","<value: string>","number"),nt("design:type",Function),nt("design:paramtypes",[String]),nt("design:returntype",l)],ot.prototype,"float",null),st([h("randomcolor",void 0,"rgb"),nt("design:type",Function),nt("design:paramtypes",[]),nt("design:returntype",l)],ot.prototype,"getrandomcolor",null),st([h("help"),nt("design:type",Function),nt("design:paramtypes",[]),nt("design:returntype",l)],ot.prototype,"help",null),ot=st([c("cli")],ot);var it=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};class rt extends m{name="ConsolePlugin";isVisible=!0;consoleWrapper=document.createElement("div");buffer="";history=[""];historyIndex=0;constructor(){super()}start(){this.getPlugin(q).KeyDownEvent.subscribe(this,"keydown"),document.body.appendChild(this.consoleWrapper),this.consoleWrapper.innerHTML=this.getInnerHtml()}update(t){}event(t,e){if("keydown"==e){const e=t;"t"==e.key&&(this.isVisible=!this.isVisible);try{const t=this.consoleWrapper.querySelector(".console-input");if(null==t)return;if(this.isFocused()&&("arrowup"==e.key&&this.historyIndex<this.history.length-1&&(this.historyIndex++,t.value=this.history[this.historyIndex]),"arrowdown"==e.key&&this.historyIndex>0&&(this.historyIndex--,console.log(this.historyIndex),console.log(this.history),t.value=this.history[this.historyIndex]),"escape"==e.key&&(t.blur(),t.value="")),"enter"==e.key)if(this.isFocused()){const e=t.value.trim();""!==e&&(t.value="",console.log("Sending:",e),this.messageEntered(e)),t.blur()}else t.focus()}catch{}}}isFocused(){try{const t=this.consoleWrapper.querySelector(".console-input");return null!=t&&document.activeElement===t}catch{return!1}}messageEntered(t){if(t.startsWith("/")){this.buffer+=t+"\n";const e=this.getPlugin(ot).execute(t.slice(1));""!=e.message&&(this.buffer+=e.message+"\r\n")}else this.buffer+=t+"\r\n";this.history[0]=t,this.history.unshift(""),this.historyIndex=0,this.updateConsole()}updateConsole(){this.setElementsHtml(this.buffer)}setElementsHtml(t){try{const e=this.consoleWrapper.querySelector(".console-content");if(null==e)return;e.innerHTML="";const s=t.split("\n");for(let t=0;t<s.length-1;t++){const n=s[t];let o=document.createElement("span");o.textContent=n,e.appendChild(o);const i=document.createElement("hr");i.className="console-item-separator",n.endsWith("\r")?e.appendChild(i):e.appendChild(document.createElement("br"))}}catch{}}getInnerHtml(){return`\n            <style>\n                .console{\n                    ${this.isVisible?"":"display: none;"}\n                    position: fixed;\n                    top: 20px;\n                    right: 20px;\n                    \n                    width: fit-content;\n                    padding: 20px;\n                    border-radius: 20px;\n                    background-color: rgba(42, 43, 46, 0.382);\n                    color: white;\n                    font-family: Roboto, sans-serif;\n                    pointer-events: none;\n                    overflow: hidden;\n                }\n                .console-header{\n                    font-size: 20px;\n                    font-weight: bold;\n                    color: white;\n                    margin-bottom: 10px;\n                    user-select: none;\n                }\n                .console-input{\n                    width: 100%; \n                    padding: 5px 0;\n                    margin: 0;\n                    border-radius: 0; \n                    border: none; \n                    border-bottom: 1px solid rgba(240, 240, 240, 0.5);\n                    background-color: transparent; \n                    color: white;\n                    font-size: 20px;   \n                    font-family: Roboto, sans-serif; \n                }\n                .console *::selection {\n                    background-color: #546855;\n                    color: white;\n                }\n                .console-input:focus{\n                    outline: none; \n                    border-bottom: 1px solid rgba(240, 240, 240, 0.85);\n                }\n                .console-content-wrapper{\n                    position: relative;\n                    height: 600px;\n                    width: 100%;\n                    overflow: hidden;\n                    // border: 1px solid rgba(240, 240, 240, 0.25);\n                }\n                .console-content{\n                    position: absolute;\n                    width: 100%;\n                    line-height: 20px;\n                    bottom: 0;\n                }\n                .console-item-separator{\n                    border: none;\n                    border-top: 1px dashed rgba(240, 240, 240, 0.33);\n                    margin: 9.5px 0;\n                }\n            </style>\n\n            <div class="console">\n                \n                <div class="console-content-wrapper">\n                    <div class="console-content"></div>\n                </div>\n                <input class="console-input" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" type="text" tabindex="-1" placeholder="Type your command here..." />\n            </div>\n            `}cliGetName(){return"console"}clearConsole(){return this.buffer="",this.updateConsole(),new l(!0,"",void 0)}}!function(t,e,s,n){var o,i=arguments.length,r=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,s):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,s,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(r=(i<3?o(r):i>3?o(e,s,r):o(e,s))||r);i>3&&r&&Object.defineProperty(e,s,r)}([h("clear"),it("design:type",Function),it("design:paramtypes",[]),it("design:returntype",l)],rt.prototype,"clearConsole",null);var at=function(t,e,s,n){var o,i=arguments.length,r=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,s):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,s,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(r=(i<3?o(r):i>3?o(e,s,r):o(e,s))||r);return i>3&&r&&Object.defineProperty(e,s,r),r},lt=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};class ht extends m{name="PlayerPlugin";player=N.playerGO();isIoBlocked=!1;getPlayerPosition(){return this.player.getTransform().position.clone()}getPlayerColor(){return this.player.getComponent(j).color.clone()}start(){this.player.spawn(this.gameWorld),this.player.name="player",this.player.getComponent(j).color=this.getPlugin(E)?.get("playerColor")??new i(53,110,58),this.getPlugin(q)?.KeyDownEvent.subscribe(this,"KeyDownEvent")}event(t,e){if(!this.isIoBlocked&&"KeyDownEvent"===e){let e=t;if("r"===e.key)this.player&&this.gameWorld.isSpawned(this.player)&&this.gameWorld.destroy(this.player),this.player=N.playerGO(),this.player.spawn(this.gameWorld);else if("c"===e.key){let t=this.getPlugin(E)?.get("displayColliders")??!1;void 0!==t&&this.getPlugin(E)?.set("displayColliders",!t)}}}update(t){let e=this.getPlugin(T);if(e.targetCameraPositon=this.player.getTransform().position.clone(),this.isIoBlocked=this.getPlugin(rt)?.isFocused()??!1,this.isIoBlocked)return;if(!this.player.enabled)return;let s=this.getPlugin(w),i=this.getPlugin(q),r=this.player.getComponent(H);if(!r)return;r.targetDirection=e.getWorldPosition(s.getMouseScreenPosition()).sub(this.player.getTransform().position),r.range=e.getWorldPosition(s.getMouseScreenPosition()).sub(this.player.getTransform().position.add(r.getGlobalOffset())).magnitude(),(i.isPressed("e")||s.isKeyDown(0))&&r.shoot();const a=i.isPressed("shift")?120:60,l=this.player.getTransform().rotation,h=n.fromRad(l);let c=this.player.getComponent(o),d=c.velocity;i.isPressed("w")?(c.acceleration=h.toUnit().times(a),i.isPressed("s")&&(c.acceleration=h.toUnit().times(25))):i.isPressed("s")?c.acceleration=h.toUnit().times(-25):c.acceleration=n.zero(),d=d.sub(d.perpendicular(h)),d.magnitude()>50&&d.setLength(50),i.isPressed("a")?c.angularVelocity=2.5:i.isPressed("d")?c.angularVelocity=-2.5:c.angularVelocity=0}cliGetName(){return"player"}setname(t){return this.player.name=t,new l(!0,`Player name set to ${t}`,void 0)}setcolor(t){try{let e=i.tryParseCssColor(t.toString());e&&(this.player.getComponent(j).color=e)}catch{}return new l(!0,"Player color set",void 0)}getcolor(){return new l(!0,`Player color is ${this.player.getComponent(j).color}`,this.player.getComponent(j).color)}}at([h("setname","<name: string>"),lt("design:type",Function),lt("design:paramtypes",[String]),lt("design:returntype",l)],ht.prototype,"setname",null),at([h("setcolor","<color: string | rgb>"),lt("design:type",Function),lt("design:paramtypes",[Object]),lt("design:returntype",l)],ht.prototype,"setcolor",null),at([h("getcolor",void 0,"rgb"),lt("design:type",Function),lt("design:paramtypes",[]),lt("design:returntype",l)],ht.prototype,"getcolor",null);class ct extends m{name="StandaloneComponentPlugin";update(t){this.gameWorld.getAllComponents().filter((t=>t instanceof O)).map((t=>t)).forEach((e=>e.tick(t)))}}class dt extends m{name="ClientPlugin";socket;start(){}event(t,e){let s=t;this.sendChatMessage(s.message)}onConnection(){console.log("Connected to server")}onDisconnection(t){console.log(`Disconnected from server: ${t}`)}onChatMessage(t){console.log(`Received chat message: ${t}`)}sendChatMessage(t){this.socket.emit("chat_message",t)}}const gt=new Set;document.addEventListener("keydown",(t=>{gt.add(t.key.toLowerCase())})),document.addEventListener("keyup",(t=>{gt.delete(t.key.toLowerCase())})),async function(t){let e=[];e.push(new E),e.push(new dt),e.push(new ot),e.push(new q(gt)),e.push(new w(t)),e.push(new z),e.push(new ht),e.push(new et),e.push(new T),e.push(new rt),e.push(new Z),e.push(new P),e.push(new ct),e.push(new tt(t.getContext("2d")));let s=new _(...e);performance.now(),function t(){s.tick(),requestAnimationFrame(t)}()}(document.getElementById("gameCanvas"),document.getElementById("chatInput"),document.getElementById("chat"));